$gwx_XC_123=function(_,_v,_n,_p,_s,_wp,_wl,$gwn,$gwl,$gwh,wh,$gstack,$gwrt,gra,grb,TestTest,wfor,_ca,_da,_r,_rz,_o,_oz,_1,_1z,_2,_2z,_m,_mz,nv_getDate,nv_getRegExp,nv_console,nv_parseInt,nv_parseFloat,nv_isNaN,nv_isFinite,nv_decodeURI,nv_decodeURIComponent,nv_encodeURI,nv_encodeURIComponent,$gdc,nv_JSON,_af,_gv,_ai,_grp,_gd,_gapi,$ixc,_ic,_w,_ev,_tsd){return function(path,global){
if(typeof global==='undefined'){if (typeof __GWX_GLOBAL__==='undefined')global={};else global=__GWX_GLOBAL__;}if(typeof __WXML_GLOBAL__ === 'undefined') {__WXML_GLOBAL__={};
}__WXML_GLOBAL__.modules = __WXML_GLOBAL__.modules || {};
var e_={}
if(typeof(global.entrys)==='undefined')global.entrys={};e_=global.entrys;
var d_={}
if(typeof(global.defines)==='undefined')global.defines={};d_=global.defines;
var f_={}
if(typeof(global.modules)==='undefined')global.modules={};f_=global.modules || {};
var p_={}
__WXML_GLOBAL__.ops_cached = __WXML_GLOBAL__.ops_cached || {}
__WXML_GLOBAL__.ops_set = __WXML_GLOBAL__.ops_set || {};
__WXML_GLOBAL__.ops_init = __WXML_GLOBAL__.ops_init || {};
var z=__WXML_GLOBAL__.ops_set.$gwx_XC_123 || [];
function gz$gwx_XC_123_1(){
if( __WXML_GLOBAL__.ops_cached.$gwx_XC_123_1)return __WXML_GLOBAL__.ops_cached.$gwx_XC_123_1
__WXML_GLOBAL__.ops_cached.$gwx_XC_123_1=[];
(function(z){var a=11;function Z(ops){z.push(ops)}
Z([1,true])
Z(z[0])
Z([3,'分享海报'])
Z([3,'share-poster-container'])
Z([[7],[3,'loading']])
Z([[7],[3,'sharePoster']])
})(__WXML_GLOBAL__.ops_cached.$gwx_XC_123_1);return __WXML_GLOBAL__.ops_cached.$gwx_XC_123_1
}
__WXML_GLOBAL__.ops_set.$gwx_XC_123=z;
__WXML_GLOBAL__.ops_init.$gwx_XC_123=true;
var x=['./pages/share/poster/index.wxml'];d_[x[0]]={}
var m0=function(e,s,r,gg){
var z=gz$gwx_XC_123_1()
var e4LB=_mz(z,'header',['isFullPage',0,'isPlaceholder',1,'title',1],[],e,s,gg)
var b5LB=_n('div')
_rz(z,b5LB,'class',3,e,s,gg)
var o6LB=_v()
_(b5LB,o6LB)
if(_oz(z,4,e,s,gg)){o6LB.wxVkey=1
var o8LB=_n('loading')
_(o6LB,o8LB)
}
var x7LB=_v()
_(b5LB,x7LB)
if(_oz(z,5,e,s,gg)){x7LB.wxVkey=1
}
o6LB.wxXCkey=1
o6LB.wxXCkey=3
x7LB.wxXCkey=1
_(e4LB,b5LB)
_(r,e4LB)
var f9LB=_n('Privacy')
_(r,f9LB)
return r
}
e_[x[0]]={f:m0,j:[],i:[],ti:[],ic:[]}
if(path&&e_[path]){
return function(env,dd,global){$gwxc=0;var root={"tag":"wx-page"};root.children=[]
;g="$gwx_XC_123";var main=e_[path].f
if (typeof global==="undefined")global={};global.f=$gdc(f_[path],"",1);
try{
main(env,{},root,global);
_tsd(root)
}catch(err){
console.log(err)
}
;g="";
return root;
}
}
}
}(__g.a,__g.b,__g.c,__g.d,__g.e,__g.f,__g.g,__g.h,__g.i,__g.j,__g.k,__g.l,__g.m,__g.n,__g.o,__g.p,__g.q,__g.r,__g.s,__g.t,__g.u,__g.v,__g.w,__g.x,__g.y,__g.z,__g.A,__g.B,__g.C,__g.D,__g.E,__g.F,__g.G,__g.H,__g.I,__g.J,__g.K,__g.L,__g.M,__g.N,__g.O,__g.P,__g.Q,__g.R,__g.S,__g.T,__g.U,__g.V,__g.W,__g.X,__g.Y,__g.Z,__g.aa);if(__vd_version_info__.delayedGwx||false)$gwx_XC_123();	if (__vd_version_info__.delayedGwx) __wxAppCode__['pages/share/poster/index.wxml'] = [$gwx_XC_123, './pages/share/poster/index.wxml'];else __wxAppCode__['pages/share/poster/index.wxml'] = $gwx_XC_123( './pages/share/poster/index.wxml' );
	;__wxRoute = "pages/share/poster/index";__wxRouteBegin = true;__wxAppCurrentFile__="pages/share/poster/index.js";define("pages/share/poster/index.js",function(require,module,exports,window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){
"use strict";require("../../../@babel/runtime/helpers/Arrayincludes");var e=require("../../../@babel/runtime/helpers/objectSpread2"),t=require("../../../@babel/runtime/helpers/regeneratorRuntime"),r=require("../../../@babel/runtime/helpers/asyncToGenerator"),n=getApp(),a={product:"juhe",industry:"juhe",juhe:"juhe",activity:"activity",index:"home",case:"case",warehouse:"tool",mine:"mine"},o="https://mkttencent-1256915710.file.myqcloud.com/saas/2022/04/24/1b5197036554e7cee1abea1e8b754b8b.jpeg";Page({data:{info:null,canvasInfo:{width:"750px",height:"1300px"},ImgInfo:{width:"750rpx",height:"1300rpx"},drawerPoster:!1,sharePoster:"",loading:!0},onLoad:function(e){wx.hideShareMenu({menus:["shareAppMessage","shareTimeline"]}),this.isCustom="custom"===e.type,this.customPath="pages/juhe/index",this.customScene="id=".concat(e.data_id,"&shareId=").concat(wx.getStorageSync("openid"));if(this.shareOption={data_id:e.data_id,cover_img:this.isCustom?"https://mkttencent-1256915710.file.myqcloud.com/uat/2022/06/17/8f8eb7685b2bdd5280e7c7ef3a6f255b.png":decodeURIComponent(e.cover_img),title:this.isCustom?"Techo Day腾讯技术开放日":decodeURIComponent(e.title),pageId:e.pageId,type:e.type,cid:e.cid},!e.data_id||["cooperation","brand"].includes(e.type))return this.drawCommonPoster({poster:"https://mkttencent-1256915710.file.myqcloud.com/saas/2022/04/24/1b5197036554e7cee1abea1e8b754b8b.jpeg"});this.getResourcePoster()},getPageType:function(){if(this.isCustom)return"juhe";var e=getCurrentPages(),t=e[e.length-2].route;if(t.indexOf("detail")>0)return"content";var r=t.split("/")[1];return a[r]||"content"},getResourcePoster:function(){var e=this;return r(t().mark((function r(){var a,s,c,i,u,f,d,h,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.shareOption.data_id,s=e.getPageType(),t.prev=2,t.next=5,n.API.getResourcePoster({data_id:a,type:s});case 5:c=t.sent,t.next=11;break;case 8:return t.prev=8,t.t0=t.catch(2),t.abrupt("return",e.drawCommonPoster({poster:o}));case 11:if(i=c.content,u=i.isSys,f=i.backImg,d=i.tip,h=i.isShowTitle,l=f&&(f.indexOf("https:")>-1?f:"https:"+f)||o,1!==u){t.next=15;break}return t.abrupt("return",e.drawCommonPoster({poster:l}));case 15:e.drawCustomPoster({poster:l,tip:d,isShowTitle:h});case 16:case"end":return t.stop()}}),r,null,[[2,8]])})))()},drawCustomPoster:function(e){var n=this;return r(t().mark((function r(){var a,o,s,c,i,u,f,d,h,l,p,x;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.poster,o=e.tip,s=e.isShowTitle,c=n.shareOption.title,console.log(a,"输出poster"),t.next=5,n.getBgPosterStyle(a);case 5:return i=t.sent,u=i.canvasW,f=i.canvasH,d=i.dpr,h=i.bgImg,t.next=12,n.initCanvas(u,f,d);case 12:return l=t.sent,p=l.context,n.context=p,t.next=17,n.drawPosterBg(h.path,u,f);case 17:return 1===s&&n.drawPosterTitle({text:c,pos:{x:48,y:68,w:510},step:40,textStyle:{font:"32px normal",fillStyle:"#ffffff"}}),x=f-300,t.next=21,n.drawArcQrcode({pos:{x:280,y:x,w:192,h:192},arc:{x:375,y:x+96,r:102}});case 21:n.drawText({text:o,pos:{x:375,y:f-64},textStyle:{font:"normal normal 24px sans-serif",color:"#ffffff",textAlign:"center"}}),n.generatePoster(u,f,d);case 23:case"end":return t.stop()}}),r)})))()},drawCommonPoster:function(e){var n=this;return r(t().mark((function r(){var a,o,s,c,i,u,f,d,h,l,p,x,g,w,m,v;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.poster,n,"https://mkttencent-1256915710.file.myqcloud.com/saas/2022/04/25/7d38fb8e00f6b543ebd0bae617c8d057.jpg",o=n.shareOption,s=o.title,c=o.cover_img,i="undefined"!==c&&c?c:"https://mkttencent-1256915710.file.myqcloud.com/saas/2022/04/25/7d38fb8e00f6b543ebd0bae617c8d057.jpg",u=wx.getStorageSync("userInfoNickname"),f=wx.getStorageSync("userInfoAvatarUrl"),t.next=9,n.getBgPosterStyle(a);case 9:return d=t.sent,h=d.canvasW,l=d.canvasH,p=d.dpr,x=d.bgImg,t.next=16,n.initCanvas(h,l,p);case 16:return g=t.sent,w=g.context,n.context=w,t.next=21,n.drawPosterBg(x.path,h,l);case 21:return m=n.drawPosterTitle({text:s,pos:{x:114,y:510,w:510},step:40,textStyle:{font:"32px normal",fillStyle:"#000000"}}),v=m.exarTextH,t.next=24,n.drawCoverImg({path:i,pos:{x:114,y:600+v,w:523,h:295}});case 24:return t.next=26,n.drawAvatar({path:f,arc:{x:143,y:143,r:70},pos:{x:81,y:81,w:124,h:124}});case 26:return n.drawText({text:u,pos:{x:143,y:243},textStyle:{font:"normal normal 29px sans-serif",color:"#ffffff",textAlign:"center"}}),t.next=29,n.drawQrcode({x:280,y:938+v,w:192,h:192});case 29:n.drawText({text:"长按识别了解更多",pos:{x:375,y:1164+v},textStyle:{font:"normal normal 24px sans-serif",color:"#000000",textAlign:"center"}}),v>0&&(n.context.fillStyle="#ffffff",n.context.fillRect(73,1226,604,v)),n.generatePoster(h,l,p);case 32:case"end":return t.stop()}}),r)})))()},initCanvas:function(e,n){return r(t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(a=wx.createCanvasContext("shareCanvas")).textAlign="left",a.textBaseline="middle",a.fillStyle="#ffffff",a.fillRect(0,0,e,n),t.abrupt("return",{context:a});case 6:case"end":return t.stop()}}),r)})))()},generatePoster:function(e,t,r){var n=this,a=this,o=Math.max(r-2,1);this.context.draw(),setTimeout((function(){wx.canvasToTempFilePath({canvasId:"shareCanvas",with:e,height:t,destWidth:e*o,destHeight:t*o,fail:function(e){console.log("🚀 ~ file: index.js ~ line 320 ~ fail ~ e",e),wx.showToast({title:"fail",icon:"none"}),a.setData({loading:!1})},success:function(e){n.setData({drawerPoster:!0,sharePoster:e.tempFilePath,loading:!1})}},n)}),500)},downLoadPic:function(e){return new Promise((function(t,r){wx.getImageInfo({src:e,success:t})}))},imageLongPress:function(){var e=this;wx.showActionSheet({itemList:["保存图片"],success:function(t){switch(t.tapIndex){case 0:e.savePosterToAlbum()}},fail:function(e){console.warn(e.errMsg)}})},savePosterToAlbum:function(){wx.saveImageToPhotosAlbum({filePath:this.data.sharePoster,success:function(){wx.showToast({title:"图片保存成功",icon:"none",duration:3e3})}})},getQuery:function(t,r){var a=["id","cid","shareId"],o=["cid","shareId","shareCardId","employeePhone","employeePosition","wechatId","wechatworkId"],s=[];s=n.tool.getShareCardPremise()?t.data.isShareCard?t.data.isShareMyInfo?[].concat(a):[].concat(a,o):[].concat(a):[].concat(a,o);var c=this.shareOption.pageId,i=e({},t.options);(i=i||{}).id||(i.id=c);var u=[];for(var f in i)s.includes(f)&&u.push("".concat(f,"=").concat(i[f]));for(var d in r)o.includes(d)&&u.push("".concat(d,"=").concat(r[d]));return u.join("&")},getMiniappQrcode:function(){var e=this;return r(t().mark((function r(){var a,o,s,c,i,u,f,d,h,l,p,x;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.shareOption.cid,o=getCurrentPages(),s=o[o.length-2],console.log("🚀 ~ file: index.js ~ line 446 ~ getMiniappQrcode ~ targetRoute",s),c={shareId:wx.getStorageSync("openid")},n.tool.getShareCardPremise()&&s.data.isShareCard&&s.data.isShareMyInfo){for(f in i={},u=s.data.shareCardInfo)u[f]&&(i[f]=1);c=Object.assign(c,i,{shareCardId:wx.getStorageSync("staff_card_id")})}return a&&(c.cid=a),d=e.isCustom?e.customScene:e.getQuery(s,c),console.log("🚀 ~ file: index.js ~ line 453 ~ getMiniappQrcode ~ scene",d),t.next=11,n.API.paramsToUuid(d);case 11:if(0==(h=t.sent).code){t.next=16;break}return t.next=15,e.getDefaultQrcode();case 15:return t.abrupt("return",t.sent);case 16:return l={scene:h.content.uuid,path:e.isCustom?e.customPath:s.route,width:258,envVersion:__wxConfig.envVersion},t.next=19,wx.cloud.callFunction({name:"getMiniAppQrcode",data:l});case 19:if(p=t.sent,console.log("share-btn miniappQrcode",l,p),"cloud.callFunction:ok"!=p.errMsg){t.next=35;break}return x=wx.arrayBufferToBase64(p.result.buffer),t.prev=23,t.abrupt("return",e.saveFileToTemp(x));case 27:return t.prev=27,t.t0=t.catch(23),console.log("fileRes error",t.t0),t.next=32,e.getDefaultQrcode();case 32:return t.abrupt("return",t.sent);case 33:t.next=38;break;case 35:return t.next=37,e.getDefaultQrcode();case 37:return t.abrupt("return",t.sent);case 38:case"end":return t.stop()}}),r,null,[[23,27]])})))()},saveFileToTemp:function(e){var t=wx.env.USER_DATA_PATH+"/"+(new Date).getTime()+"share.jpg",r=wx.getFileSystemManager();try{return r.writeFileSync(t,e,"base64"),t}catch(e){console.error(e),wx.showToast({text:"get qrcode fail",icon:"none"})}},getDefaultQrcode:function(){var e=this;return r(t().mark((function r(){var n;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.downLoadPic("https://mkttencent-1256915710.file.myqcloud.com/saas/cloud-mini/miniapp_qrcode.jpg");case 2:return n=t.sent,t.abrupt("return",n.path);case 4:case"end":return t.stop()}}),r)})))()},drawQrcode:function(e){var n=this;return r(t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.getMiniappQrcode();case 2:a=t.sent,n.context.drawImage(a,e.x,e.y,e.w,e.h);case 4:case"end":return t.stop()}}),r)})))()},drawArcQrcode:function(e){var n=this;return r(t().mark((function r(){var a,o,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.pos,o=e.arc,t.next=3,n.getMiniappQrcode();case 3:s=t.sent,n.context.save(),n.context.fillStyle="#ffffff",n.context.beginPath(),n.context.arc(o.x,o.y,o.r,0,2*Math.PI),n.context.fill(),n.context.restore(),n.context.save(),n.context.beginPath(),n.context.arc(o.x,o.y,o.r-6,0,2*Math.PI),n.context.clip(),n.context.drawImage(s,a.x,a.y,a.w,a.h),n.context.restore();case 16:case"end":return t.stop()}}),r)})))()},drawAvatar:function(e){var n=this;return r(t().mark((function r(){var a,o,s,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.path,o=e.arc,s=e.pos,t.next=3,n.downLoadPic(a);case 3:c=t.sent,n.context.save(),n.context.fillStyle="#ffffff",n.context.beginPath(),n.context.arc(o.x,o.y,o.r,0,2*Math.PI),n.context.fill(),n.context.restore(),n.context.save(),n.context.beginPath(),n.context.arc(o.x,o.y,o.r-6,0,2*Math.PI),n.context.clip(),n.context.drawImage(c.path,s.x,s.y,s.w,s.h),n.context.restore();case 16:case"end":return t.stop()}}),r)})))()},drawPosterTitle:function(e){var t=e.text,r=e.step,n=e.pos,a=e.textStyle,o=this,s=a.font,c=a.fillStyle;this.context.font=s,this.context.fillStyle=c;var i=(t||"腾讯云").split(""),u=[],f=n.w,d=i.reduce((function(e,t){var r="".concat(e).concat(t);return o.context.measureText(r).width>f?(u.push(e),t):r}));u.push(d),u.forEach((function(e,t){o.context.fillText(e,n.x,n.y+r*t)}));var h=u.length;return{exarTextH:r*(h-2<=0?0:h-2),lineGroup:u}},drawText:function(e){var t=e.text,r=e.pos,n=e.textStyle;this.context.textAlign=n.textAlign||"left",this.context.font=n.font,this.context.fillStyle=n.color,this.context.fillText(t,r.x,r.y)},drawCoverImg:function(e){var n=this;return r(t().mark((function r(){var a,o,s,c,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.path,o=e.pos,s=e.tarImgScale,n.context.save(),t.next=4,n.downLoadPic(a);case 4:c=t.sent,i=s&&Math.max(s.w/c.width,s.h/c.height)||1,n.context.drawImage(c.path,0,0,c.width/i,c.height/i,o.x,o.y,o.w,o.h);case 7:case"end":return t.stop()}}),r)})))()},getBgPosterStyle:function(e){var n=this;return r(t().mark((function r(){var a,o,s,c,i,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.downLoadPic(e);case 2:return a=t.sent,o=wx.getSystemInfoSync(),s=o.pixelRatio,c=o.screenWidth,750,i=750*a.height/a.width,u=c/750,n.setData({canvasInfo:{width:"750px",height:i+"px"},ImgInfo:{width:c+"px",height:i*u+"px"}}),t.abrupt("return",{canvasW:750,canvasH:i,dpr:s,bgImg:a});case 9:case"end":return t.stop()}}),r)})))()},drawPosterBg:function(e,n,a){var o=this;return r(t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o.context.drawImage(e,0,0,n,a),t.abrupt("return",!0);case 2:case"end":return t.stop()}}),r)})))()},getCanvasInstance:function(){var e=this;return new Promise((function(t){e.createSelectorQuery().select("#shareCanvas").fields({node:!0,size:!0}).exec((function(e){t(e[0].node)}))}))}});
},{isPage:true,isComponent:true,currentFile:'pages/share/poster/index.js'});require("pages/share/poster/index.js");