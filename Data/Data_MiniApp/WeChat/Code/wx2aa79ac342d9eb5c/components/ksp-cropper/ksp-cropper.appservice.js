$gwx_XC_3=function(_,_v,_n,_p,_s,_wp,_wl,$gwn,$gwl,$gwh,wh,$gstack,$gwrt,gra,grb,TestTest,wfor,_ca,_da,_r,_rz,_o,_oz,_1,_1z,_2,_2z,_m,_mz,nv_getDate,nv_getRegExp,nv_console,nv_parseInt,nv_parseFloat,nv_isNaN,nv_isFinite,nv_decodeURI,nv_decodeURIComponent,nv_encodeURI,nv_encodeURIComponent,$gdc,nv_JSON,_af,_gv,_ai,_grp,_gd,_gapi,$ixc,_ic,_w,_ev,_tsd){return function(path,global){
if(typeof global==='undefined'){if (typeof __GWX_GLOBAL__==='undefined')global={};else global=__GWX_GLOBAL__;}if(typeof __WXML_GLOBAL__ === 'undefined') {__WXML_GLOBAL__={};
}__WXML_GLOBAL__.modules = __WXML_GLOBAL__.modules || {};
var e_={}
if(typeof(global.entrys)==='undefined')global.entrys={};e_=global.entrys;
var d_={}
if(typeof(global.defines)==='undefined')global.defines={};d_=global.defines;
var f_={}
if(typeof(global.modules)==='undefined')global.modules={};f_=global.modules || {};
var p_={}
__WXML_GLOBAL__.ops_cached = __WXML_GLOBAL__.ops_cached || {}
__WXML_GLOBAL__.ops_set = __WXML_GLOBAL__.ops_set || {};
__WXML_GLOBAL__.ops_init = __WXML_GLOBAL__.ops_init || {};
var z=__WXML_GLOBAL__.ops_set.$gwx_XC_3 || [];
function gz$gwx_XC_3_1(){
if( __WXML_GLOBAL__.ops_cached.$gwx_XC_3_1)return __WXML_GLOBAL__.ops_cached.$gwx_XC_3_1
__WXML_GLOBAL__.ops_cached.$gwx_XC_3_1=[];
(function(z){var a=11;function Z(ops){z.push(ops)}
})(__WXML_GLOBAL__.ops_cached.$gwx_XC_3_1);return __WXML_GLOBAL__.ops_cached.$gwx_XC_3_1
}
__WXML_GLOBAL__.ops_set.$gwx_XC_3=z;
__WXML_GLOBAL__.ops_init.$gwx_XC_3=true;
var x=['./components/ksp-cropper/ksp-cropper.wxml'];d_[x[0]]={}
var m0=function(e,s,r,gg){
var z=gz$gwx_XC_3_1()
return r
}
e_[x[0]]={f:m0,j:[],i:[],ti:[],ic:[]}
if(path&&e_[path]){
return function(env,dd,global){$gwxc=0;var root={"tag":"wx-page"};root.children=[]
;g="$gwx_XC_3";var main=e_[path].f
if (typeof global==="undefined")global={};global.f=$gdc(f_[path],"",1);
try{
main(env,{},root,global);
_tsd(root)
}catch(err){
console.log(err)
}
;g="";
return root;
}
}
}
}(__g.a,__g.b,__g.c,__g.d,__g.e,__g.f,__g.g,__g.h,__g.i,__g.j,__g.k,__g.l,__g.m,__g.n,__g.o,__g.p,__g.q,__g.r,__g.s,__g.t,__g.u,__g.v,__g.w,__g.x,__g.y,__g.z,__g.A,__g.B,__g.C,__g.D,__g.E,__g.F,__g.G,__g.H,__g.I,__g.J,__g.K,__g.L,__g.M,__g.N,__g.O,__g.P,__g.Q,__g.R,__g.S,__g.T,__g.U,__g.V,__g.W,__g.X,__g.Y,__g.Z,__g.aa);if(__vd_version_info__.delayedGwx||false)$gwx_XC_3();	if (__vd_version_info__.delayedGwx) __wxAppCode__['components/ksp-cropper/ksp-cropper.wxml'] = [$gwx_XC_3, './components/ksp-cropper/ksp-cropper.wxml'];else __wxAppCode__['components/ksp-cropper/ksp-cropper.wxml'] = $gwx_XC_3( './components/ksp-cropper/ksp-cropper.wxml' );
	;__wxRoute = "components/ksp-cropper/ksp-cropper";__wxRouteBegin = true;__wxAppCurrentFile__="components/ksp-cropper/ksp-cropper.js";define("components/ksp-cropper/ksp-cropper.js",function(require,module,exports,window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){
"use strict";var t=require("../../@babel/runtime/helpers/regeneratorRuntime"),e=require("../../@babel/runtime/helpers/asyncToGenerator"),i=require("../../common/vendor.js"),h={props:{mode:{type:String,default:"free"},url:{type:String,default:""},width:{type:Number,default:200},height:{type:Number,default:200},maxWidth:{type:Number,default:1024},maxHeight:{type:Number,default:1024}},data:function(){return{canvasId:Math.random().toString(36).slice(-6),real:{width:100,height:100},target:{width:100,height:100},body:{width:100,height:100},frame:{left:50,top:50,width:200,height:300},image:{left:20,top:20,width:300,height:400},rotate:0,transit:!1,modeValue:""}},methods:{imageLoad:function(t){var e=this;i.index.getImageInfo({src:this.url,success:function(t){e.real.width=t.width,e.real.height=t.height,e.target={},i.index.createSelectorQuery().in(e).select(".body").boundingClientRect((function(t){e.body.width=t.width,e.body.height=t.height,e.init()})).exec()}})},init:function(){this.modeValue=this.mode,this.rotate=0;var t=this.width/this.height,e=1*this.body.width,i=1.3*this.body.height;e/i>t?e=i*t:i=e/t;var h=(this.body.width-e)/2,a=(this.body.height-i)/2;this.frame={left:h,top:a,width:e,height:i},t=this.real.width/this.real.height,(e=this.frame.width)/(i=this.frame.height)>t?i=e/t:e=i*t,h=(this.frame.width-e)/2+this.frame.left,a=(this.frame.height-i)/2+this.frame.top,this.image={left:h,top:a,width:e,height:i}},updateData:function(i){var h=this;return e(t().mark((function e(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return h.frame=i.frame,h.image=i.image,t.next=4,h.$nextTick();case 4:h.trimImage();case 5:case"end":return t.stop()}}),e)})))()},trimImage:function(){var t=this,e=this.frame.width/this.frame.height,i=1*this.body.width,h=1.3*this.body.height;i/h>e?i=h*e:h=i/e;var a=(this.body.width-i)/2,r=(this.body.height-h)/2,s=i/this.frame.width,n=this.frame.left-this.image.left,o=this.frame.top-this.image.top;this.frame={left:a,top:r,width:i,height:h},i=this.image.width*s,h=this.image.height*s,a=this.frame.left-n*s,r=this.frame.top-o*s,this.image={left:a,top:r,width:i,height:h},1!=s&&(this.transit=!0,setTimeout((function(){t.transit=!1}),300))},rotateAngle:function(){var t=this;this.rotate-=90;var e=this.image.height,i=this.image.width,h=this.image.left,a=this.image.top,r=e/i;e<this.frame.width&&(i=(e=this.frame.width)/r),i<this.frame.height&&(e=(i=this.frame.height)*r),h>this.frame.left&&(h=this.frame.left),a>this.frame.top&&(a=this.frame.top),h+e<this.frame.left+this.frame.width&&(h=this.frame.left+this.frame.width-e),a+i<this.frame.top+this.frame.height&&(a=this.frame.top+this.frame.height-i),this.image={left:h,top:a,width:e,height:i},this.transit=!0,setTimeout((function(){t.transit=!1}),300)},onok:function(){this.cropWx()},oncancle:function(){this.$emit("cancel")},cropWx:function(){var h=this;return e(t().mark((function e(){var a,r,s,n;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=h.computeMatrix(),h.target={width:a.tw,height:a.th},t.next=4,new Promise((function(t){i.index.createSelectorQuery().in(h).select(".canvas").fields({node:!0}).exec((function(e){var i=e[0].node;t(i)}))}));case 4:return(r=t.sent).width=a.tw,r.height=a.th,t.next=9,new Promise((function(t){setTimeout(t,200)}));case 9:return s=r.getContext("2d"),n=r.createImage(),t.next=12,new Promise((function(t,e){n.onload=t,n.onerror=e,n.src=h.url}));case 12:s.save(),s.rotate(h.rotate*Math.PI/180),s.drawImage(n,a.sx,a.sy,a.sw,a.sh,a.dx,a.dy,a.dw,a.dh),s.restore(),i.wx$1.canvasToTempFilePath({canvas:r,fileType:"jpg",success:function(t){var e=t.tempFilePath;h.$emit("ok",{path:e})},complete:function(){}});case 17:case"end":return t.stop()}}),e)})))()},cropAppH5:function(){var h=this;return e(t().mark((function e(){var a,r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=h.computeMatrix(),h.target={width:a.tw,height:a.th},t.next=4,new Promise((function(t){setTimeout((function(){t()}),200)}));case 4:return(r=i.index.createCanvasContext(h.canvasId,h)).save(),r.rotate(h.rotate*Math.PI/180),r.drawImage(h.url,a.sx,a.sy,a.sw,a.sh,a.dx,a.dy,a.dw,a.dh),r.restore(),t.next=11,new Promise((function(t){r.draw(!1,(function(){t()}))}));case 11:i.index.canvasToTempFilePath({canvasId:h.canvasId,destWidth:a.tw,destHeight:a.th,fileType:"jpg",success:function(t){t.tempFilePath},complete:function(){}},h);case 12:case"end":return t.stop()}}),e)})))()},computeMatrix:function(){var t=this.width,e=this.height,i=this.image.width/this.real.width;this.rotate%180!=0&&(i=this.image.height/this.real.width),"fixed"!=this.mode&&(t=this.frame.width/i,e=this.frame.height/i);var h=t/e;t>this.maxWidth&&(e=(t=this.maxWidth)/h),e>this.maxHeight&&(t=(e=this.maxHeight)*h);var a=(this.frame.left-this.image.left)/i,r=(this.frame.top-this.image.top)/i,s=this.frame.width/i,n=this.frame.height/i,o=a+s/2,d=r+n/2;if(this.rotate%180!=0){var f=s;s=n,n=f}var m=this.rotate%360;if(m<0&&(m+=360),270==m){var c=o;o=u=this.real.width-d,d=c}if(180==m&&(o=u=this.real.width-o,d=c=this.real.height-d),90==m){var u=d;c=this.real.height-o,o=u,d=c}var g={x:0,y:0,w:t,h:e};return{tw:t,th:e,sx:a=o-s/2,sy:r=d-n/2,sw:s,sh:n,dx:(g=this.parseRect(g,-this.rotate)).x,dy:g.y,dw:g.w,dh:g.h}},parsePoint:function(t,e){var i={};return i.x=t.x*Math.cos(e*Math.PI/180)-t.y*Math.sin(e*Math.PI/180),i.y=t.y*Math.cos(e*Math.PI/180)+t.x*Math.sin(e*Math.PI/180),i},parseRect:function(t,e){var i=t.x,h=t.y,a=t.x+t.w,r=t.y+t.h,s=this.parsePoint({x:i,y:h},e),n=this.parsePoint({x:a,y:r},e),o={};return o.x=Math.min(s.x,n.x),o.y=Math.min(s.y,n.y),o.w=Math.abs(n.x-s.x),o.h=Math.abs(n.y-s.y),o},parseBlob:function(t){for(var e=t.split(","),i=e[0].match(/:(.*?);/)[1],h=atob(e[1]),a=h.length,r=new Uint8Array(a),s=0;s<a;s++)r[s]=h.charCodeAt(s);return(URL||webkitURL).createObjectURL(new Blob([r],{type:i}))}}};!function(t){t.wxsCallMethods||(t.wxsCallMethods=[]),t.wxsCallMethods.push("updateData")}(h);var a=i._export_sfc(h,[["render",function(t,e,h,a,r,s){return{a:r.target.width+"px",b:r.target.height+"px",c:r.transit?1:"",d:h.url,e:i.o((function(){return s.imageLoad&&s.imageLoad.apply(s,arguments)})),f:r.transit?1:"",g:r.image,h:r.transit?1:"",i:h.url,j:r.transit?1:"",k:r.transit?1:"",l:r.frame,m:i.o((function(){return s.oncancle&&s.oncancle.apply(s,arguments)})),n:i.o((function(){return s.onok&&s.onok.apply(s,arguments)})),o:h.url,p:r.modeValue,q:r.rotate}}],["__scopeId","data-v-2ca2396f"]]);wx.createComponent(a);
},{isPage:false,isComponent:true,currentFile:'components/ksp-cropper/ksp-cropper.js'});require("components/ksp-cropper/ksp-cropper.js");