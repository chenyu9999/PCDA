$gwx_XC_193=function(_,_v,_n,_p,_s,_wp,_wl,$gwn,$gwl,$gwh,wh,$gstack,$gwrt,gra,grb,TestTest,wfor,_ca,_da,_r,_rz,_o,_oz,_1,_1z,_2,_2z,_m,_mz,nv_getDate,nv_getRegExp,nv_console,nv_parseInt,nv_parseFloat,nv_isNaN,nv_isFinite,nv_decodeURI,nv_decodeURIComponent,nv_encodeURI,nv_encodeURIComponent,$gdc,nv_JSON,_af,_gv,_ai,_grp,_gd,_gapi,$ixc,_ic,_w,_ev,_tsd){return function(path,global){
if(typeof global==='undefined'){if (typeof __GWX_GLOBAL__==='undefined')global={};else global=__GWX_GLOBAL__;}if(typeof __WXML_GLOBAL__ === 'undefined') {__WXML_GLOBAL__={};
}__WXML_GLOBAL__.modules = __WXML_GLOBAL__.modules || {};
var e_={}
if(typeof(global.entrys)==='undefined')global.entrys={};e_=global.entrys;
var d_={}
if(typeof(global.defines)==='undefined')global.defines={};d_=global.defines;
var f_={}
if(typeof(global.modules)==='undefined')global.modules={};f_=global.modules || {};
var p_={}
__WXML_GLOBAL__.ops_cached = __WXML_GLOBAL__.ops_cached || {}
__WXML_GLOBAL__.ops_set = __WXML_GLOBAL__.ops_set || {};
__WXML_GLOBAL__.ops_init = __WXML_GLOBAL__.ops_init || {};
var z=__WXML_GLOBAL__.ops_set.$gwx_XC_193 || [];
function gz$gwx_XC_193_1(){
if( __WXML_GLOBAL__.ops_cached.$gwx_XC_193_1)return __WXML_GLOBAL__.ops_cached.$gwx_XC_193_1
__WXML_GLOBAL__.ops_cached.$gwx_XC_193_1=[];
(function(z){var a=11;function Z(ops){z.push(ops)}
Z([[7],[3,'isLogin']])
Z([3,'im-content'])
Z([[7],[3,'scrollPosition']])
Z([[7],[3,'showPrevMore']])
Z([3,'i'])
Z([3,'content'])
Z([[7],[3,'contents']])
Z([3,'id'])
Z([a,[3,'message-inner-holder '],[[2,'?:'],[[2,'==='],[[7],[3,'i']],[1,0]],[1,'first'],[1,'']]])
Z([[2,'=='],[[6],[[6],[[7],[3,'content']],[3,'user_info']],[3,'role']],[1,'doctor']])
Z([3,'qa-list__right'])
Z([[2,'=='],[[6],[[7],[3,'content']],[3,'format']],[1,'image']])
Z([[2,'=='],[[6],[[7],[3,'content']],[3,'format']],[1,'text']])
Z([3,'onLinkTap'])
Z([[2,'||'],[[6],[[6],[[7],[3,'content']],[3,'content']],[3,'h5_text']],[[6],[[6],[[7],[3,'content']],[3,'content']],[3,'text']]])
Z([1,false])
Z([[2,'=='],[[6],[[7],[3,'content']],[3,'format']],[1,'common_card']])
Z([3,'jumpH5'])
Z([3,'qa-list__content qa-list__content-card'])
Z([[6],[[6],[[7],[3,'content']],[3,'content']],[3,'url']])
Z([a,[3,'qa-'],[[7],[3,'i']]])
Z([3,'price'])
Z([[2,'&&'],[[6],[[6],[[7],[3,'content']],[3,'content']],[3,'desc']],[[2,'!=='],[[6],[[6],[[7],[3,'content']],[3,'content']],[3,'desc']],[1,'']]])
Z([[6],[[6],[[7],[3,'content']],[3,'content']],[3,'desc']])
Z([[6],[[6],[[7],[3,'content']],[3,'content']],[3,'status_verbose']])
Z(z[11])
Z(z[12])
Z([[6],[[6],[[7],[3,'content']],[3,'content']],[3,'text']])
Z([3,'pointLogin'])
Z([3,'init'])
})(__WXML_GLOBAL__.ops_cached.$gwx_XC_193_1);return __WXML_GLOBAL__.ops_cached.$gwx_XC_193_1
}
__WXML_GLOBAL__.ops_set.$gwx_XC_193=z;
__WXML_GLOBAL__.ops_init.$gwx_XC_193=true;
var x=['./pages/qa_im_infinite/index.wxml'];d_[x[0]]={}
var m0=function(e,s,r,gg){
var z=gz$gwx_XC_193_1()
var bITB=_v()
_(r,bITB)
if(_oz(z,0,e,s,gg)){bITB.wxVkey=1
var oJTB=_mz(z,'scroll-view',['enableBackToTop',-1,'scrollWithAnimation',-1,'scrollY',-1,'class',1,'scrollIntoView',1],[],e,s,gg)
var xKTB=_v()
_(oJTB,xKTB)
if(_oz(z,3,e,s,gg)){xKTB.wxVkey=1
}
var oLTB=_v()
_(oJTB,oLTB)
var fMTB=function(hOTB,cNTB,oPTB,gg){
var oRTB=_n('view')
_rz(z,oRTB,'class',8,hOTB,cNTB,gg)
var lSTB=_v()
_(oRTB,lSTB)
if(_oz(z,9,hOTB,cNTB,gg)){lSTB.wxVkey=1
var aTTB=_n('view')
_rz(z,aTTB,'class',10,hOTB,cNTB,gg)
var tUTB=_v()
_(aTTB,tUTB)
if(_oz(z,11,hOTB,cNTB,gg)){tUTB.wxVkey=1
}
var eVTB=_v()
_(aTTB,eVTB)
if(_oz(z,12,hOTB,cNTB,gg)){eVTB.wxVkey=1
var oXTB=_mz(z,'mp-html',['bind:linktap',13,'content',1,'copyLink',2],[],hOTB,cNTB,gg)
_(eVTB,oXTB)
}
var bWTB=_v()
_(aTTB,bWTB)
if(_oz(z,16,hOTB,cNTB,gg)){bWTB.wxVkey=1
var xYTB=_mz(z,'view',['bindtap',17,'class',1,'data-url',2,'id',3],[],hOTB,cNTB,gg)
var oZTB=_n('view')
_rz(z,oZTB,'class',21,hOTB,cNTB,gg)
var f1TB=_v()
_(oZTB,f1TB)
if(_oz(z,22,hOTB,cNTB,gg)){f1TB.wxVkey=1
var h3TB=_n('mp-html')
_rz(z,h3TB,'content',23,hOTB,cNTB,gg)
_(f1TB,h3TB)
}
var c2TB=_v()
_(oZTB,c2TB)
if(_oz(z,24,hOTB,cNTB,gg)){c2TB.wxVkey=1
}
f1TB.wxXCkey=1
f1TB.wxXCkey=3
c2TB.wxXCkey=1
_(xYTB,oZTB)
_(bWTB,xYTB)
}
tUTB.wxXCkey=1
eVTB.wxXCkey=1
eVTB.wxXCkey=3
bWTB.wxXCkey=1
bWTB.wxXCkey=3
_(lSTB,aTTB)
}
else{lSTB.wxVkey=2
var o4TB=_v()
_(lSTB,o4TB)
if(_oz(z,25,hOTB,cNTB,gg)){o4TB.wxVkey=1
}
var c5TB=_v()
_(lSTB,c5TB)
if(_oz(z,26,hOTB,cNTB,gg)){c5TB.wxVkey=1
var o6TB=_n('mp-html')
_rz(z,o6TB,'content',27,hOTB,cNTB,gg)
_(c5TB,o6TB)
}
o4TB.wxXCkey=1
c5TB.wxXCkey=1
c5TB.wxXCkey=3
}
lSTB.wxXCkey=1
lSTB.wxXCkey=3
lSTB.wxXCkey=3
_(oPTB,oRTB)
return oPTB
}
oLTB.wxXCkey=4
_2z(z,6,fMTB,e,s,gg,oLTB,'content','i','id')
xKTB.wxXCkey=1
_(bITB,oJTB)
}
else{bITB.wxVkey=2
var l7TB=_mz(z,'cy-userinfo',['bindisloginevent',28,'bindloginevent',1],[],e,s,gg)
_(bITB,l7TB)
}
bITB.wxXCkey=1
bITB.wxXCkey=3
bITB.wxXCkey=3
return r
}
e_[x[0]]={f:m0,j:[],i:[],ti:[],ic:[]}
if(path&&e_[path]){
return function(env,dd,global){$gwxc=0;var root={"tag":"wx-page"};root.children=[]
;g="$gwx_XC_193";var main=e_[path].f
if (typeof global==="undefined")global={};global.f=$gdc(f_[path],"",1);
try{
main(env,{},root,global);
_tsd(root)
}catch(err){
console.log(err)
}
;g="";
return root;
}
}
}
}(__g.a,__g.b,__g.c,__g.d,__g.e,__g.f,__g.g,__g.h,__g.i,__g.j,__g.k,__g.l,__g.m,__g.n,__g.o,__g.p,__g.q,__g.r,__g.s,__g.t,__g.u,__g.v,__g.w,__g.x,__g.y,__g.z,__g.A,__g.B,__g.C,__g.D,__g.E,__g.F,__g.G,__g.H,__g.I,__g.J,__g.K,__g.L,__g.M,__g.N,__g.O,__g.P,__g.Q,__g.R,__g.S,__g.T,__g.U,__g.V,__g.W,__g.X,__g.Y,__g.Z,__g.aa);if(__vd_version_info__.delayedGwx||false)$gwx_XC_193();	if (__vd_version_info__.delayedGwx) __wxAppCode__['pages/qa_im_infinite/index.wxml'] = [$gwx_XC_193, './pages/qa_im_infinite/index.wxml'];else __wxAppCode__['pages/qa_im_infinite/index.wxml'] = $gwx_XC_193( './pages/qa_im_infinite/index.wxml' );
	;__wxRoute = "pages/qa_im_infinite/index";__wxRouteBegin = true;__wxAppCurrentFile__="pages/qa_im_infinite/index.js";define("pages/qa_im_infinite/index.js",function(require,module,exports,window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){
"use strict";var t=require("../../43A2F676829A079C25C49E711B4C7B70.js"),e=getApp(),o=require("../../BC983DD1829A079CDAFE55D6E84D7B70.js").baseUrl,n=require("../../92BC1755829A079CF4DA7F52C55D7B70.js").param,a=o+"/api/chat/conversation/detail/",i=o+"/api/chat/content/create/",s=o+"/files/upload_multi_image/",r=require("../../56F44BB4829A079C309223B3039D7B70.js").WEBSOCKET_URL;Page({data:{isLogin:!1,back_up_level:"0",showPrevMore:!1,partner:e.globalData.partner,doctor_info:null,lastQAId:-1,loading_hidden:!0,toast_hidden:!0,error_msg:"",problem_id:"",contents:[],interval:1e4,hasInputed:!1,icon_selected:-1,func_hidden:!0,newQuestionText:"",audio_hidden:!0,audioTip_hidden:!0,audio_text:"按住说话",audioTipText:"手指上划，取消发送",bg:"#11bd4b",audioTipBg:"#11bd4b",record_time:0,audio_timer:null,ifSendVoice:!0,currentAudioIndex:0,playOrNot:!1,audioId:"",audioIndex:-1,audioObj:null,paddingBottom:100,platform:"",footerBottom:null,is_problem_user:"",display:"hide",btn_text:"我要问医生",img_display:"show",free_display:"hide",has_img_ans:"hide",no_img_ans:"hide",jump_url:"",tag:"imgask",isRefundTrans:!1,isRefund:!1,footer:"",contentHeight:485,scrollPosition:"qa_0",adjusLayerHidden:!0,multiArray:[],multiIndex:[0,0],showClinicAdjustment:!1,timerCount:8,clinicName:"",clinicNo:"",clinicSecondNo:"",disclaimer:!1,conversationStatus:"online"},linkToRecDocList:function(){var t=this.data.problem_id;wx.navigateTo({url:"../rec_doc_list/index?from_type=1&problem_id="+t})},init:function(){var t=this;t.setData({isLogin:!0,doctor_info:e.globalData.doctor_info}),setTimeout((function(){t.ajaxQA(),t.initWebsocketEvent()}))},initWebsocketEvent:function(){var t=this;wx.onSocketMessage((function(e){"common_conversation_new_content"==(e=JSON.parse(e.data)).msg_type?t.appendContent(e):"common_conversation_refresh"==e.msg_type&&(t.data.contents=[],t.ajaxQA())}))},getPrevQa:function(){this.data.lastQAId=this.data.contents[0].id,this.ajaxQA(!0)},jumpH5:function(t){var e=t.currentTarget.dataset.url||"",n=e.startsWith("http")?e:o+e;n=encodeURIComponent(n),wx.navigateTo({url:"/pages/h5_webview/index?url="+n})},ajaxQA:function(t){wx.hideLoading();var o=this,n=o.data.problem_id,i=o.data.lastQAId;wx.request({url:a,method:"GET",header:{Cookie:e.globalData.sessionid},data:{conversation_id:n,last_id:i,direction:t?"up":"down",count:20},success:function(e){var n=e.data.message_list;o.setData({showPrevMore:n&&n.length>=20,conversationStatus:e.data.conversation_status}),t?o.appendPrevContent(e.data):o.updateContent(e.data),"medicine_sale"==e.data.conversation_type?wx.setNavigationBarTitle({title:e.data.doctor_info&&e.data.doctor_info.name||"购药助手"}):wx.setNavigationBarTitle({title:"名院专家预约助手"})}})},scrollToBottom:function(){var t=this.data.contents.length;if(t){var e="qa-"+(t-1),o=this.data.contents[t-1];"image"===o.format&&(e+="-"+(o.content.urls.length-1)),this.setData({scrollPosition:e})}},updateContent:function(t){if(0===t.error_code){var e={contents:t.message_list,doctor_info:t.doctor_info};e.contents.map((function(t){if("text"===t.content.type){console.log(t.content.text,"替换前");var e=t.content.text.replace(/\n/g,"<br>");t.content.text=e}})),console.log(e.contents,"data"),this.setData(e,this.scrollToBottom)}else this.setData({error_msg:t.error_msg})},appendContent:function(t){var e=this.data.contents.map((function(t){return t.id}));if(t.body.message_list=t.body.message_list.filter((function(t){return-1===e.indexOf(t.id)})),t.body.message_list.length){var o={error_code:0,message_list:this.data.contents};o.message_list.push(t.body.message_list[0]),this.updateContent(o)}},appendPrevContent:function(t){this.setData({contents:[].concat(t.message_list||[],this.data.contents)})},questionInput:function(t){var e=t.detail.value;this.setData({newQuestionText:e,hasInputed:""!=e})},sel_img:function(){if("online"===this.data.conversationStatus){var t=this;wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(o){var n=o.tempFilePaths;wx.uploadFile({url:s,filePath:n[0],name:"images",formData:{return_full:"true"},header:{Cookie:e.globalData.sessionid},success:function(e){var o=JSON.parse(e.data).files[0],n={conversation_id:t.data.problem_id,content:JSON.stringify({urls:[o]}),format:"image",role:"patient"};t.sendQuestion(n)}})}})}},previewImg:function(t){var e=t.currentTarget.dataset.src,o=[];o.push(e),wx.previewImage({current:e,urls:o})},sendText:function(t){if(this.data.hasInputed){var e={conversation_id:this.data.problem_id,content:JSON.stringify({text:this.data.newQuestionText}),format:"text",role:"patient"};this.setData({footerBottom:0}),this.sendQuestion(e)}},sendQuestion:function(t){var o=this;wx.request({url:i,method:"POST",data:n(t),header:{"Content-Type":"application/x-www-form-urlencoded",Cookie:e.globalData.sessionid},success:function(){o.setData({newQuestionText:"",hasInputed:!1}),o.ajaxQA()}})},onLoad:function(o){wx.showLoading({title:"加载中..."});var n=this;n.setData({back_up_level:o.back_up_level,problem_id:o&&o.problem_id?o.problem_id:e.globalData.problem_id}),(0,t.manualLogin)().then((function(){n.init(),n.initWebSocket(),wx.getSystemInfo({success:function(t){n.setData({platform:t.platform,model:t.model,windowHeight:t.windowHeight?t.windowHeight:t.screenHeight,windowWidth:t.windowWidth?t.windowWidth:t.screenWidth})}})}),(function(){n.setData({isLogin:!1})}))},onUnload:function(){"0"===this.data.back_up_level&&wx.switchTab({url:"/pages/all_service/index"})},initWebSocket:function(){var t=e.globalData.sessionid;e.globalData.socketOpen||wx.connectSocket({url:r,header:{"content-type":"application/json",cookie:t},method:"GET",success:function(){console.log("----socket成功建立连接"),e.globalData.socketOpen=!0}}),wx.onSocketOpen((function(t){console.log(t),e.globalData.socketOpen=!0})),wx.onSocketError((function(t){console.log(t)})),wx.onSocketClose((function(o){console.log(o),e.globalData.reConnectCount>50||setTimeout((function(){e.globalData.reConnectCount+=1,wx.connectSocket({url:r,header:{"content-type":"application/json",cookie:t},method:"GET"})}),5e3)}))},onLinkTap:function(t){console.log(t);var e=t.detail.href;wx.navigateTo({url:"/pages/h5_webview/index?url=".concat(encodeURIComponent(e))})}});
},{isPage:true,isComponent:true,currentFile:'pages/qa_im_infinite/index.js'});require("pages/qa_im_infinite/index.js");