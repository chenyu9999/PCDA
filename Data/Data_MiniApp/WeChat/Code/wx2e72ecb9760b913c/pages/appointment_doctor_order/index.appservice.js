$gwx_XC_48=function(_,_v,_n,_p,_s,_wp,_wl,$gwn,$gwl,$gwh,wh,$gstack,$gwrt,gra,grb,TestTest,wfor,_ca,_da,_r,_rz,_o,_oz,_1,_1z,_2,_2z,_m,_mz,nv_getDate,nv_getRegExp,nv_console,nv_parseInt,nv_parseFloat,nv_isNaN,nv_isFinite,nv_decodeURI,nv_decodeURIComponent,nv_encodeURI,nv_encodeURIComponent,$gdc,nv_JSON,_af,_gv,_ai,_grp,_gd,_gapi,$ixc,_ic,_w,_ev,_tsd){return function(path,global){
if(typeof global==='undefined'){if (typeof __GWX_GLOBAL__==='undefined')global={};else global=__GWX_GLOBAL__;}if(typeof __WXML_GLOBAL__ === 'undefined') {__WXML_GLOBAL__={};
}__WXML_GLOBAL__.modules = __WXML_GLOBAL__.modules || {};
var e_={}
if(typeof(global.entrys)==='undefined')global.entrys={};e_=global.entrys;
var d_={}
if(typeof(global.defines)==='undefined')global.defines={};d_=global.defines;
var f_={}
if(typeof(global.modules)==='undefined')global.modules={};f_=global.modules || {};
var p_={}
__WXML_GLOBAL__.ops_cached = __WXML_GLOBAL__.ops_cached || {}
__WXML_GLOBAL__.ops_set = __WXML_GLOBAL__.ops_set || {};
__WXML_GLOBAL__.ops_init = __WXML_GLOBAL__.ops_init || {};
var z=__WXML_GLOBAL__.ops_set.$gwx_XC_48 || [];
function gz$gwx_XC_48_1(){
if( __WXML_GLOBAL__.ops_cached.$gwx_XC_48_1)return __WXML_GLOBAL__.ops_cached.$gwx_XC_48_1
__WXML_GLOBAL__.ops_cached.$gwx_XC_48_1=[];
(function(z){var a=11;function Z(ops){z.push(ops)}
Z([[2,'&&'],[[7],[3,'dialogVisible']],[1,'no-scroll']])
Z([3,'handleSubmit'])
Z([3,'form'])
Z([3,'imgs-wrapper'])
Z([[7],[3,'imgList']])
Z(z[4])
Z([[2,'!'],[[7],[3,'isDisabled']]])
Z([[2,'&&'],[[2,'<'],[[6],[[7],[3,'imgList']],[3,'length']],[1,9]],[[2,'!'],[[7],[3,'isDisabled']]]])
Z([3,'addImg'])
Z([[2,'&&'],[[2,'!'],[[6],[[7],[3,'imgList']],[3,'length']]],[[2,'!'],[[7],[3,'isDisabled']]]])
Z([[7],[3,'isShowSupplementDes']])
Z([[2,'!=='],[[7],[3,'type']],[1,'view']])
Z([3,'handleMakeNoticeDialogCancel'])
Z([3,'finallySubmit'])
Z([[7],[3,'makeNoticeDialogVisible']])
})(__WXML_GLOBAL__.ops_cached.$gwx_XC_48_1);return __WXML_GLOBAL__.ops_cached.$gwx_XC_48_1
}
__WXML_GLOBAL__.ops_set.$gwx_XC_48=z;
__WXML_GLOBAL__.ops_init.$gwx_XC_48=true;
var x=['./pages/appointment_doctor_order/index.wxml'];d_[x[0]]={}
var m0=function(e,s,r,gg){
var z=gz$gwx_XC_48_1()
var o8K=_n('view')
_rz(z,o8K,'class',0,e,s,gg)
var x9K=_n('appointment-doctor-header')
_(o8K,x9K)
var o0K=_mz(z,'form',['bindsubmit',1,'class',1],[],e,s,gg)
var hCL=_n('view')
_rz(z,hCL,'class',3,e,s,gg)
var oFL=_v()
_(hCL,oFL)
var lGL=function(tIL,aHL,eJL,gg){
var oLL=_v()
_(eJL,oLL)
if(_oz(z,6,tIL,aHL,gg)){oLL.wxVkey=1
}
oLL.wxXCkey=1
return eJL
}
oFL.wxXCkey=2
_2z(z,4,lGL,e,s,gg,oFL,'item','index','{{imgList}}')
var oDL=_v()
_(hCL,oDL)
if(_oz(z,7,e,s,gg)){oDL.wxVkey=1
var xML=_n('cy-userinfo')
_rz(z,xML,'bindloginevent',8,e,s,gg)
_(oDL,xML)
}
var cEL=_v()
_(hCL,cEL)
if(_oz(z,9,e,s,gg)){cEL.wxVkey=1
}
oDL.wxXCkey=1
oDL.wxXCkey=3
cEL.wxXCkey=1
_(o0K,hCL)
var fAL=_v()
_(o0K,fAL)
if(_oz(z,10,e,s,gg)){fAL.wxVkey=1
}
var cBL=_v()
_(o0K,cBL)
if(_oz(z,11,e,s,gg)){cBL.wxVkey=1
}
fAL.wxXCkey=1
cBL.wxXCkey=1
_(o8K,o0K)
var oNL=_mz(z,'make-notice',['bind:cancel',12,'bind:ok',1,'visible',2],[],e,s,gg)
_(o8K,oNL)
_(r,o8K)
return r
}
e_[x[0]]={f:m0,j:[],i:[],ti:[],ic:[]}
if(path&&e_[path]){
return function(env,dd,global){$gwxc=0;var root={"tag":"wx-page"};root.children=[]
;g="$gwx_XC_48";var main=e_[path].f
if (typeof global==="undefined")global={};global.f=$gdc(f_[path],"",1);
try{
main(env,{},root,global);
_tsd(root)
}catch(err){
console.log(err)
}
;g="";
return root;
}
}
}
}(__g.a,__g.b,__g.c,__g.d,__g.e,__g.f,__g.g,__g.h,__g.i,__g.j,__g.k,__g.l,__g.m,__g.n,__g.o,__g.p,__g.q,__g.r,__g.s,__g.t,__g.u,__g.v,__g.w,__g.x,__g.y,__g.z,__g.A,__g.B,__g.C,__g.D,__g.E,__g.F,__g.G,__g.H,__g.I,__g.J,__g.K,__g.L,__g.M,__g.N,__g.O,__g.P,__g.Q,__g.R,__g.S,__g.T,__g.U,__g.V,__g.W,__g.X,__g.Y,__g.Z,__g.aa);if(__vd_version_info__.delayedGwx||false)$gwx_XC_48();	if (__vd_version_info__.delayedGwx) __wxAppCode__['pages/appointment_doctor_order/index.wxml'] = [$gwx_XC_48, './pages/appointment_doctor_order/index.wxml'];else __wxAppCode__['pages/appointment_doctor_order/index.wxml'] = $gwx_XC_48( './pages/appointment_doctor_order/index.wxml' );
	;__wxRoute = "pages/appointment_doctor_order/index";__wxRouteBegin = true;__wxAppCurrentFile__="pages/appointment_doctor_order/index.js";define("pages/appointment_doctor_order/index.js",function(require,module,exports,window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){
"use strict";var e=require("../../@babel/runtime/helpers/createForOfIteratorHelper"),t=getApp(),a=require("../../BC983DD1829A079CDAFE55D6E84D7B70.js"),i=require("../../840A1D64829A079CE26C7563276C7B70.js").doPoint,o=require("../../92BC1755829A079CF4DA7F52C55D7B70.js").param,s=a.baseUrl,n=s+"/files/upload_multi_image/",r=s+"/cooperation/wap/my_center/",c=s+"/api/v5/register_apply/${id}/detail",d=s+"/api/v5/register_apply/${id}/update",l=s+"/api/v5/register_apply/create",h=s+"/api/global/property/?property_key=register_apply_patient_notice";Page({data:{id:"",doctorId:"",doctorName:"",type:"create",imgList:[],phone:"",desc:"",time:"",stage:"",clinicDetailAddr:"",hospitalDoctorId:"",failReason:"",ehrId:"",patientName:"",contentFurther:"",orderStatus:"",serviceExplain:"",isDisabled:!1,isShowSupplementDes:!1,makeNoticeDialogVisible:!1,formData:{}},onLoad:function(e){var t=e.type,a=e.doctorId,i=e.doctorName,o=e.id,s=e.status;wx.setNavigationBarTitle({title:i+"医生预约就诊"}),this.setData({type:t,doctorId:a,doctorName:i,id:o,orderStatus:s})},onShow:function(){var e=this.data.type;if(this.setData({isShowSupplementDes:"success"===this.data.orderStatus}),"view"===e&&this.getOrder(),"create"===e){this.getStorageData();var t=this.desc,a=this.phone,i=this.time,o=this.imgList,s=void 0===o?[]:o,n=this.stage,r=this.ehrId,c=this.patientName;this.setData({desc:t,phone:a,time:i,imgList:s,stage:n,ehrId:r,patientName:c}),this.getBindPhone()}"update"===e&&(this.getStorageData(),this.getOrder()),this.getServiceExplain()},onHide:function(){this.setFormStorage()},setFormStorage:function(){var e=this.data,t=e.desc,a=e.phone,i={desc:t,imgList:e.imgList,time:e.time,stage:e.stage,phone:a,ehrId:e.ehrId,patientName:e.patientName};wx.setStorageSync("formData",JSON.stringify(i))},onUnload:function(){this.clearStorageData()},clearStorageData:function(){wx.setStorageSync("hospitalDoctorId",""),wx.setStorageSync("selectHealthRecordInfo",JSON.stringify({})),wx.setStorageSync("formData",JSON.stringify({})),wx.setStorageSync("chooseRegisterMessage",JSON.stringify({}))},getStorageData:function(){try{var e=JSON.parse(wx.getStorageSync("formData")||"{}"),t=e.desc,a=e.imgList,i=void 0===a?[]:a,o=e.time,s=e.stage,n=e.phone,r=e.ehrId,c=e.patientName,d=JSON.parse(wx.getStorageSync("selectHealthRecordInfo")||"{}"),l=d.id,h=d.patient_name,p=JSON.parse(wx.getStorageSync("chooseRegisterMessage")||"{}"),g=p.type,u=p.date,m=p.clinicDetailAddr;this.desc=t,this.imgList=i,this.time=o||u,this.stage=s||g,this.phone=n,this.ehrId=l||r,this.patientName=h||c,this.clinicDetailAddr=m,this.setData({clinicDetailAddr:m}),console.log("this.time",g,u,m)}catch(e){console.log(e)}},isDisabled:function(){var e=this.data,t=e.type,a=e.orderStatus;return"view"===t||"update"===t&&"success"===a},contentFurtherChange:function(e){this.setData({contentFurther:e.detail.value})},phoneChange:function(e){this.setData({phone:e.detail.value})},descChange:function(e){this.setData({desc:e.detail.value})},addSeeDoctorPerson:function(){this.isDisabled()||wx.navigateTo({url:"/pages/health_record_certification/index"})},getServiceExplain:function(){var e=this;wx.request({url:h,method:"GET",header:{"Content-Type":"application/json",Cookie:t.globalData.sessionid},success:function(t){console.log(t);var a=t.data,i=a.error_code,o=void 0===i?1:i,s=a.error_msg,n=void 0===s?"获取服务说明失败":s,r=a.property_value,c=void 0===r?"":r;0===o?e.setData({serviceExplain:c}):wx.showToast({title:n,icon:"none"})}})},changeRegister:function(){if(!this.isDisabled()){i("AppClick",{app:"weixin_mini",click_position:"就诊时间地点",page_readable_name:"预约就诊病情描述填写"});var e=this.data,t=e.doctorId,a=e.doctorName,o=e.id,s=void 0===o?"":o,n=e.type;console.log("重新选择就诊地点",s),wx.navigateTo({url:"/pages/out_call_message/index?doctorId=".concat(t,"&doctorName=").concat(a,"&registerId=").concat(s,"&type=").concat(n)})}},getOrder:function(){var e=this.data.id,a=c.replace("${id}",e),i=this;wx.showLoading(),wx.request({url:a,method:"GET",header:{"Content-Type":"application/json",Cookie:t.globalData.sessionid},success:function(e){try{var t=i.desc,a=i.phone,o=i.time,s=i.imgList,n=void 0===s?[]:s,r=i.stage,c=i.ehrId,d=i.patientName,l=i.clinicDetailAddr,h=e.data,p=void 0===h?{}:h;i.setData({desc:t||p.content,phone:a||p.cellphone,time:o||p.user_tmp_time,imgList:n.length?n:p.image_list,stage:r||p.time_type,ehrId:c||p.ehr_id,patientName:d||p.patient_name,clinicDetailAddr:l||p.register_time_location,isDisabled:i.isDisabled()}),console.log("更新表单内容",i),wx.hideLoading()}catch(e){console.log(e),wx.hideLoading()}}})},isValidPhone:function(e){return/^1\d{10}$/.test(e)},handleSubmit:function(e){var t=e.detail.value,a=t.desc,i=t.phone,o=t.time;this.setData({formData:e.detail.value}),""!==a?a.length>500?wx.showToast({title:"病情描述最多500字",icon:"none"}):""!==o?""!==i?this.isValidPhone(i)?this.data.ehrId?"update"!==this.data.type?this.setData({makeNoticeDialogVisible:!0}):this.finallySubmit():wx.showToast({title:"请选择就诊人",icon:"none"}):wx.showToast({title:"请填写正确的手机号",icon:"none"}):wx.showToast({title:"请填写您的手机号",icon:"none"}):wx.showToast({title:"请选择就诊时间",icon:"none"}):wx.showToast({title:"请填写病情描述",icon:"none"})},finallySubmit:function(){var e=this.data.formData,t=e.desc,a=e.phone,i=this.data,s=i.type,n=i.imgList,r=i.doctorId,c=i.time,d=i.ehrId,l=i.contentFurther,h=i.stage,p=i.hospitalDoctorId,g=[{type:"text",text:t}];n.forEach((function(e){g.push({type:"image",file:e,tag:""})}));var u={scene_in:"update"===s?"register_apply":null,content_further:"update"===s?l:null,content:JSON.stringify(g),available_time:c,time_type:h,cellphone:a,ehr_id:d,hospital_doctor_id:wx.getStorageSync("hospitalDoctorId")||p};"create"===s&&(u.doctor_id=r),u=o(u),"create"===s?this.createOrder(u):this.updateOrder(u)},createPayOrder:function(e){wx.showLoading();var a=this.data,i=a.doctorId,o=a.doctorName,s={finish_success_url:"",finish_fail_url:"",order_desc:"",order_name:"",order_type:"register_apply",partner:t.globalData.partner,info_dict:{doctor_id:i,id:e}};t.globalData.order_data=s,wx.redirectTo({url:"/pages/payment/index?doctorName="+o+"&mark=register_apply"})},createOrder:function(e){var a=this;wx.showLoading(),i("AppClick",{app:"weixin_mini",click_position:"提交预约",page_readable_name:"预约就诊病情描述填写"}),console.log("预约就诊创建订单data",e),wx.request({url:l,method:"POST",data:e,header:{"content-type":"application/x-www-form-urlencoded",Cookie:t.globalData.sessionid},success:function(e){wx.hideLoading();var t=e.data||{},i=t.error_msg,o=t.id,s=void 0===o?"":o,n=t.success;n?a.createPayOrder(s):(wx.showToast({title:i||"预约失败",icon:"none"}),a.setData({makeNoticeDialogVisible:!1}))}})},updateOrder:function(e){console.log("预约就诊更新订单data",e);var a=this;wx.showLoading();var i=this.data.id,o=d.replace("${id}",i);wx.request({url:o,method:"POST",data:e,header:{"content-type":"application/x-www-form-urlencoded",Cookie:t.globalData.sessionid},success:function(e){wx.hideLoading();var i=e.data.error_msg;i?wx.showToast({title:i||"更新失败",icon:"none"}):(wx.showToast({title:"更新成功",icon:"none"}),t.sensors.track("AppClick",{app:"weixin_mini",click_position:"更新预约资料",click_position_value:"success"===a.data.orderStatus?"接受":"待处理",page_readable_name:"预约就诊病情描述填写"}),wx.navigateBack({delta:1}))}})},getBindPhone:function(){var e=this;wx.showLoading(),wx.request({url:r,header:{"Content-Type":"application/json",Cookie:t.globalData.sessionid},success:function(t){var a=t.data.bind_phone;e.setData({phone:e.phone||a}),wx.hideLoading()}})},removeImg:function(e){var t=this;wx.showModal({content:"确认删除此图片？",success:function(a){if(a.confirm){var i=e.target.dataset.index,o=t.data.imgList;o.splice(i,1),t.setData({imgList:o})}else if(a.cancel)return}})},handleMakeNoticeDialogOk:function(){this.setData({makeNoticeDialogVisible:!1})},handleMakeNoticeDialogCancel:function(){this.setData({makeNoticeDialogVisible:!1})},previewImg:function(e){var t=e.target.dataset.index,a=this.data.imgList,i=a[t];wx.previewImage({current:i,urls:a})},addImg:function(){var a=this,i=this.data.imgList,o=this.data.imgList.length;o>=9?wx.showToast({title:"最多选择9张",icon:"none"}):wx.chooseImage({count:9-o,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(o){var s,r=o.tempFilePaths,c=e(r);try{for(c.s();!(s=c.n()).done;){var d=s.value;wx.uploadFile({url:n,filePath:d,name:"images",formData:{return_full:"true"},header:{Cookie:t.globalData.sessionid},success:function(e){var t=JSON.parse(e.data).files[0];i.push(t),a.setData({imgList:i})}})}}catch(e){c.e(e)}finally{c.f()}}})}});
},{isPage:true,isComponent:true,currentFile:'pages/appointment_doctor_order/index.js'});require("pages/appointment_doctor_order/index.js");