$gwx_XC_127=function(_,_v,_n,_p,_s,_wp,_wl,$gwn,$gwl,$gwh,wh,$gstack,$gwrt,gra,grb,TestTest,wfor,_ca,_da,_r,_rz,_o,_oz,_1,_1z,_2,_2z,_m,_mz,nv_getDate,nv_getRegExp,nv_console,nv_parseInt,nv_parseFloat,nv_isNaN,nv_isFinite,nv_decodeURI,nv_decodeURIComponent,nv_encodeURI,nv_encodeURIComponent,$gdc,nv_JSON,_af,_gv,_ai,_grp,_gd,_gapi,$ixc,_ic,_w,_ev,_tsd){return function(path,global){
if(typeof global==='undefined'){if (typeof __GWX_GLOBAL__==='undefined')global={};else global=__GWX_GLOBAL__;}if(typeof __WXML_GLOBAL__ === 'undefined') {__WXML_GLOBAL__={};
}__WXML_GLOBAL__.modules = __WXML_GLOBAL__.modules || {};
var e_={}
if(typeof(global.entrys)==='undefined')global.entrys={};e_=global.entrys;
var d_={}
if(typeof(global.defines)==='undefined')global.defines={};d_=global.defines;
var f_={}
if(typeof(global.modules)==='undefined')global.modules={};f_=global.modules || {};
var p_={}
__WXML_GLOBAL__.ops_cached = __WXML_GLOBAL__.ops_cached || {}
__WXML_GLOBAL__.ops_set = __WXML_GLOBAL__.ops_set || {};
__WXML_GLOBAL__.ops_init = __WXML_GLOBAL__.ops_init || {};
var z=__WXML_GLOBAL__.ops_set.$gwx_XC_127 || [];
function gz$gwx_XC_127_1(){
if( __WXML_GLOBAL__.ops_cached.$gwx_XC_127_1)return __WXML_GLOBAL__.ops_cached.$gwx_XC_127_1
__WXML_GLOBAL__.ops_cached.$gwx_XC_127_1=[];
(function(z){var a=11;function Z(ops){z.push(ops)}
Z([[2,'=='],[[7],[3,'type']],[1,'rookie_task']])
Z([[7],[3,'showForm']])
Z([3,'submitForm'])
Z([1,true])
Z([3,'ehr-container'])
Z([3,'radioChangeEvent'])
Z([3,'radio-group'])
Z([3,'sex'])
Z(z[7])
Z([[7],[3,'sexList']])
Z([3,'value'])
Z([3,'weui-cell__hd weui-check__hd_in-checkbox'])
Z([[2,'!='],[[6],[[7],[3,'item']],[3,'value']],[[6],[[7],[3,'showData']],[3,'sex']]])
Z([[2,'==='],[[6],[[7],[3,'item']],[3,'value']],[[6],[[7],[3,'showData']],[3,'sex']]])
Z([[6],[[6],[[7],[3,'showData']],[3,'chronic']],[3,'showInput']])
Z([[6],[[6],[[7],[3,'showData']],[3,'family']],[3,'showInput']])
Z([[6],[[6],[[7],[3,'showData']],[3,'drug']],[3,'showInput']])
Z([[6],[[6],[[7],[3,'showData']],[3,'food']],[3,'showInput']])
Z([[6],[[6],[[7],[3,'showData']],[3,'badHabit']],[3,'showInput']])
})(__WXML_GLOBAL__.ops_cached.$gwx_XC_127_1);return __WXML_GLOBAL__.ops_cached.$gwx_XC_127_1
}
__WXML_GLOBAL__.ops_set.$gwx_XC_127=z;
__WXML_GLOBAL__.ops_init.$gwx_XC_127=true;
var x=['./pages/health_record_edit/index.wxml'];d_[x[0]]={}
var m0=function(e,s,r,gg){
var z=gz$gwx_XC_127_1()
var oB5=_v()
_(r,oB5)
if(_oz(z,0,e,s,gg)){oB5.wxVkey=1
}
var fC5=_v()
_(r,fC5)
if(_oz(z,1,e,s,gg)){fC5.wxVkey=1
var cD5=_mz(z,'form',['bindsubmit',2,'reportSubmit',1],[],e,s,gg)
var hE5=_n('view')
_rz(z,hE5,'class',4,e,s,gg)
var tK5=_mz(z,'radio-group',['bindchange',5,'class',1,'data-name',2,'name',3],[],e,s,gg)
var eL5=_v()
_(tK5,eL5)
var bM5=function(xO5,oN5,oP5,gg){
var cR5=_n('view')
_rz(z,cR5,'class',11,xO5,oN5,gg)
var hS5=_v()
_(cR5,hS5)
if(_oz(z,12,xO5,oN5,gg)){hS5.wxVkey=1
}
var oT5=_v()
_(cR5,oT5)
if(_oz(z,13,xO5,oN5,gg)){oT5.wxVkey=1
}
hS5.wxXCkey=1
oT5.wxXCkey=1
_(oP5,cR5)
return oP5
}
eL5.wxXCkey=2
_2z(z,9,bM5,e,s,gg,eL5,'item','index','value')
_(hE5,tK5)
var oF5=_v()
_(hE5,oF5)
if(_oz(z,14,e,s,gg)){oF5.wxVkey=1
}
var cG5=_v()
_(hE5,cG5)
if(_oz(z,15,e,s,gg)){cG5.wxVkey=1
}
var oH5=_v()
_(hE5,oH5)
if(_oz(z,16,e,s,gg)){oH5.wxVkey=1
}
var lI5=_v()
_(hE5,lI5)
if(_oz(z,17,e,s,gg)){lI5.wxVkey=1
}
var aJ5=_v()
_(hE5,aJ5)
if(_oz(z,18,e,s,gg)){aJ5.wxVkey=1
}
oF5.wxXCkey=1
cG5.wxXCkey=1
oH5.wxXCkey=1
lI5.wxXCkey=1
aJ5.wxXCkey=1
_(cD5,hE5)
_(fC5,cD5)
}
else{fC5.wxVkey=2
}
oB5.wxXCkey=1
fC5.wxXCkey=1
return r
}
e_[x[0]]={f:m0,j:[],i:[],ti:[],ic:[]}
if(path&&e_[path]){
return function(env,dd,global){$gwxc=0;var root={"tag":"wx-page"};root.children=[]
;g="$gwx_XC_127";var main=e_[path].f
if (typeof global==="undefined")global={};global.f=$gdc(f_[path],"",1);
try{
main(env,{},root,global);
_tsd(root)
}catch(err){
console.log(err)
}
;g="";
return root;
}
}
}
}(__g.a,__g.b,__g.c,__g.d,__g.e,__g.f,__g.g,__g.h,__g.i,__g.j,__g.k,__g.l,__g.m,__g.n,__g.o,__g.p,__g.q,__g.r,__g.s,__g.t,__g.u,__g.v,__g.w,__g.x,__g.y,__g.z,__g.A,__g.B,__g.C,__g.D,__g.E,__g.F,__g.G,__g.H,__g.I,__g.J,__g.K,__g.L,__g.M,__g.N,__g.O,__g.P,__g.Q,__g.R,__g.S,__g.T,__g.U,__g.V,__g.W,__g.X,__g.Y,__g.Z,__g.aa);if(__vd_version_info__.delayedGwx||false)$gwx_XC_127();	if (__vd_version_info__.delayedGwx) __wxAppCode__['pages/health_record_edit/index.wxml'] = [$gwx_XC_127, './pages/health_record_edit/index.wxml'];else __wxAppCode__['pages/health_record_edit/index.wxml'] = $gwx_XC_127( './pages/health_record_edit/index.wxml' );
	;__wxRoute = "pages/health_record_edit/index";__wxRouteBegin = true;__wxAppCurrentFile__="pages/health_record_edit/index.js";define("pages/health_record_edit/index.js",function(require,module,exports,window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){
"use strict";require("../../@babel/runtime/helpers/Arrayincludes");var e=require("../../@babel/runtime/helpers/createForOfIteratorHelper"),t=require("../../@babel/runtime/helpers/toConsumableArray"),a=require("../../@babel/runtime/helpers/defineProperty"),i=getApp(),s=require("../../BC983DD1829A079CDAFE55D6E84D7B70.js"),n=require("../../92BC1755829A079CF4DA7F52C55D7B70.js").param,r=s.baseUrl+"/ehr/v2/ehr_basic_data/detail/",l=s.baseUrl+"/ehr/v2/ehr_basic_data/update/",o=s.baseUrl+"/ehr/v2/ehr_basic_data/create/",u=require("../../840A1D64829A079CE26C7563276C7B70.js").doPoint,v=s.baseUrl+"/events/newer_task/ehr/has_self/";Page({data:{btnText:"保存并返回",btnLoading:!1,ehrId:null,showForm:!1,relation:"",relationList:[{label:"自己",value:"自己"},{label:"父母",value:"父母"},{label:"子女",value:"子女"},{label:"爱人",value:"爱人"},{label:"其他",value:"其他"}],sexList:[{name:"男",value:"m"},{name:"女",value:"f"}],nowDay:"",heightList:[],waistlineList:[],changeData:[],showData:{name:"",sex:"",bornTime:"",weight:"",relation:"",relationIndex:null,relationLabel:"",height:"",heightIndex:159,heightLabel:"",bmi:"",waistline:"",waistlineIndex:59,waistlineLabel:"",smoke:{smoke:0,smokeYears:"",smokePerDay:"",smokeStr:""},smokeIndex:[0,0,0],drink:{drink:0,drinkYears:"",drinkWineType:"",drinkConsumption:"",drinkStr:""},drinkIndex:[0,0,0,0],chronic:{tagList:[],showInput:!1,remark:""},family:{tagList:[],showInput:!1,remark:""},drug:{tagList:[],showInput:!1,remark:""},food:{tagList:[],showInput:!1,remark:""},badHabit:{tagList:[],showInput:!1,remark:""}},dsYearList:[],smokeList:[[{label:"否",value:0},{label:"是",value:1}],[{label:"",value:""}],[{label:"",value:""}]],smokeNumList:[],drinkList:[[{label:"否",value:0},{label:"是",value:1}],[{label:"",value:""}],[{label:"",value:""}],[{label:"",value:""}]],drinkCategoryList:[{label:"白酒",value:"白酒"},{label:"啤酒",value:"啤酒"},{label:"红酒",value:"红酒"},{label:"以上均有",value:"以上均有"}],drinkAmountList:[{label:"少量",value:"少量"},{label:"适中",value:"适中"},{label:"大量",value:"大量"}],liverList:[{isActive:!1,value:"正常"},{isActive:!1,value:"异常"}],renalList:[{isActive:!1,value:"正常"},{isActive:!1,value:"异常"}],marriedList:[{isActive:!1,value:"未婚"},{isActive:!1,value:"已婚"},{isActive:!1,value:"其他"}],fertilityList:[{isActive:!1,value:"未生育"},{isActive:!1,value:"备孕期"},{isActive:!1,value:"怀孕中"},{isActive:!1,value:"已生育"}],chronicList:[{isActive:!1,value:"暂无"},{isActive:!1,value:"高血压"},{isActive:!1,value:"糖尿病"},{isActive:!1,value:"心脏病"},{isActive:!1,value:"过敏性疾病"},{isActive:!1,value:"哮喘"},{isActive:!1,value:"白癜风"},{isActive:!1,value:"癫痫"},{isActive:!1,value:"其他"}],familyList:[{isActive:!1,value:"暂无"},{isActive:!1,value:"高血压"},{isActive:!1,value:"糖尿病"},{isActive:!1,value:"心脏病"},{isActive:!1,value:"脑梗"},{isActive:!1,value:"癌症"},{isActive:!1,value:"白癜风"},{isActive:!1,value:"癫痫"},{isActive:!1,value:"哮喘"},{isActive:!1,value:"近视"},{isActive:!1,value:"冠心病"},{isActive:!1,value:"脑卒中"},{isActive:!1,value:"血脂异常"},{isActive:!1,value:"慢性阻塞性肺疾病"},{isActive:!1,value:"结核病"},{isActive:!1,value:"肝炎"},{isActive:!1,value:"严重精神障碍"},{isActive:!1,value:"其他"}],drugList:[{isActive:!1,value:"暂无"},{isActive:!1,value:"青霉素"},{isActive:!1,value:"头孢类"},{isActive:!1,value:"破伤风抗毒素"},{isActive:!1,value:"普鲁卡因"},{isActive:!1,value:"地卡因"},{isActive:!1,value:"磺胺类"},{isActive:!1,value:"维生素B1"},{isActive:!1,value:"泛影葡胺"},{isActive:!1,value:"阿司匹林"},{isActive:!1,value:"其他"}],foodList:[{isActive:!1,value:"暂无"},{isActive:!1,value:"芒果"},{isActive:!1,value:"牛奶"},{isActive:!1,value:"坚果类"},{isActive:!1,value:"海鲜"},{isActive:!1,value:"黄瓜"},{isActive:!1,value:"花粉"},{isActive:!1,value:"油漆"},{isActive:!1,value:"动物皮毛"},{isActive:!1,value:"化妆品"},{isActive:!1,value:"其他"}],badHabitList:[{isActive:!1,value:"低头族"},{isActive:!1,value:"久坐"},{isActive:!1,value:"久站"},{isActive:!1,value:"强忍大小便"},{isActive:!1,value:"喝酒"},{isActive:!1,value:"熬夜"},{isActive:!1,value:"跷二郎腿"},{isActive:!1,value:"吸烟"},{isActive:!1,value:"饭后卧床"},{isActive:!1,value:"不常锻炼"},{isActive:!1,value:"如厕玩手机"},{isActive:!1,value:"不喜喝水"},{isActive:!1,value:"其他"}],requiredMap:{relation:"relation",name:"name",sex:"sex",bornTime:"born_time"},ehrSingleMap:{liver:"liver_function",renal:"renal_function",married:"married",fertility:"procreate_status"},ehrMultiMap:{chronic:"chronic_diseases",food:"food_allergic",drug:"drug_allergic",badHabit:"bad_habit",family:"family_illness"},singlePickerMap:{height:"height",relation:"relation",waistline:"waistline"},multiPickerMap:{smoke:"smoke",smoke_per_day:"smokeStr",drink:"drink",drink_consumption:"drinkStr"}},onLoad:function(e){var t=this;"自己"!=e.relation&&this.getRelationData(),i.globalData.appIsLogin.then((function(){t.init(e)}))},init:function(e){this.setStatus(e),this.getDateStr(),this.setHeightRange(),this.setWaistlineRange(),this.setDrinkOrSmokeRange(),this.setSmokeNumList()},getRelationData:function(){var e=this;wx.request({url:v,header:{"Content-Type":"application/json",Cookie:i.globalData.sessionid},method:"GET",success:function(t){t.data&&t.data.has_self&&e.setData({relationList:e.data.relationList.slice(1)})}})},setStatus:function(e){var t=e.type,a=e.ehr_id||"",i=e.relation||"";switch(this.setData({type:t,ehrId:a,relation:i}),t){case"edit":this.getEhrDetail();break;case"add":wx.setNavigationBarTitle({title:"添加档案"}),this.setData({showForm:!0});break;case"rookie_task":u("wxmini_task1"),wx.setNavigationBarTitle({title:"新手任务"}),this.setData({btnText:"保存并进入下一步"}),this.getEhrDetail()}},setChangeData:function(e){if(!e)return!1;var t=this.data.changeData;t.includes(e)||t.push(e),this.setData({changeData:t})},datePickerChangeEvent:function(e){var t=e.currentTarget.dataset.name;this.setChangeData(t);var a=this.data.showData;a[t]=e.detail.value,this.setData({showData:a})},radioChangeEvent:function(e){var t=e.currentTarget.dataset.name;this.setChangeData(t);var a=this.data.showData;a[t]=e.detail.value,this.setData({showData:a})},pickerChangeEvent:function(e){var t=e.currentTarget.dataset.name;this.setChangeData(t);var a=this.data["".concat(t,"List")],i=e.detail.value,s=this.data.showData;s[t]=a[i].value,s["".concat(t,"Label")]=a[i].label,s["".concat(t,"Index")]=i,"height"===t&&(s.bmi=this.setBmi(e.detail.value,s.weight)),this.setData({showData:s})},inputChangeEvent:function(e){var t=e.currentTarget.dataset.name;this.setChangeData(t);var a=this.data.showData;a[t]=e.detail.value,this.setData({showData:a})},weightChangeEvent:function(e){this.setChangeData("weight");var t=this.data.showData;if(!e.detail.value)return t.weight="",t.bmi="",this.setData({showData:t}),"";var a=e.detail.value;if(Number.isNaN(Number(a)))return wx.showModal({title:"提示",content:"体重输入错误，请重新输入",showCancel:!1}),t.weight||"";Number(a)&&Number(a)>250?a=250:String(a).split(".")[1]&&String(a).split(".")[1].length>1&&(a=a.replace(/([0-9]+\.[0-9]{1})[0-9]*/,"$1")),t.weight=a,t.bmi=this.setBmi(t.height,t.weight),this.setData({showData:t})},getDateStr:function(){var e=new Date,t=e.getMonth()+1,a=e.getDate(),i=e.getFullYear()+"-"+(t<10?"0"+t:t)+"-"+(a<10?"0"+a:a);this.setData({nowDay:i})},setHeightRange:function(){for(var e=[],t=1;t<=220;t++)e.push({label:t+"cm",value:t});this.setData({heightList:e})},setWaistlineRange:function(){for(var e=[],t=1;t<=180;t++)e.push({label:"".concat(t,"cm"),value:t});this.setData({waistlineList:e})},setDrinkOrSmokeRange:function(){for(var e=[],t=1;t<=10;t++)e.push({label:"".concat(t,"年"),value:"".concat(t,"年")});e.push({label:"10年以上",value:"10年以上"}),this.setData({dsYearList:e})},setSmokeNumList:function(){for(var e=[],t=1;t<=20;t++)e.push({label:"".concat(t,"根"),value:t});e.push({label:"20根以上",value:21}),this.setData({smokeNumList:e})},bindSmokeColumnChange:function(e){var t=this.data.smokeList,a=this.data.showData,i=this.data.dsYearList,s=this.data.smokeNumList;switch(a.smokeIndex[e.detail.column]=e.detail.value,e.detail.column){case 0:switch(a.smokeIndex[0]){case 0:t[1]=[{label:"",value:""}],t[2]=[{label:"",value:""}];break;case 1:t[1]=i,t[2]=s}a.smokeIndex[1]=0,a.smokeIndex[2]=0;break;case 1:t[2]=s,a.smokeIndex[2]=0}this.setData({smokeList:t,showData:a})},bindSmokeChange:function(e){this.setChangeData("smoke");var t=this.data.smokeList,a=e.detail.value,i=t[0][a[0]].value,s=this.data.showData,n="",r="";1===i?(n=t[1][a[1]].value,r=t[2][a[2]].value,s.smoke.smokeStr=t[2][a[2]].label):s.smoke.smokeStr="否",s.smoke.smoke=i,s.smoke.smokeYears=n,s.smoke.smokePerDay=r,this.setData({showData:s})},bindDrinkColumnChange:function(e){var t=this.data.drinkList,a=this.data.dsYearList,i=this.data.drinkCategoryList,s=this.data.drinkAmountList,n=this.data.showData;switch(n.drinkIndex[e.detail.column]=e.detail.value,e.detail.column){case 0:switch(n.drinkIndex[0]){case 0:t[1]=[{label:"",value:""}],t[2]=[{label:"",value:""}],t[3]=[{label:"",value:""}];break;case 1:t[1]=a,t[2]=i,t[3]=s}n.drinkIndex[1]=0,n.drinkIndex[2]=0,n.drinkIndex[3]=0;break;case 1:t[2]=i,t[3]=s,n.drinkIndex[2]=0,n.drinkIndex[3]=0;break;case 2:t[3]=s,n.drinkIndex[3]=0}this.setData({drinkList:t,showData:n})},bindDrinkChange:function(e){this.setChangeData("drink");var t=this.data.drinkList,a=e.detail.value,i=t[0][a[0]].value,s=this.data.showData,n="",r="",l="";1===i?(n=t[1][a[1]].value,r=t[2][a[2]].value,l=t[3][a[3]].value,s.drink.drinkStr=t[3][a[3]].label):s.drink.drinkStr="否",s.drink.drink=i,s.drink.drinkYears=n,s.drink.drinkWineType=r,s.drink.drinkConsumption=l,this.setData({showData:s})},ehrSingleSelectEvent:function(e){var t=e.currentTarget.dataset,i=t.name,s=t.value,n=t.index;this.setChangeData(i);var r="".concat(i,"List"),l=this.data[r],o=!l[n].isActive,u=this.data.showData;if(o){u[i]=s;for(var v=0;v<l.length;v++)l[v].isActive=v===n}else u[i]="",l[n].isActive=!1;this.setData(a({showData:u},r,l))},ehrMultiSelectEvent:function(e){var t=e.currentTarget.dataset,i=t.name,s=t.value,n=t.index;this.setChangeData(i);var r="".concat(i,"List"),l=this.data[r],o=!l[n].isActive;l[n].isActive=o;var u=this.data.showData,v=u[i];if(o)v.tagList.push(s),"其他"===s&&(v.showInput=!0);else if("其他"===s&&(v.showInput=!1),v.tagList.includes(s)){var c=v.tagList.indexOf(s);v.tagList.splice(c,1)}this.setData(a({showData:u},r,l))},ehrRemarkInputEvent:function(e){var t=e.currentTarget.dataset.name;this.setChangeData(t);var a=this.data.showData;a[t].remark=e.detail.value,this.setData({showData:a})},setBmi:function(e,t){var a=Number(e),i=Number(t);if(!a||-1===a)return 0;var s=i/(a*a)*1e4;return Number.isNaN(Number(s))?0:s.toFixed(1)},getEhrDetail:function(){var e={},t=this;t.data.ehrId&&(e={ehr_id:t.data.ehrId,relation:t.data.relation}),wx.request({url:r,header:{Cookie:i.globalData.sessionid},method:"GET",data:e,success:function(e){e.data.length?t.setEhrInfo(e.data[0]):t.setData({showForm:!0})},fail:function(e){t.setData({showForm:!0}),wx.showToast({title:"数据加载失败请重试",icon:"none"})}})},setEhrInfo:function(e){var t=this.data.showData,a=this.data,i=a.dsYearList,s=a.smokeList,n=a.smokeNumList,r=a.drinkList,l=a.drinkCategoryList,o=a.drinkAmountList,u=this.data,v=(u.liverList,u.renalList,u.marriedList,u.fertilityList,this.data);v.chronicList,v.familyList,v.drugList,v.foodList,v.badHabitList;if(this.setSinglePicker("relation",e.relation,t),t.name=e.name||"",t.sex=e.sex||"",t.bornTime=e.born_time||"",this.setSinglePicker("height",e.height,t),t.weight=-1===e.weight?"":e.weight,t.bmi=this.setBmi(e.height,e.weight),this.setSinglePicker("waistline",e.waistline,t),this.setEhrSingleSelect(e),this.setMutiSelect(e,t),-1!=e.smoke)if(t.smoke.smoke=e.smoke,1===e.smoke){t.smokeIndex[0]=1,s[1]=i,s[2]=n;var c=i.find((function(t){return t.value===e.smoke_years}));c&&(t.smokeIndex[1]=i.indexOf(c));var h=Number(e.smoke_per_day);h>20?(t.smokeIndex[2]=20,t.smoke.smokeStr=n[20].label):(t.smokeIndex[2]=h-1,t.smoke.smokeStr=n[h-1].label)}else t.smoke.smokeStr="否",t.smokeIndex[0]=0;if(-1!=e.drink)if(t.drink.drink=e.drink,1===e.drink){t.drinkIndex[0]=1,r[1]=i,r[2]=l,r[3]=o;var d=i.find((function(t){return t.value===e.drink_years}));d&&(t.drinkIndex[1]=i.indexOf(d));var k=l.find((function(t){return t.value===e.drink_wine_type}));k&&(t.drinkIndex[2]=l.indexOf(k));var m=o.find((function(t){return t.value===e.drink_consumption}));m&&(t.drinkIndex[3]=o.indexOf(m),t.drink.drinkStr=m.label)}else t.drink.drinkStr="否";this.setData({showData:t,smokeList:s,drinkList:r,showForm:!0})},setSinglePicker:function(e,t,a){if(!e||!t)return!1;var i=this.data["".concat(e,"List")],s=i.find((function(e){return e.value===t}));s&&(a[e]=t,a["".concat(e,"Index")]=i.indexOf(s),a["".concat(e,"Label")]=s.label||"")},setEhrSingleSelect:function(e){var t=this,a=this.data.ehrSingleMap,i={},s=function(s){var n=t.data["".concat(s,"List")],r=n.find((function(t){return t.value===e[a[s]]}));r&&(r.isActive=!0),i["".concat(s,"List")]=n};for(var n in a)s(n);this.setData(i)},setMutiSelect:function(a,i){var s=this.data.ehrMultiMap,n={};for(var r in s){var l=a[s[r]];if(l&&l.tag_list){i[r].tagList=t(l.tag_list),l.remark&&(i[r].remark=l.remark,i[r].showInput=!0);var o,u=this.data["".concat(r,"List")],v=e(u);try{for(v.s();!(o=v.n()).done;){var c=o.value;l.tag_list.includes(c.value)&&(c.isActive=!0)}}catch(e){v.e(e)}finally{v.f()}n["".concat(r,"List")]=u}}this.setData(n)},checkValidate:function(e){var t=Object.keys(e);if("edit"===this.data.type){if(t.includes("relation")&&!e.relation)return wx.showToast({title:"请选择关系",icon:"none"}),!1;if(t.includes("name")&&!e.name)return wx.showToast({title:"请填写姓名",icon:"none"}),!1;if(t.includes("sex")&&!e.sex)return wx.showToast({title:"请选择性别",icon:"none"}),!1;if(t.includes("born_time")&&!e.born_time)return wx.showToast({title:"请选择出生日期",icon:"none"}),!1}else{if(!e.relation)return wx.showToast({title:"请选择关系",icon:"none"}),!1;if(!e.name)return wx.showToast({title:"请填写姓名",icon:"none"}),!1;if(!e.sex)return wx.showToast({title:"请选择性别",icon:"none"}),!1;if(!e.born_time)return wx.showToast({title:"请选择出生日期",icon:"none"}),!1}return!t.includes("weight")||!Number.isNaN(Number(e.weight))||(wx.showToast({title:"体重只能为数字类型",icon:"none"}),!1)},submitForm:function(){var e=this;this.setData({btnLoading:!0});var t=this.data.type,a=this.setSubmitData();if(!this.checkValidate(a))return this.setData({btnLoading:!1}),!1;var s="";"edit"===t?(a.ehr_id=this.data.ehrId,s=l):s=o,wx.request({url:s,header:{"Content-Type":"application/x-www-form-urlencoded",Cookie:i.globalData.sessionid},method:"POST",data:n(a),success:function(e){e.data.success||0===e.data.error_code?wx.showToast({title:"档案保存成功",mask:!0,success:function(){if("rookie_task"==t){var e="../rookie_task_third/index";u("wxmini_task2"),setTimeout((function(){wx.redirectTo({url:e})}),1500)}else{e="../health_record_full/index";setTimeout((function(){wx.navigateBack({delta:1})}),1500)}}}):wx.showToast({title:e.error_msg||"数据提交失败请重试",icon:"none"})},fail:function(e){wx.showToast({title:"数据提交出错请重试",icon:"none"})},complete:function(){e.setData({btnLoading:!1})}})},setSubmitData:function(){var t,a=Object.assign({},this.data.showData),i={},s=this.data,n=s.requiredMap,r=s.ehrSingleMap,l=s.ehrMultiMap,o=s.singlePickerMap,u=(s.multiPickerMap,s.changeData),v=e(u);try{for(v.s();!(t=v.n()).done;){var c=t.value;if(Object.keys(n).includes(c))i[n[c]]=a[c];else if(Object.keys(o).includes(c))i[o[c]]=a[c];else if(Object.keys(r).includes(c))i[r[c]]=a[c];else if(Object.keys(l).includes(c)){var h=a[c],d=l[c],k={};if(h.tagList.includes("其他")&&!h.remark){var m=h.tagList.indexOf("其他");h.tagList.splice(m,1)}k.tag_list=h.tagList,k.remark=h.remark,i[d]=JSON.stringify(k)}else if("smoke"===c){var g=a.smoke;i.smoke=g.smoke,g.smoke&&(i.smoke_years=g.smokeYears,i.smoke_per_day=g.smokePerDay)}else if("drink"===c){var f=a.drink;i.drink=f.drink,f.drink&&(i.drink_consumption=f.drinkConsumption,i.drink_wine_type=f.drinkWineType,i.drink_years=f.drinkYears)}else i[c]="weight"===c?a[c]||0:a[c]}}catch(e){v.e(e)}finally{v.f()}return i}});
},{isPage:true,isComponent:true,currentFile:'pages/health_record_edit/index.js'});require("pages/health_record_edit/index.js");