$gwx_XC_1=function(_,_v,_n,_p,_s,_wp,_wl,$gwn,$gwl,$gwh,wh,$gstack,$gwrt,gra,grb,TestTest,wfor,_ca,_da,_r,_rz,_o,_oz,_1,_1z,_2,_2z,_m,_mz,nv_getDate,nv_getRegExp,nv_console,nv_parseInt,nv_parseFloat,nv_isNaN,nv_isFinite,nv_decodeURI,nv_decodeURIComponent,nv_encodeURI,nv_encodeURIComponent,$gdc,nv_JSON,_af,_gv,_ai,_grp,_gd,_gapi,$ixc,_ic,_w,_ev,_tsd){return function(path,global){
if(typeof global==='undefined'){if (typeof __GWX_GLOBAL__==='undefined')global={};else global=__GWX_GLOBAL__;}if(typeof __WXML_GLOBAL__ === 'undefined') {__WXML_GLOBAL__={};
}__WXML_GLOBAL__.modules = __WXML_GLOBAL__.modules || {};
var e_={}
if(typeof(global.entrys)==='undefined')global.entrys={};e_=global.entrys;
var d_={}
if(typeof(global.defines)==='undefined')global.defines={};d_=global.defines;
var f_={}
if(typeof(global.modules)==='undefined')global.modules={};f_=global.modules || {};
var p_={}
__WXML_GLOBAL__.ops_cached = __WXML_GLOBAL__.ops_cached || {}
__WXML_GLOBAL__.ops_set = __WXML_GLOBAL__.ops_set || {};
__WXML_GLOBAL__.ops_init = __WXML_GLOBAL__.ops_init || {};
var z=__WXML_GLOBAL__.ops_set.$gwx_XC_1 || [];
function gz$gwx_XC_1_1(){
if( __WXML_GLOBAL__.ops_cached.$gwx_XC_1_1)return __WXML_GLOBAL__.ops_cached.$gwx_XC_1_1
__WXML_GLOBAL__.ops_cached.$gwx_XC_1_1=[];
(function(z){var a=11;function Z(ops){z.push(ops)}
})(__WXML_GLOBAL__.ops_cached.$gwx_XC_1_1);return __WXML_GLOBAL__.ops_cached.$gwx_XC_1_1
}
__WXML_GLOBAL__.ops_set.$gwx_XC_1=z;
__WXML_GLOBAL__.ops_init.$gwx_XC_1=true;
var x=['./pages/codeinfo/codeinfo.wxml'];d_[x[0]]={}
var m0=function(e,s,r,gg){
var z=gz$gwx_XC_1_1()
return r
}
e_[x[0]]={f:m0,j:[],i:[],ti:[],ic:[]}
if(path&&e_[path]){
return function(env,dd,global){$gwxc=0;var root={"tag":"wx-page"};root.children=[]
;g="$gwx_XC_1";var main=e_[path].f
if (typeof global==="undefined")global={};global.f=$gdc(f_[path],"",1);
try{
main(env,{},root,global);
_tsd(root)
}catch(err){
console.log(err)
}
;g="";
return root;
}
}
}
}(__g.a,__g.b,__g.c,__g.d,__g.e,__g.f,__g.g,__g.h,__g.i,__g.j,__g.k,__g.l,__g.m,__g.n,__g.o,__g.p,__g.q,__g.r,__g.s,__g.t,__g.u,__g.v,__g.w,__g.x,__g.y,__g.z,__g.A,__g.B,__g.C,__g.D,__g.E,__g.F,__g.G,__g.H,__g.I,__g.J,__g.K,__g.L,__g.M,__g.N,__g.O,__g.P,__g.Q,__g.R,__g.S,__g.T,__g.U,__g.V,__g.W,__g.X,__g.Y,__g.Z,__g.aa);if(__vd_version_info__.delayedGwx||false)$gwx_XC_1();	if (__vd_version_info__.delayedGwx) __wxAppCode__['pages/codeinfo/codeinfo.wxml'] = [$gwx_XC_1, './pages/codeinfo/codeinfo.wxml'];else __wxAppCode__['pages/codeinfo/codeinfo.wxml'] = $gwx_XC_1( './pages/codeinfo/codeinfo.wxml' );
	;__wxRoute = "pages/codeinfo/codeinfo";__wxRouteBegin = true;__wxAppCurrentFile__="pages/codeinfo/codeinfo.js";define("pages/codeinfo/codeinfo.js",function(require,module,exports,window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){
"use strict";var e,t=require("../../utils/request"),a=require("../../utils/util"),o=require("../../utils/qqmap-wx-jssdk.js"),n=wx.getStorageSync("jgurl"),s=requirePlugin("qcc-scan-plugin");Page({data:{scanCode:"",data_arr:[],req_arr:{},codelist:[],sginput:"",num:0,arr:[],radioItems:[{name:"扫描二维码",value:"扫描二维码",checked:"true"},{name:"扫描量子码",value:"扫描量子码"}],chooseType:"1",hidden:!1},onLoad:function(t){e=new o({key:"IOVBZ-V6GWL-VUZP4-MC4UF-TQIBO-ERFB7"}),this.toGetList(),this.isAuth()},tapEvent:function(){console.log("按钮被点击")},radioChange:function(e){var t=e.detail.value,a={};console.log(e),"扫描二维码"==e.detail.value?this.setData({chooseType:"1"}):this.setData({chooseType:"2"});for(var o=0;o<this.data.radioItems.length;o++)-1!==t.indexOf(this.data.radioItems[o].name)?a["radioItems["+o+"].checked"]=!0:a["radioItems["+o+"].checked"]=!1;this.setData(a)},toGetList:function(){},onReady:function(){},onShow:function(){var e=this;s.setScanResultListener((function(a){console.log("插件返回结果:"+JSON.stringify(a));var o=a.success,s=a.resultCode;if(o&&"0"==s){var i=decodeURIComponent(a.data.url),c=e.getUrlParams(i),d=a.data.vid,l=a.data.cid,r=(a.data.tpid,{tenantId:c.bizid,codeType:c.codeType,code:c.code,vid:d,cid:l});t.getCodeInfo("/v1/codeDetail/selectDetailByCode",r,(function(a){console.log(a);var o=a.data.data.codesInfo.codes.customCode.details[1],s={labelcode:a.data.data.codesInfo.codes.customCode.details[1]};wx.request({url:n+"/jczx/findConcreteTestBlock_Labelone",method:"POST",header:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8'"},data:s,success:function(n){if(console.log(n,"---"),"success"!=n.data.message)wx.showToast({title:n.data.message,icon:"none",duration:3e3,success:function(){setTimeout((function(){e.scanCode()}),3e3)}});else{var s=o.substring(0,o.indexOf("-"));if(-1!==e.data.arr.indexOf(s))wx.showToast({title:"该组试块已扫描",icon:"none",duration:3e3,success:function(){setTimeout((function(){e.scanCode()}),3e3)}});else{if(15==o.length)var i={labelcode:o.substring(0,o.lastIndexOf("-"))};else i={labelcode:o};t.postForm("/Index/verificationTestBlock",i,(function(t){console.log(t,"---+++"),e.setData({labelcodeimg1:t.data.labelcodeimg1,labelcodeimg2:t.data.labelcodeimg2,labelcodeimg3:t.data.labelcodeimg3})})),e.data.arr.push(s),15==o.length?e.setData({num:e.data.num+1,labelcode:o.substring(0,o.lastIndexOf("-"))}):e.setData({num:e.data.num+1,labelcode:a.result}),wx.showToast({title:"扫描成功",icon:"none",duration:3e3,success:function(){setTimeout((function(){e.scanCode()}),3e3)}})}}}})}))}}))},getUrlParams:function(e){for(var t={},a=e.split("?")[1].split("&"),o=0,n=a.length;o<n;o++){var s=a[o].split("=");t[s[0]]=s[1]}return t},toPicofOne:function(){wx.previewImage({urls:[this.data.labelcodeimg2]})},toPicofTwo:function(){wx.previewImage({urls:[this.data.labelcodeimg3]})},toPicofThree:function(){wx.previewImage({urls:[this.data.labelcodeimg1]})},scanCode:function(){var e=this;if("2"==e.data.chooseType){wx.getAccountInfoSync().miniProgram.appId;wx.navigateTo({url:"plugin://qcc-scan-plugin/scan-page"})}else wx.scanCode({onlyFromCamera:!0,success:function(a){if(a.result){a.result;var o=a.result.lastIndexOf("/"),s=a.result.substring(o+1,a.result.length);if(a.result.includes("https"))wx.request({url:"https://nanjingdeyang.qccvas.com/gateway-nginx/open-platform/v1/codeDetail/selectDetailByCode?codeType=6&code="+s,method:"GET",header:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8'"},data:{tenantId:"nanjingdeyang"},success:function(a){var o=a.data.data.codesInfo.codes.customCode.details[1];if(15==o.length)var s={labelcode:o.substring(0,o.lastIndexOf("-"))};else s={labelcode:o};wx.request({url:n+"/jczx/findConcreteTestBlock_Labelone",method:"POST",header:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8'"},data:s,success:function(a){if("success"!=a.data.message)wx.showToast({title:a.data.message,icon:"none",duration:3e3,success:function(){setTimeout((function(){e.scanCode()}),3e3)}});else{var n=o.substring(0,o.indexOf("-"));if(-1!==e.data.arr.indexOf(n))wx.showToast({title:"该组试块已扫描",icon:"none",duration:3e3,success:function(){setTimeout((function(){e.scanCode()}),3e3)}});else{if(15==o.length)var s={labelcode:o.substring(0,o.lastIndexOf("-"))};else s={labelcode:o};t.postForm("/Index/verificationTestBlock",s,(function(t){e.setData({labelcodeimg1:t.data.labelcodeimg1,labelcodeimg2:t.data.labelcodeimg2,labelcodeimg3:t.data.labelcodeimg3})})),e.data.arr.push(n),15==o.length?e.setData({num:e.data.num+1,labelcode:o.substring(0,o.lastIndexOf("-"))}):e.setData({num:e.data.num+1,labelcode:o}),wx.showToast({title:"扫描成功",icon:"none",duration:3e3,success:function(){setTimeout((function(){e.scanCode()}),3e3)}})}}}})}});else{if(15==a.result.length)var i={labelcode:a.result.substring(0,a.result.lastIndexOf("-"))};else i={labelcode:a.result};wx.request({url:n+"/jczx/findConcreteTestBlock_Labelone",method:"POST",header:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8'"},data:i,success:function(o){if("success"!=o.data.message)wx.showToast({title:o.data.message,icon:"none",duration:3e3,success:function(){setTimeout((function(){e.scanCode()}),3e3)}});else{var n=a.result.substring(0,a.result.indexOf("-"));if(-1!==e.data.arr.indexOf(n))wx.showToast({title:"该组试块已扫描",icon:"none",duration:3e3,success:function(){setTimeout((function(){e.scanCode()}),3e3)}});else{if(15==a.result.length)var s={labelcode:a.result.substring(0,a.result.lastIndexOf("-"))};else s={labelcode:a.result};t.postForm("/Index/verificationTestBlock",s,(function(t){e.setData({labelcodeimg1:t.data.labelcodeimg1,labelcodeimg2:t.data.labelcodeimg2,labelcodeimg3:t.data.labelcodeimg3})})),e.data.arr.push(n),15==a.result.length?e.setData({num:e.data.num+1,labelcode:a.result.substring(0,a.result.lastIndexOf("-"))}):e.setData({num:e.data.num+1,labelcode:a.result}),wx.showToast({title:"扫描成功",icon:"none",duration:3e3,success:function(){setTimeout((function(){e.scanCode()}),3e3)}})}}}})}}else wx.showToast({title:"请扫描正确的二维码！",icon:"none",duration:3e3,success:function(){setTimeout((function(){e.scanCode()}),3e3)}})}})},changeAvatar:function(e){var t=this;t.isAuth();var o={},n=e.currentTarget.dataset.sign;wx.chooseImage({count:0,sizeType:["compressed"],sourceType:["camera"],success:function(e){var s=wx.getFileSystemManager().readFileSync(e.tempFilePaths[0],"base64");o["src"+n]="data:image/png;base64,"+s,o["sign"+n+"_class"]="show",t.setData({"data_arr.wtphoto":o["src"+n],"req_arr.wtphoto":o["src"+n],"req_arr.wtphototime":a.formatTime(new Date)})},fail:function(e){wx.showToast({title:"已取消",icon:"none"})}})},tointVla:function(e){this.setData({sginput:e.detail.value})},toAddSG:function(){var e=this,a=e.data.sginput;if(""!=a){var o={labelcode:a};wx.request({url:n+"/jczx/findConcreteTestBlock_Labelone",method:"POST",header:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8'"},data:o,success:function(o){if("success"!=o.data.message)wx.showToast({title:o.data.message,icon:"none",duration:3e3});else if(-1!==e.data.arr.indexOf(a.substring(0,a.indexOf("-"))))wx.showToast({title:"该组试块已添加",icon:"none"});else{wx.showToast({title:"手工补录成功"}),e.data.arr.push(a.substring(0,a.indexOf("-"))),e.setData({num:e.data.num+1});var n={labelcode:a};t.postForm("/Index/verificationTestBlock",n,(function(t){e.setData({labelcodeimg1:t.data.labelcodeimg1,labelcodeimg2:t.data.labelcodeimg2,labelcodeimg3:t.data.labelcodeimg3})}))}}})}else wx.showToast({title:"请输入内容再进行添加",icon:"none"})},toUploadInfo:function(){wx.showLoading({title:"验样中...",mask:!0});for(var e=this,t=[],a=0;a<e.data.arr.length;a++)for(var o=0;o<3;o++){var s=e.data.arr[a]+"-"+(o+1);t.push(s)}e.data.req_arr.codeList=t,e.data.req_arr.jcdwbh=wx.getStorageSync("jcdwbh").toUpperCase(),e.data.req_arr.jcdwmc=wx.getStorageSync("jcdwmc"),e.data.req_arr.ygname=wx.getStorageSync("ygname"),e.data.req_arr.zgbh=wx.getStorageSync("gh");var i=e.data.req_arr;return null==e.data.data_arr.wtphoto?(wx.hideLoading(),wx.showToast({title:"请上传照片",icon:"none",duration:2e3}),!1):0==e.data.req_arr.codeList.length?(wx.hideLoading(),wx.showToast({title:"请扫描二维码",icon:"none",duration:2e3}),!1):void wx.request({url:n+"/jczx/uploadJczxYpWtphoto",method:"POST",header:{"Content-Type":"application/json;charset=UTF-8"},data:i,success:function(t){wx.hideLoading(),"验样成功!"==t.data.message?(wx.showToast({title:t.data.message,icon:"none",duration:2e3}),e.setData({codelist:[],"data_arr.wtphoto":"",labelcode:"",num:0,arr:[]})):""==t.data.message?wx.showToast({title:"上传失败",icon:"none",duration:2e3}):wx.showModal({content:t.data.message,title:"提示"})}})},isAuth:function(){var e=this;wx.getSetting({success:function(t){t.authSetting["scope.userLocation"]?e.yesAuth():wx.showModal({title:"提示",content:"请求获取位置权限",success:function(t){t.confirm?e.yesAuth():t.cancel&&wx.navigateBack({delta:2})}})}})},yesAuth:function(){wx.showLoading({title:"请稍后..."});var t=this;wx.getLocation({type:"gcj02",isHighAccuracy:!0,success:function(a){t.setData({"req_arr.wtphotolatitude":a.latitude,"req_arr.wtphotolongitude":a.longitude}),e.reverseGeocoder({location:{latitude:a.latitude,longitude:a.longitude},success:function(e){wx.hideLoading(),t.setData({"req_arr.wtphotoaddress":e.result.address,"data_arr.zxaddress":e.result.address})},fail:function(e){}})},fail:function(e){wx.hideLoading(),wx.showModal({title:"提示",content:"您必须授权定位，否则无法使用",success:function(e){(e.confirm||e.cancel)&&wx.navigateBack({delta:2})}})}})},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){}});
},{isPage:true,isComponent:true,currentFile:'pages/codeinfo/codeinfo.js'});require("pages/codeinfo/codeinfo.js");