$gwx_XC_46=function(_,_v,_n,_p,_s,_wp,_wl,$gwn,$gwl,$gwh,wh,$gstack,$gwrt,gra,grb,TestTest,wfor,_ca,_da,_r,_rz,_o,_oz,_1,_1z,_2,_2z,_m,_mz,nv_getDate,nv_getRegExp,nv_console,nv_parseInt,nv_parseFloat,nv_isNaN,nv_isFinite,nv_decodeURI,nv_decodeURIComponent,nv_encodeURI,nv_encodeURIComponent,$gdc,nv_JSON,_af,_gv,_ai,_grp,_gd,_gapi,$ixc,_ic,_w,_ev,_tsd){return function(path,global){
if(typeof global==='undefined'){if (typeof __GWX_GLOBAL__==='undefined')global={};else global=__GWX_GLOBAL__;}if(typeof __WXML_GLOBAL__ === 'undefined') {__WXML_GLOBAL__={};
}__WXML_GLOBAL__.modules = __WXML_GLOBAL__.modules || {};
var e_={}
if(typeof(global.entrys)==='undefined')global.entrys={};e_=global.entrys;
var d_={}
if(typeof(global.defines)==='undefined')global.defines={};d_=global.defines;
var f_={}
if(typeof(global.modules)==='undefined')global.modules={};f_=global.modules || {};
var p_={}
__WXML_GLOBAL__.ops_cached = __WXML_GLOBAL__.ops_cached || {}
__WXML_GLOBAL__.ops_set = __WXML_GLOBAL__.ops_set || {};
__WXML_GLOBAL__.ops_init = __WXML_GLOBAL__.ops_init || {};
var z=__WXML_GLOBAL__.ops_set.$gwx_XC_46 || [];
function gz$gwx_XC_46_1(){
if( __WXML_GLOBAL__.ops_cached.$gwx_XC_46_1)return __WXML_GLOBAL__.ops_cached.$gwx_XC_46_1
__WXML_GLOBAL__.ops_cached.$gwx_XC_46_1=[];
(function(z){var a=11;function Z(ops){z.push(ops)}
Z([3,'design-platform-page'])
Z(z[0])
Z([a,[3,'min-height: '],[[2,'?:'],[[7],[3,'pageMode']],[[2,'+'],[[2,'+'],[1,'calc(100vh - '],[[2,'||'],[[7],[3,'tabBarHeight']],[1,0]]],[1,'rpx)']],[1,'']]])
Z([3,'moduleCallback'])
Z([[7],[3,'_exData']])
Z([[7],[3,'functions']])
Z([3,'design_components'])
Z([[7],[3,'_sticky']])
Z([[7],[3,'weimobCloudInfo']])
Z([[2,'&&'],[[2,'&&'],[[7],[3,'enablePagination']],[[2,'!'],[[7],[3,'_lastPage']]]],[[7],[3,'firstPageAllReady']]])
})(__WXML_GLOBAL__.ops_cached.$gwx_XC_46_1);return __WXML_GLOBAL__.ops_cached.$gwx_XC_46_1
}
__WXML_GLOBAL__.ops_set.$gwx_XC_46=z;
__WXML_GLOBAL__.ops_init.$gwx_XC_46=true;
var x=['./cms_design/RAW/miniprogram_npm/@design-platform/wx-sdk/index.wxml'];d_[x[0]]={}
var m0=function(e,s,r,gg){
var z=gz$gwx_XC_46_1()
var bUW=_mz(z,'view',['class',0,'id',1,'style',1],[],e,s,gg)
var xWW=_mz(z,'design-components',['bind:moduleCallback',3,'exData',1,'functions',2,'id',3,'sticky',4,'weimobCloudInfo',5],[],e,s,gg)
var oXW=_n('slot')
_(xWW,oXW)
_(bUW,xWW)
var oVW=_v()
_(bUW,oVW)
if(_oz(z,9,e,s,gg)){oVW.wxVkey=1
}
oVW.wxXCkey=1
_(r,bUW)
return r
}
e_[x[0]]={f:m0,j:[],i:[],ti:[],ic:[]}
if(path&&e_[path]){
return function(env,dd,global){$gwxc=0;var root={"tag":"wx-page"};root.children=[]
;g="$gwx_XC_46";var main=e_[path].f
if (typeof global==="undefined")global={};global.f=$gdc(f_[path],"",1);
try{
main(env,{},root,global);
_tsd(root)
}catch(err){
console.log(err)
}
;g="";
return root;
}
}
}
}(__g.a,__g.b,__g.c,__g.d,__g.e,__g.f,__g.g,__g.h,__g.i,__g.j,__g.k,__g.l,__g.m,__g.n,__g.o,__g.p,__g.q,__g.r,__g.s,__g.t,__g.u,__g.v,__g.w,__g.x,__g.y,__g.z,__g.A,__g.B,__g.C,__g.D,__g.E,__g.F,__g.G,__g.H,__g.I,__g.J,__g.K,__g.L,__g.M,__g.N,__g.O,__g.P,__g.Q,__g.R,__g.S,__g.T,__g.U,__g.V,__g.W,__g.X,__g.Y,__g.Z,__g.aa);if(__vd_version_info__.delayedGwx||false)$gwx_XC_46();	if (__vd_version_info__.delayedGwx) __wxAppCode__['cms_design/RAW/miniprogram_npm/@design-platform/wx-sdk/index.wxml'] = [$gwx_XC_46, './cms_design/RAW/miniprogram_npm/@design-platform/wx-sdk/index.wxml'];else __wxAppCode__['cms_design/RAW/miniprogram_npm/@design-platform/wx-sdk/index.wxml'] = $gwx_XC_46( './cms_design/RAW/miniprogram_npm/@design-platform/wx-sdk/index.wxml' );
	;__wxRoute = "cms_design/RAW/miniprogram_npm/@design-platform/wx-sdk/index";__wxRouteBegin = true;__wxAppCurrentFile__="cms_design/RAW/miniprogram_npm/@design-platform/wx-sdk/index.js";define("cms_design/RAW/miniprogram_npm/@design-platform/wx-sdk/index.js",function(require,module,exports,window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){
"use strict";require("../../../../../@babel/runtime/helpers/Arrayincludes");var e=require("../../../../../@babel/runtime/helpers/objectWithoutProperties"),t=require("../../../../../@babel/runtime/helpers/regeneratorRuntime"),a=require("../../../../../@babel/runtime/helpers/toConsumableArray"),o=require("../../../../../@babel/runtime/helpers/defineProperty"),i=require("../../../../../@babel/runtime/helpers/objectSpread2"),s=["moduleData","params","callback","exData"];require("../../../titan.bootstrap.js");var n=global.bc("package","cms_design"),r=require("../../../titan-scoped-env.js"),l=require("../../../../../@titan/env.js"),d=require("../wx-utils/global.js"),u=require("./dealPageModules"),c=P(require("./addCartHooks")),g=P(require("./deliveryHooks")),h=P(require("./queryModuleDataSource")),p=require("./global"),f=require("./util"),m=require("./weimobCloudHooks"),v=require("./store");function P(e){return e&&e.__esModule?e:{default:e}}var L=r.requirePlatform("cms").main,M=L.CMS,b=L.debounce,x=(0,d.getPlatFormChannel)(),D=(0,d.getPlatFormLabel)();r.Component({behaviors:[c.default,g.default],properties:{exData:{type:Object,value:{}},pageModules:Array,devPageModules:Array,serverPageModules:Array,enablePagination:{type:Boolean,value:!1},hooks:{type:Object,value:{}},weimobCloudInfo:Object,lastPage:{type:Boolean,value:!1}},options:{addGlobalClass:!0},data:{_sticky:0,firstPageAllReady:!1,tabBarHeight:0},lifetimes:{attached:function(){var e,t;this.pageWithLocationMoreModules=[],this.locationMenuAttached=!1,this.localPageInfos=[],this.pageIndex=0,this.pageScrollTop=0,this.init();var a=(0,p.getMenuButtonBoundingClientRect)();this.setData({_sticky:a.bottom+4,_exData:i(i({contextData:{}},this.data._exData||{}),{},{navStickyHeight:(0,f.getNavStickyHeight)(a),addCart:(null===(e=this.data._exData)||void 0===e?void 0:e.addCart)||this.addCart.bind(this),delivery:(null===(t=this.data._exData)||void 0===t?void 0:t.delivery)||this.delivery.bind(this)})});var o=r.wx.getSystemInfoSync();this.screenHeight=o.screenHeight,this.halfScreenHeight=this.screenHeight/3,this.data.exData&&this.data.exData.currentHasLocationMenu&&this.getInitPageScrollOffset()},ready:function(){},detached:function(){this.intersectionObserver&&this.intersectionObserver.disconnect(),(0,v.unwatchStore)()}},observers:{exData:function(e){var t=this.data._exData||{};this.setData({_exData:i(i(i({},this.data._exData),e),{},{hasLocationMenu:e.hasLocationMenu||t.hasLocationMenu})})}},methods:{init:function(){this.copyPropsToData(),(0,v.clearStore)();var e=this.data,t=e.devPageModules,a=e.serverPageModules,o=e.pageModules;if(t&&t.length>0)this.updateLocalPages({"localPages[0]":this.getNormalizePageModules(t)});else if(a&&a.length>0){var s=(0,u.dealPageComponents)(a,{pageIndex:0,weimobCloudInfo:this.data.weimobCloudInfo}).pageModules||[];this.updateLocalPages({"localPages[0]":this.getNormalizePageModules(s,!1)}),this.setData({_exData:i(i(i({},this.data._exData),this.getExData()),{},{dataPageSize:20})}),this.firstPageNeedLoadCount=s.length,this.firstPageNeedImmediateLoadCount=s.filter((function(e){return!e.needAsyncLoadData})).length,this.firstPageModules=[]}else{var n=(0,u.dealPageComponents)(o,{pageIndex:0,weimobCloudInfo:this.data.weimobCloudInfo});this.initHooks();var r=n.pageModules||[],l=this.data.exData,d=l.hasLocationMenu,c=l.currentHasLocationMenu,g=l.parentHasLocationMenu;!(d&&r.length>10)||c&&g||(this.pageWithLocationMoreModules=r.slice(10),r=r.slice(0,10),this.locationMenuAttached=this.checkHasLocation(r),this.pageWithLocationInit()),this.updateLocalPages({"localPages[0]":r}),this.setData({_exData:i(i(i({},this.data._exData),this.getExData()),{},{dataPageSize:20}),_lastPage:d?this.pageWithLocationMoreModules.length<=0:this.data._lastPage}),this.firstPageNeedLoadCount=r.length,this.firstPageNeedImmediateLoadCount=r.filter((function(e){return!e.needAsyncLoadData})).length,this.firstPageModules=[],0===this.firstPageNeedImmediateLoadCount&&(this.firstPageAllAsync=!0),this.locationMenuAttached&&this.pageWithLocationVirtualListCreate()}},copyPropsToData:function(){this.setData({_exData:(0,f.deepCopy)(this.data.exData),_lastPage:(0,f.deepCopy)(this.data.lastPage)})},initHooks:function(){var e=this,t=r.getApp();t.hooks={base:i(i(i({},this.data.hooks.base),(0,m.getHooks)({root:this,exData:this.data._exData}).base),{},{getTopNavigationHeight:function(){return e.data._sticky||80}})},t.hooks.base.addCart||(t.hooks.base.addCart=function(t){return e.triggerEvent("moduleCallback",{type:"addCart",item:t})})},getExData:function(){var e=M.getCacheLocation();if(e){var t=e.latitude,a=e.longitude;this.latitude=t,this.longitude=a}return{longitude:this.longitude,latitude:this.latitude,$platFormChannel:x,$platFormLabel:D,$platFormSource:(0,d.getPlatFormSource)(),$isWeiXin:x===d.WeiXin,$isAliPay:x===d.AliPay,$isXhs:x===d.Xhs}},getInitPageScrollOffset:function(){var e=this;this.createSelectorQuery().selectViewport().scrollOffset((function(t){e.pageScrollTop||(e.pageScrollTop=t.scrollTop||0)})).exec()},pageWithLocationInit:function(){this.localPageInfos[0]={virtualList:!1,totalHeight:0},this.page=r.getCurrentPages()[r.getCurrentPages().length-1],this.page.onPageScrollHandler||(this.page.onPageScrollHandler=[]),this.page.onPageScrollHandler.push(this.pageScroll.bind(this))},getNormalizePageModules:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.map((function(e,a){return e.show=t,e.extra=e.extra||{},e}))},createObserve:function(){var e=this;try{var t=function(){if(x===d.Xhs){if(e.pageLoading)return;e.xhsCreateObserveTimer&&(r.clearTimeout(e.xhsCreateObserveTimer),delete e.xhsCreateObserveTimer)}else(e.data._lastPage||e.data.enablePagination)&&e.intersectionObserver.disconnect();e.locationMenuAttached||e._lastPage||(e.pageWithLocationMoreModules.length>0?e.pageWithLocationLoadMore():e.loadDataByPage(e.pageIndex+1))};x===d.Xhs&&this.intersectionObserver?this.pageIndex<2&&(this.xhsCreateObserveTimer=r.setTimeout((function(){t()}),200)):this.intersectionObserver=r.wx.createIntersectionObserver(this),this.intersectionObserver.relativeToViewport().observe(".loadMore",(function(e){t()}))}catch(e){var a;null===(a=r.wx.hound)||void 0===a||a.reportError({pageId:this.data.exData.pageId,msg:"分页加载监听异常",error:e})}},loadDataByPage:function(e){var t=this;this.pageLoading||(this.pageLoading=!0,this.pageIndex=e,this.triggerEvent("pageLoadMore",{pageNum:e+1,callback:function(a){var i=a||{},s=i.pageModules,n=i.lastPage;if(s){var r=(0,u.dealPageComponents)(s,{pageIndex:e,weimobCloudInfo:t.data.weimobCloudInfo}).pageModules||[];t.morePageNeedLoadCount=r.length,t.morePageNeedImmediateLoadCount=r.filter((function(e){return!e.needAsyncLoadData})).length,t.morePageModules=[],t.updateLocalPages(o({},"localPages[".concat(e,"]"),r)),t.setData({_lastPage:n}),n&&(t._lastPage=!0)}}}))},refreshPageLoadObserve:function(){var e=this.data,t=e._lastPage,a=e.enablePagination;!t&&a&&this.createObserve()},getDesignComponentsInstance:function(){return this.designComponentsInstance||(this.designComponentsInstance=this.selectComponent("#design_components")),this.designComponentsInstance},updateLocalPages:function(e,t){var a=this.getDesignComponentsInstance();a&&a.updatePages(e,t)},getLocalPages:function(){var e=this.getDesignComponentsInstance();return e?e.data.localPages:[]},makeChangeData:function(e,t){var a=t.pageIndex,o=t.index,i=t.moduleData,s=t.isEmpty,n=t.globalTicket,r=t.isCustom,l=t.virtualLoaded;e["localPages[".concat(a,"][").concat(o,"].show")]=!s,e["localPages[".concat(a,"][").concat(o,"].isEmpty")]=s,n&&(e["localPages[".concat(a,"][").concat(o,"].globalTicket")]=n),i&&(e["localPages[".concat(a,"][").concat(o,"].moduleData")]=i,r&&(e["localPages[".concat(a,"][").concat(o,"].wcModule")]=(0,u.getWcModule)(i,this.data.weimobCloudInfo))),l&&(e["localPages[".concat(a,"][").concat(o,"].virtualLoaded")]=!0,e["localPages[".concat(a,"][").concat(o,"].virtualShow")]=!1)},pageWithLocationLoadMore:function(){var e=this;if(this.pageWithLocationMoreModules.length>0){var t=this.pageWithLocationMoreModules.slice(0,10);this.locationMenuAttached||(this.locationMenuAttached=this.checkHasLocation(t),this.pageIndex+=1,t.forEach((function(t){t.pageIndex=e.pageIndex,t.moduleData&&(t.moduleData.pageIndex=e.pageIndex)})),this.morePageNeedLoadCount=t.length,this.morePageModules=[],this.morePageNeedImmediateLoadCount=t.filter((function(e){return!e.needAsyncLoadData})).length,this.pageWithLocationMoreModules=this.pageWithLocationMoreModules.slice(10),this.updateLocalPages(o({},"localPages[".concat(this.pageIndex,"]"),a(t))),this.setData({_lastPage:this.pageWithLocationMoreModules.length<=0},(function(){e.locationMenuAttached&&e.pageWithLocationVirtualListCreate()})),this.localPageInfos[this.pageIndex]={virtualList:!1,totalHeight:0})}},pageWithLocationVirtualListCreate:function(){var e=this,t=this.pageWithLocationMoreModules;if(t&&t.length&&!this.pageWithLocationVirtualListCreated){this.pageWithLocationVirtualListCreated=!0,this.pageIndex+=1;var a=[];t.forEach((function(t,o){t.virtualShow=!0,t.pageIndex=e.pageIndex,t.moduleData&&(t.moduleData.pageIndex=e.pageIndex),a[o]=t.isEmpty?0:196})),this.updateLocalPages(o({},"localPages[".concat(this.pageIndex,"]"),t)),this.setData({_lastPage:!0},(function(){e.pageWithLocationMoreModules=[]})),this.localPageInfos[this.pageIndex]={virtualList:!0,moduleHeightList:a}}},updateModuleHeightOfPage:function(e){var t=this,a=this.data._exData;a.hasLocationMenu&&this.createSelectorQuery().selectAll("#design_components >>> #page_index_".concat(e)).boundingClientRect((function(o){if(o){o.length>0&&(o=o[0]);var i=o.height,s=t.localPageInfos[e];s&&(s.totalHeight=i),0===e&&a.currentHasLocationMenu&&0!=o.top&&(t.scrollTopOutside=o.top+(t.pageScrollTop||0)),t.virtualListInScreenAutoLoad()}})).exec()},updateModuleHeight:function(e,t,a){var o=this;e&&this.createSelectorQuery().select("#design_components >>> #widget_".concat(e.id)).boundingClientRect((function(i){if(i){var s=o.localPageInfos[e.pageIndex];s.virtualList&&(s.moduleHeightList[t]=i.height),a&&a(i.height)}})).exec()},updateScrollTopOutside:b((function(){this.updateModuleHeightOfPage(0)}),1e3),pageScroll:b((function(e){var t=this,a=e.scrollTop;if(this.pageScrollTop=a,!this.moduleJumpScrolling){this.data._exData.currentHasLocationMenu&&this.updateScrollTopOutside();var o=this.scrollTopOutside||0;this.localPageInfos.forEach((function(e,i){if(e.virtualList)for(var s=e.moduleHeightList,n=function(e){var n=s[e];if(n&&(o+=n),o>a+t.halfScreenHeight){var r=t.getLocalPages()[i][e];return r.virtualShow?t.virtualModuleRealAttach(r,e).then((function(){t.autoLoadMoreAfterVirtualModule(r,e,{autoLoadNext:!0})})):t.autoLoadMoreAfterVirtualModule(r,e,{autoLoadNext:!0}),1}},r=0;r<s.length&&!n(r);++r);else o+=e.totalHeight}))}}),300),autoLoadMoreAfterVirtualModule:function(e,t){var a=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=o.loadCount,s=void 0===i?3:i,n=o.autoLoadNext,r=void 0!==n&&n,l=this.getLocalPages(),d=l[e.pageIndex];if(d)for(var u=t+1,c=0,g=0;g<s;++g){var h=u+g,p=d[h];p&&this.virtualModuleRealAttach(p,h,(function(){if(c+=1,r&&c===s){var e=t+s;d[e+1]&&a.nextVirtualModuleInScreenAutoLoad(d[e],e)}}))}},virtualModuleRealAttach:function(e,a,o){var i=this;return(0,l.babel_coroutine)(t().mark((function s(){var n,l,d,u,c,g,p;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(!e.virtualLoaded&&!e.show){t.next=5;break}return o&&o(),t.abrupt("return");case 5:if(n=i.data._exData,l={},d=null,u=null,c=e.isEmpty,!e.needAsyncLoadData){t.next=21;break}return t.prev=8,t.next=11,(0,h.default)(e.moduleData,n);case 11:g=t.sent,d=g.moduleData,u=g.globalTicket,t.next=20;break;case 16:t.prev=16,t.t0=t.catch(8),console.error("queryModuleDataSource Error!",t.t0),null===(p=r.wx.hound)||void 0===p||p.reportError({pageId:n.pageId,msg:"数据源接口请求异常",error:t.t0});case 20:c=!d||d.isEmptyModule;case 21:i.makeChangeData(l,{pageIndex:e.pageIndex,index:a,isEmpty:c,virtualLoaded:!0,moduleData:d,globalTicket:u,isCustom:e.isCustom}),i.updateLocalPages(l,(function(){r.setTimeout((function(){i.updateModuleHeight(e,a,(function(){o&&o()}))}),800),r.setTimeout((function(){i.updateModuleHeight(e,a)}),2e3)}));case 23:case"end":return t.stop()}}),s,null,[[8,16]])})))()},virtualListInScreenAutoLoad:function(){var e=this,t=this.localPageInfos,a=0,o=0;if(t.forEach((function(e,t){e.virtualList?o=t:a+=e.totalHeight})),a<this.screenHeight&&o){var i=this.getLocalPages(),s=i[o][0];s&&this.virtualModuleRealAttach(s,0).then((function(){e.autoLoadMoreAfterVirtualModule(s,0,{loadCount:5})}))}},nextVirtualModuleInScreenAutoLoad:function(e,t){var a=this,o=t+1,i=0;this.localPageInfos.forEach((function(s,n){if(s.virtualList){for(var r=s.moduleHeightList,l=0;l<o;++l){var d=r[l];d&&(i+=d)}0<i-a.pageScrollTop<a.screenHeight&&a.autoLoadMoreAfterVirtualModule(e,t)}else i+=s.totalHeight}))},firstPageWidgetReady:function(e){var t=this,a=e.index,o=e.module,i=e.moduleData,s=o.needAsyncLoadData,n=o.isEmpty;this.firstPageNeedLoadCount-=1;var l=this,d=function(){l.firstPageNeedLoadCount<=0&&(l.firstPageAllReady||(l.firstPageAllReady=!0,l.firstPageAllAsync&&M.hideLoading()),l.data.firstPageAllReady||(l.setData({firstPageAllReady:!0}),l.refreshPageLoadObserve(),r.setTimeout((function(){l.updateModuleHeightOfPage(0)}),800),r.setTimeout((function(){l.updateModuleHeightOfPage(0)}),2e3)))};if(s){var u={};this.makeChangeData(u,{pageIndex:o.pageIndex,index:a,moduleData:i,globalTicket:o.globalTicket,isEmpty:n,isCustom:o.isCustom}),this.updateLocalPages(u,(function(){d()}))}else if(this.firstPageNeedImmediateLoadCount-=1,this.firstPageModules.push({moduleData:i,index:a,pageIndex:o.pageIndex,isEmpty:n,isCustom:o.isCustom}),this.firstPageNeedImmediateLoadCount<=0&&this.firstPageModules.length){r.TitanTools.PerfDog.of(this).markInteractive(),M.hideLoading();var c={};this.firstPageModules.forEach((function(e){e&&t.makeChangeData(c,e)})),this.updateLocalPages(c,(function(){d()})),this.firstPageModules=[]}},morePageWidgetReady:function(e){var t=this,a=e.index,o=e.module,i=e.moduleData,s=o.needAsyncLoadData,n=o.isEmpty,l=this,d=function(){l.morePageNeedLoadCount<=0&&(l.pageLoading=!1,l.refreshPageLoadObserve(),r.setTimeout((function(){l.updateModuleHeightOfPage(o.pageIndex)}),800),r.setTimeout((function(){l.updateModuleHeightOfPage(o.pageIndex)}),2e3))};if(s){var u={};this.makeChangeData(u,{pageIndex:o.pageIndex,index:a,moduleData:i,globalTicket:o.globalTicket,isEmpty:n,isCustom:o.isCustom}),this.updateLocalPages(u,(function(){t.morePageNeedLoadCount-=1,d()}))}else if(this.morePageNeedLoadCount-=1,this.morePageNeedImmediateLoadCount-=1,this.morePageModules.push({moduleData:i,index:a,pageIndex:o.pageIndex,isEmpty:n,isCustom:o.isCustom}),this.morePageNeedImmediateLoadCount<=0&&this.morePageModules.length){var c={};this.morePageModules.forEach((function(e){e&&t.makeChangeData(c,e)})),this.updateLocalPages(c,(function(){d()})),this.morePageModules=[]}},widgetReady:function(e){0!==e.module.pageIndex?this.morePageWidgetReady(e):this.firstPageWidgetReady(e)},refreshModuleData:function(e){var t=this,a=e.index,s=e.moduleData,n=e.exData;(0,h.default)(s,i(i({},this.data._exData),n)).then((function(e){t.updateLocalPages(o({},"localPages[".concat(s.pageIndex,"][").concat(a,"].moduleData"),e.moduleData))}))},queryModuleData:function(t){var a=t.moduleData,o=t.params,n=t.callback,r=t.exData,l=e(t,s);(0,h.default)(a,i(i({},this.data._exData),r),o).then((function(e){n&&n(i(i({},l),{},{moduleData:a,params:o,resModuleData:e.moduleData}))}))},setSticky:function(e){this.setData({_sticky:e,"_exData.topNavHeight":e})},setExData:function(e){this.setData({"_exData.contextData":i(i({},this.data._exData.contextData),e)})},refreshPage:function(){this.triggerEvent("callFun",{type:"refreshPage"})},addCartCallback:function(e){this.triggerEvent("callFun",{type:"addCart",options:e.item}),this.triggerEvent("addCart",{item:e.item})},deliveryCallback:function(e){this.triggerEvent("callFun",{type:"delivery",options:e.item}),this.triggerEvent("delivery",{item:e.item})},showDebugCallback:function(){var e=this.getLocalPages();this.triggerEvent("showDebug",{localPages:e})},debugToggleModule:function(e){var t=e.index,a=e.pageIndex,i=e.show;this.updateLocalPages(o({},"localPages[".concat(a,"][").concat(t,"].show"),i))},debugToggleModuleDebug:function(e){var t=e.show;this.setData({"_exData.showDebug":t})},getAllModules:function(e){var t=e.callback;if(t){var a=this.getLocalPages().reduce((function(e,t){return e.concat(t)}),[]);t(a)}},checkHasLocation:function(e){return!(!e||!e.length)&&e.some((function(e){return"@design-platform/location"===e.moduleName}))},scrollToModuleById:function(e){var t=this,a=e.moduleId,o=e.scrollTop,i=e.duration,s=e.success;if(a&&o){var n=this.getLocalPages();this.moduleJumpScrolling=!0;r.wx.pageScrollTo({scrollTop:o,duration:i||300,success:function(){var e,i;s&&s(),t.pageScrollTop=o,n.forEach((function(t,o){t.forEach((function(t,o){t.id===a&&(e=t,i=o)}))})),e&&t.virtualModuleRealAttach(e,i).then((function(){t.autoLoadMoreAfterVirtualModule(e,i,{loadCount:5})})),r.setTimeout((function(){t.moduleJumpScrolling=!1}),300)},fail:function(){t.moduleJumpScrolling=!1},complete:function(){!0}})}},updateModuleHeightCallback:function(e){var t=e.moduleData;if(t){var a=t.pageIndex,o=this.localPageInfos[a];if(o)if(o.virtualList){var i=this.getLocalPages()[a].findIndex((function(e){return e.id===t.id}));i>=0&&this.updateModuleHeight(t,i)}else this.updateModuleHeightOfPage(a)}},moduleRec:function(e){var t=e.moduleData,a=e.data,o=this.data._exData||{},s=o.pagename,n=void 0===s?"":s,l=o.pageId,d=void 0===l?"":l,u=o.currentPageId,c={pageid:d,pagename:n};if(t){var g=t.id,h=t.moduleId,p=t.moduleName;c.mid=g,c.module_id=h,c.module_name=p}u&&(c.inpageid=u),r.wx.rprm.rec(i(i({},c),a))},moduleCallback:function(e){var t=e.detail.detail;if(t&&t.type)switch(["addCart","delivery","refreshPage","showModal","hideModal","showDebug","hidePoweredBy","startPlayVideo"].includes(t.type)&&this.triggerEvent("moduleCallback",t),t.type,t.type){case"widgetReady":this.widgetReady(t);break;case"addCart":this.addCartCallback(t);break;case"delivery":this.deliveryCallback(t);break;case"refreshModuleData":this.refreshModuleData(t);break;case"queryModuleData":this.queryModuleData(t);break;case"setSticky":this.setSticky(t.data);break;case"refreshPage":this.refreshPage();break;case"showModal":this.triggerEvent("callFun",{type:"showModal",options:t});break;case"hideModal":this.triggerEvent("callFun",{type:"hideModal",options:t});break;case"showDebug":this.showDebugCallback();break;case"hidePoweredBy":this.triggerEvent("callFun",{type:"hidePoweredBy"});break;case"setStore":(0,v.setStore)(t);break;case"getStore":(0,v.getStore)(t);break;case"watchStore":(0,v.watchStore)(t);break;case"getAllModules":this.getAllModules(t);break;case"setExData":this.setExData(t.data);break;case"startPlayVideo":this.triggerEvent("callFun",{type:"startPlayVideo"});break;case"scrollToModule":this.scrollToModuleById(t);break;case"updateModuleHeight":this.updateModuleHeightCallback(t);break;case"moduleRec":this.moduleRec(t)}}}}),global.ec(n);
},{isPage:false,isComponent:true,currentFile:'cms_design/RAW/miniprogram_npm/@design-platform/wx-sdk/index.js'});require("cms_design/RAW/miniprogram_npm/@design-platform/wx-sdk/index.js");