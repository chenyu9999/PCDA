$gwx_XC_75=function(_,_v,_n,_p,_s,_wp,_wl,$gwn,$gwl,$gwh,wh,$gstack,$gwrt,gra,grb,TestTest,wfor,_ca,_da,_r,_rz,_o,_oz,_1,_1z,_2,_2z,_m,_mz,nv_getDate,nv_getRegExp,nv_console,nv_parseInt,nv_parseFloat,nv_isNaN,nv_isFinite,nv_decodeURI,nv_decodeURIComponent,nv_encodeURI,nv_encodeURIComponent,$gdc,nv_JSON,_af,_gv,_ai,_grp,_gd,_gapi,$ixc,_ic,_w,_ev,_tsd){return function(path,global){
if(typeof global==='undefined'){if (typeof __GWX_GLOBAL__==='undefined')global={};else global=__GWX_GLOBAL__;}if(typeof __WXML_GLOBAL__ === 'undefined') {__WXML_GLOBAL__={};
}__WXML_GLOBAL__.modules = __WXML_GLOBAL__.modules || {};
var e_={}
if(typeof(global.entrys)==='undefined')global.entrys={};e_=global.entrys;
var d_={}
if(typeof(global.defines)==='undefined')global.defines={};d_=global.defines;
var f_={}
if(typeof(global.modules)==='undefined')global.modules={};f_=global.modules || {};
var p_={}
__WXML_GLOBAL__.ops_cached = __WXML_GLOBAL__.ops_cached || {}
__WXML_GLOBAL__.ops_set = __WXML_GLOBAL__.ops_set || {};
__WXML_GLOBAL__.ops_init = __WXML_GLOBAL__.ops_init || {};
var z=__WXML_GLOBAL__.ops_set.$gwx_XC_75 || [];
function gz$gwx_XC_75_1(){
if( __WXML_GLOBAL__.ops_cached.$gwx_XC_75_1)return __WXML_GLOBAL__.ops_cached.$gwx_XC_75_1
__WXML_GLOBAL__.ops_cached.$gwx_XC_75_1=[];
(function(z){var a=11;function Z(ops){z.push(ops)}
Z([3,'indexPage'])
Z([a,[3,'background-color: '],[[2,'?:'],[[7],[3,'hasBg']],[1,'#F1F1F1'],[1,'transparent']],[3,'; border-bottom: none;']])
Z([1,false])
Z([[7],[3,'navigationTitle']])
Z([[2,'!'],[[7],[3,'hasBg']]])
Z([[2,'!'],[[7],[3,'inited']]])
Z([3,'bg2'])
Z([[7],[3,'bg2Styles']])
Z([[7],[3,'errorMsg']])
Z([3,'reloadPage'])
Z(z[8])
Z([a,[3,'scrollview '],[[2,'?:'],[[7],[3,'firstNavShow']],[1,'animate-show'],[1,'']]])
Z([[2,'!'],[[7],[3,'hideAddMinaBar']]])
Z([3,'closeAddMinaBar'])
Z([3,'card'])
Z([[7],[3,'swiperCard']])
Z([3,'margin: 28px 10px 0;'])
Z([[7],[3,'recommendHomePage']])
Z([3,'share'])
Z([3,'updateDailyCashCount'])
Z([[7],[3,'dailyCashSubCount']])
Z([[7],[3,'dailyCash']])
Z([3,'666'])
Z([[7],[3,'showRedCover']])
Z([3,'daily'])
Z([[7],[3,'doneGames']])
Z([[7],[3,'redpacketInfo']])
Z([[7],[3,'wishInfo']])
Z([[7],[3,'wishLottery']])
Z([[7],[3,'showUpcomingLottery']])
Z([[7],[3,'upcomingSubLotteries']])
Z([3,'onSquareAttached'])
Z([[7],[3,'hasMoreSquareGames']])
Z([[7],[3,'normalSquareLotteries']])
Z([[7],[3,'squareLoading']])
Z([[7],[3,'suggestSquareLotteries']])
Z([[2,'&&'],[[2,'!'],[[7],[3,'hasMoreSquareGames']]],[[7],[3,'isSquareInitiator']]])
Z([[2,'&&'],[[2,'!'],[[7],[3,'hasMoreSquareGames']]],[[7],[3,'supprotContact']]])
Z([[2,'&&'],[[2,'!'],[[7],[3,'hasMoreSquareGames']]],[[7],[3,'luckySquareAttached']]])
Z([3,'ad_index_bottom'])
Z([3,'ad-container'])
Z([3,'index'])
Z([[7],[3,'floatBar']])
Z([[7],[3,'floatBarShow']])
Z([[7],[3,'showBadge']])
Z([[7],[3,'buttomNavigationActiveIndex']])
Z([[7],[3,'showActionSheet']])
Z([3,'chooseActionSheet'])
Z([3,'actionsheet'])
Z([[7],[3,'actionsheetList']])
Z(z[46])
Z([[2,'!'],[[7],[3,'hideRedPocket']]])
Z([3,'handleFixedExit'])
Z([3,'handleRedPocketConfirm'])
Z([3,'float'])
Z([[7],[3,'redPocket']])
Z([[7],[3,'scrolling']])
Z([[7],[3,'pushRedPocket']])
Z(z[53])
Z([3,'handleRedPocketHide'])
Z([3,'scan'])
Z(z[55])
Z([1,true])
Z([[7],[3,'needLogin']])
Z([3,'onLogin'])
Z([[7],[3,'showLoginDialog']])
})(__WXML_GLOBAL__.ops_cached.$gwx_XC_75_1);return __WXML_GLOBAL__.ops_cached.$gwx_XC_75_1
}
__WXML_GLOBAL__.ops_set.$gwx_XC_75=z;
__WXML_GLOBAL__.ops_init.$gwx_XC_75=true;
var x=['./pages/index.wxml'];d_[x[0]]={}
var m0=function(e,s,r,gg){
var z=gz$gwx_XC_75_1()
var o0I=_n('view')
_rz(z,o0I,'class',0,e,s,gg)
var cDJ=_mz(z,'Layout',['isHome',-1,'navigationStyle',1,'showHome',1,'title',2,'transparent',3],[],e,s,gg)
var hEJ=_v()
_(cDJ,hEJ)
if(_oz(z,5,e,s,gg)){hEJ.wxVkey=1
var oFJ=_mz(z,'view',['class',6,'style',1],[],e,s,gg)
var cGJ=_n('BigCardBg')
_(oFJ,cGJ)
var oHJ=_n('BulletLoading')
_(oFJ,oHJ)
_(hEJ,oFJ)
}
else if(_oz(z,8,e,s,gg)){hEJ.wxVkey=2
var lIJ=_mz(z,'PageError',['bindreload',9,'error',1],[],e,s,gg)
_(hEJ,lIJ)
}
else{hEJ.wxVkey=3
var aJJ=_n('view')
_rz(z,aJJ,'class',11,e,s,gg)
var fQJ=_n('BigCardBg')
_(aJJ,fQJ)
var tKJ=_v()
_(aJJ,tKJ)
if(_oz(z,12,e,s,gg)){tKJ.wxVkey=1
var cRJ=_n('AddMinaBar')
_rz(z,cRJ,'bindclose',13,e,s,gg)
_(tKJ,cRJ)
}
var hSJ=_mz(z,'SwiperCard',['data-type',14,'swiperCard',1],[],e,s,gg)
_(aJJ,hSJ)
var oTJ=_mz(z,'RecommendHomePageBanner',['customStyle',16,'item',1],[],e,s,gg)
_(aJJ,oTJ)
var cUJ=_mz(z,'DailyCash',['bindshare',18,'bindsubscribed',1,'count',2,'dailyCash',3,'data-type',4],[],e,s,gg)
_(aJJ,cUJ)
var eLJ=_v()
_(aJJ,eLJ)
if(_oz(z,23,e,s,gg)){eLJ.wxVkey=1
var oVJ=_n('RedEnvelopeCover')
_(eLJ,oVJ)
}
var lWJ=_mz(z,'TodaysLottery',['data-type',24,'doneGames',1,'redpacketInfo',2,'wishInfo',3,'wishLottery',4],[],e,s,gg)
_(aJJ,lWJ)
var bMJ=_v()
_(aJJ,bMJ)
if(_oz(z,29,e,s,gg)){bMJ.wxVkey=1
var aXJ=_n('UpcomingLottery')
_rz(z,aXJ,'upcomingSubLotteries',30,e,s,gg)
_(bMJ,aXJ)
}
var tYJ=_mz(z,'LuckySquare',['bindluckySquareAttached',31,'hasMoreSquareGames',1,'normalSquareLotteries',2,'squareLoading',3,'suggestSquareLotteries',4],[],e,s,gg)
_(aJJ,tYJ)
var oNJ=_v()
_(aJJ,oNJ)
if(_oz(z,36,e,s,gg)){oNJ.wxVkey=1
var eZJ=_n('SquareOrderTip')
_(oNJ,eZJ)
}
var xOJ=_v()
_(aJJ,xOJ)
if(_oz(z,37,e,s,gg)){xOJ.wxVkey=1
var b1J=_n('ContactUs')
_(xOJ,b1J)
}
var oPJ=_v()
_(aJJ,oPJ)
if(_oz(z,38,e,s,gg)){oPJ.wxVkey=1
var o2J=_mz(z,'IndexBannerAd',['adName',39,'customClass',1,'pathName',2],[],e,s,gg)
_(oPJ,o2J)
}
tKJ.wxXCkey=1
tKJ.wxXCkey=3
eLJ.wxXCkey=1
eLJ.wxXCkey=3
bMJ.wxXCkey=1
bMJ.wxXCkey=3
oNJ.wxXCkey=1
oNJ.wxXCkey=3
xOJ.wxXCkey=1
xOJ.wxXCkey=3
oPJ.wxXCkey=1
oPJ.wxXCkey=3
_(hEJ,aJJ)
}
hEJ.wxXCkey=1
hEJ.wxXCkey=3
hEJ.wxXCkey=3
hEJ.wxXCkey=3
_(o0I,cDJ)
var x3J=_mz(z,'FloatBar',['floatBar',42,'visible',1],[],e,s,gg)
_(o0I,x3J)
var o4J=_mz(z,'BottomNavigation',['badge',44,'index',1],[],e,s,gg)
_(o0I,o4J)
var xAJ=_v()
_(o0I,xAJ)
if(_oz(z,46,e,s,gg)){xAJ.wxVkey=1
var f5J=_mz(z,'ActionSheet',['bindchoose',47,'id',1,'items',2,'visible',3],[],e,s,gg)
_(xAJ,f5J)
}
var oBJ=_v()
_(o0I,oBJ)
if(_oz(z,51,e,s,gg)){oBJ.wxVkey=1
var c6J=_mz(z,'RedPocket',['bindhandleexit',52,'bindhandletap',1,'id',2,'redPocketInfo',3,'scrolling',4],[],e,s,gg)
_(oBJ,c6J)
}
var fCJ=_v()
_(o0I,fCJ)
if(_oz(z,57,e,s,gg)){fCJ.wxVkey=1
var h7J=_mz(z,'SimpleRedPocket',['bindconfirm',58,'bindhandleboxhide',1,'id',2,'redPocket',3,'toggle',4],[],e,s,gg)
_(fCJ,h7J)
}
xAJ.wxXCkey=1
xAJ.wxXCkey=3
oBJ.wxXCkey=1
oBJ.wxXCkey=3
fCJ.wxXCkey=1
fCJ.wxXCkey=3
_(r,o0I)
var b9I=_v()
_(r,b9I)
if(_oz(z,63,e,s,gg)){b9I.wxVkey=1
var o8J=_mz(z,'LoginDialog',['bindonconfirm',64,'toggle',1],[],e,s,gg)
_(b9I,o8J)
}
b9I.wxXCkey=1
b9I.wxXCkey=3
return r
}
e_[x[0]]={f:m0,j:[],i:[],ti:[],ic:[]}
if(path&&e_[path]){
return function(env,dd,global){$gwxc=0;var root={"tag":"wx-page"};root.children=[]
;g="$gwx_XC_75";var main=e_[path].f
if (typeof global==="undefined")global={};global.f=$gdc(f_[path],"",1);
try{
main(env,{},root,global);
_tsd(root)
}catch(err){
console.log(err)
}
;g="";
return root;
}
}
}
}(__g.a,__g.b,__g.c,__g.d,__g.e,__g.f,__g.g,__g.h,__g.i,__g.j,__g.k,__g.l,__g.m,__g.n,__g.o,__g.p,__g.q,__g.r,__g.s,__g.t,__g.u,__g.v,__g.w,__g.x,__g.y,__g.z,__g.A,__g.B,__g.C,__g.D,__g.E,__g.F,__g.G,__g.H,__g.I,__g.J,__g.K,__g.L,__g.M,__g.N,__g.O,__g.P,__g.Q,__g.R,__g.S,__g.T,__g.U,__g.V,__g.W,__g.X,__g.Y,__g.Z,__g.aa);if(__vd_version_info__.delayedGwx||false)$gwx_XC_75();	if (__vd_version_info__.delayedGwx) __wxAppCode__['pages/index.wxml'] = [$gwx_XC_75, './pages/index.wxml'];else __wxAppCode__['pages/index.wxml'] = $gwx_XC_75( './pages/index.wxml' );
	;__wxRoute = "pages/index";__wxRouteBegin = true;__wxAppCurrentFile__="pages/index.js";define("pages/index.js",function(require,module,exports,window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){
"use strict";var e=require("../@babel/runtime/helpers/slicedToArray"),t=require("../@babel/runtime/helpers/objectSpread2"),a=require("../@babel/runtime/helpers/regeneratorRuntime"),r=require("../@babel/runtime/helpers/asyncToGenerator"),n=C(require("../libs/PublicManager")),i=P(require("../utils/analyse")),o=C(require("lodash")),s=require("../utils/tools"),u=P(require("../libs/Badge")),c=C(require("moment")),d=C(require("../config")),l=require("../services/points"),p=require("../services/game"),h=require("../utils/ad"),f=require("../models/user"),g=require("../utils/activityUtils"),m=require("../services/activity"),w=require("@mina-modules/system-info"),v=C(require("../utils/event")),x=require("../utils/redCover"),y=require("@utils/index/redirect/redirect"),S=require("@mina-modules/mina-sentry"),_=require("@utils/wechatAPI"),k=require("@/utils/serverConfig"),D=require("@/services/homepage"),b=require("@/utils/async-helper");function q(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(q=function(e){return e?a:t})(e)}function P(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=q(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var o=n?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(r,i,o):r[i]=e[i]}return r.default=e,a&&a.set(e,r),r}function C(e){return e&&e.__esModule?e:{default:e}}var L=(0,w.getSysInfo)();Page({data:{bg2Styles:"height:".concat(L.navBarHeight+378,"px;"),bg3Styles:"height:".concat(L.navBarHeight+308,"px;"),hasBg:!1,needLogin:!1,showLoginDialog:!1,buttomNavigationActiveIndex:0,inited:!1,doneGames:[],swiperCard:{},floatBar:[],floatBarShow:!1,dailyCash:[],dailyCashSubCount:0,wishLottery:{},wishInfo:{},navigationTitle:"",hasMoreSquareGames:!1,squareLoading:!1,showBadge:!1,hideAddMinaBar:!0,recommendHomePage:null,actionsheetList:[{label:"发送给朋友",openType:"share",id:"wechat",icon:"https://lucky-cdn.nocode.com/mina/lottery/icon-friends-new.png"},{label:"保存分享图",id:"image",icon:"https://lucky-cdn.nocode.com/mina/lottery/icon-pic%403x.png"}],suggestSquareLotteries:[],normalSquareLotteries:[],upcomingSubLotteries:[],showUpcomingLottery:!0,firstNavShow:!1,supprotContact:d.default.SUPPORT_CONTACT,topCardStyle:"",dailySign:null,scrolling:!1,scrollId:null,activity:null,hideRedPocket:!0,pushRedPocket:!1,redPocket:null,isSquareInitiator:!1,redpacketInfo:{show:!1,tipText:"",amount:0},exitIntercept:!1,userGroupIdx:-1,isGray:!1,showRedCover:!1,luckySquareAttached:!1,showActionSheet:!1,errorMsg:""},isSigned:!1,onShowLoginDialog:function(){this.setData({showLoginDialog:!0})},onLogin:function(){return r(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:wx.reLaunch({url:"/pages/index"});case 1:case"end":return e.stop()}}),e)})))()},onSquareAttached:function(){this.setData({luckySquareAttached:!0})},closeAddMinaBar:function(){this.setData({hideAddMinaBar:!0}),wx.setStorage({key:s.CLOSED_ABOUT_ADD_GUID,data:!0})},handleFixedExit:function(){if(this.data.redPocket){try{wx.setStorageSync("red_pocket",this.data.redPocket.id)}catch(e){console.log("local store failure")}this.setData({hideRedPocket:!0})}},chooseActionSheet:function(e){1===e.detail.index&&(getApp().globalData.downImageUrls=["https://lucky-cdn.nocode.com/mina/lottery/homepage-share-v3.jpg","https://lucky-cdn.nocode.com/mina/lottery/homepage-share-long.jpeg"],wx.navigateTo({url:"/pages/share/generateimage/generateimage?type=download_image&count=".concat(getApp().globalData.downImageUrls.length)}))},share:function(){(0,i.default)("index_share_v3"),this.setData({showActionSheet:!0})},pageScrollHandle:function(){this.data.scrolling||this.setData({scrolling:!0})},handleRedPocketHide:function(){var e=this.data.redPocket;if(e){(0,i.default)("btn_pmt_packet_show");try{wx.setStorageSync("red_pocket",e.id),wx.setStorageSync("red_pocket_float",!0)}catch(e){console.log("local store failure")}this.setData({pushRedPocket:!1,hideRedPocket:!1})}},handleRedPocketConfirm:function(e){var t=this.data.redPocket;if(t){try{wx.setStorageSync("red_pocket",t.id),"float"===e.currentTarget.id&&wx.setStorageSync("red_pocket_float",!1)}catch(e){console.log("local store failure",e)}"float"===e.currentTarget.id?(0,i.default)("btn_pmt_packet_click"):(0,i.default)("dialog_pmt_packet_click"),this.setData({pushRedPocket:!1,hideRedPocket:!0},(function(){wx.navigateTo({url:"/pages/promotion/manage/index"})}))}},updateFloatBar:function(){var e=n.default.getFloatBar();this.setData({floatBar:e})},updateDailyCashCount:function(){var e=n.default.updateDailyCashCount();this.setData({dailyCashSubCount:e})},updateDailyCash:function(){var e=n.default.getDailyCash(),t=e.count,a=e.list;this.setData({dailyCashSubCount:t,dailyCash:a})},updateSwiperCard:function(){var e=n.default.getSwiperCard();this.setData({swiperCard:e})},updateDailyWish:function(){var e=this;return r(a().mark((function t(){var r,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,l.getDaily)("public");case 3:r=t.sent,o.default.set(getApp(),"globalData.total_points",o.default.get(r,"data.total_points")),i=n.default.getWishLottery(),e.setData({wishInfo:r.data,wishLottery:i}),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),console.error(t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},updateDoneGames:function(){var e=this;return r(a().mark((function r(){var u,c;return a().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:u=(u=n.default.getPublic()).map((function(e){var a=e.draw_type,r=e.latest_draw_time,n={days:0,hours:0,minutes:0};return"time"!==a&&"ontime"!==a||(n=(0,s.getDurationDate)(r)),t(t({},e),{},{remainDate:n})})),0===e.data.doneGames.length&&u.length>0&&(c=o.default.map(u,(function(e){return e.id}))).length&&(0,i.screenView)("index",{ad_options:{adtype:"reco_index_list",adid:c.join("&")}}),u=o.default.sortBy(u,["joined",function(e){return 0===e.position?void 0:e.position},"public_tag","latest_draw_time"]),e.setData({doneGames:u});case 5:case"end":return a.stop()}}),r)})))()},onPullDownRefresh:function(){var e=this;return r(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.default.refresh();case 3:if(t.sent){t.next=6;break}return t.abrupt("return");case 6:e.squareGames=[],e.updateData();case 8:return t.prev=8,wx.stopPullDownRefresh(),t.finish(8);case 11:case"end":return t.stop()}}),t,null,[[0,,8,11]])})))()},updateSuggestSquareLotteries:function(){var e=this.squareGames.filter((function(e){return e.weight&&e.weight>0}));0===this.data.suggestSquareLotteries.length&&e.length>0&&o.default.map(e,(function(e){(0,i.screenView)("index",{ad_options:{adtype:"reco_index_square_top",adid:e.id}})})),this.setData({suggestSquareLotteries:e})},updateNormalSquareLotteries:function(){var e=this.squareGames.filter((function(e){return!e.weight||e.weight<=0}));if(0===this.data.normalSquareLotteries.length&&e.length>0){var t=o.default.map(e,(function(e){return e.id}));t.length&&(0,i.screenView)("index",{ad_options:{adtype:"reco_index_list",adid:t.join("&")}})}this.setData({normalSquareLotteries:e})},updateUpcomingSubLottries:function(){var e=this;return r(a().mark((function t(){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=n.default.getUpcomingSubLottories(),e.setData({showUpcomingLottery:(null==r?void 0:r.length)>0,upcomingSubLotteries:r});case 2:case"end":return t.stop()}}),t)})))()},loadSquareList:function(){this.squareGames=n.default.getSquare(),this.updateSuggestSquareLotteries(),this.updateNormalSquareLotteries(),this.setData({hasMoreSquareGames:!n.default.isLoadEnd})},initPage:function(){var e=this;return r(a().mark((function t(){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e._redirectChecked){t.next=15;break}return e._redirectChecked=!0,t.prev=2,t.next=5,(0,y.getRedirectPath)(e.options);case 5:if(!(r=t.sent)){t.next=10;break}return t.next=9,(0,_.navigateTo)(r);case 9:return t.abrupt("return",t.sent);case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),(0,S.error)(t.t0);case 15:if(e._dataLoaded){t.next=19;break}return t.next=18,e.loadData();case 18:e._dataLoaded=!0;case 19:e.updatePage();case 20:case"end":return t.stop()}}),t,null,[[2,12]])})))()},reloadPage:function(){this.setData({inited:!1}),this.initPage()},loadData:function(){var e=this;return r(a().mark((function r(){var n,i;return a().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:n={showBadge:!1};try{n.showBadge=u.needShow("points-navbar","profile"),(i=o.default.get(getApp(),"globalData.userProfile.info.new_complaint_message",""))&&(n.showBadge=u.needShow(i,"profile"))}catch(e){(0,S.error)("index loadDate error",e)}e.setData(t({},n));case 3:case"end":return a.stop()}}),r)})))()},updateData:function(){this.updateDoneGames(),this.updateSwiperCard(),this.updateFloatBar(),this.updateDailyCash(),this.loadSquareList(),this.updateUpcomingSubLottries(),this.updateDailyWish(),this.updateRedpacketInfo(),this.updateRecommendHomePage()},updatePage:function(){var e=this;return r(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isInitingPage){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,e.isInitingPage=!0,0!==e.data.doneGames.length){t.next=8;break}return t.next=8,n.default.refresh(!0);case 8:return e.updateData(),e.loadRedPocket(),t.t0=e,t.next=13,(0,s.isHiddenAddGuid)();case 13:t.t1=t.sent,t.t2={inited:!0,errorMsg:"",hideAddMinaBar:t.t1},t.t0.setData.call(t.t0,t.t2),t.next=21;break;case 18:t.prev=18,t.t3=t.catch(2),e.setData({inited:!0,errorMsg:t.t3.message||t.t3.errMsg});case 21:return t.prev=21,e.isInitingPage=!1,t.finish(21);case 24:case"end":return t.stop()}}),t,null,[[2,18,21,24]])})))()},onBlindBoxClick:function(){return r(a().mark((function e(){var t,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,p.getRandomGame)();case 3:r=e.sent,t=r.data,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(0),wx.showToast({title:e.t0.message,icon:"none"}),e.abrupt("return");case 11:wx.navigateTo({url:"/pages/lucky/lottery/detail?id=".concat(t)});case 12:case"end":return e.stop()}}),e,null,[[0,7]])})))()},onShareAppMessage:function(){return{title:"你好，来抽个奖？",path:"/pages/index",imageUrl:"https://lucky-cdn.nocode.com/mina/lottery/share-to-friend_2.jpeg",success:function(e){console.log("share success",e)},fail:function(){console.log("share error")}}},onPageScroll:function(e){this.pageScrollHandle(),this.controlFloatBar(e.scrollTop>900),this.controlLayout(e.scrollTop>520);try{this.pageScrollThrottle()}catch(e){return}},pageScrollThrottle:o.default.throttle((function(){(0,i.default)("index_slide"),(0,i.wxReportEvent)("index_slide",{userid:o.default.get(getApp(),"globalData.userInfo.user_id",0)})}),2e3,{trailing:!1}),controlLayout:function(e){e!==this.data.hasBg&&this.setData({hasBg:e,navigationTitle:e?"抽奖助手":""})},controlFloatBar:function(e){var t=this;if(this.data.floatBarShow)this.scrollCount++>60&&this.setData({floatBarShow:!1});else{if(clearTimeout(this.timerOfFloatBar),!e)return;this.timerOfFloatBar=setTimeout((function(){t.setData({floatBarShow:e}),t.scrollCount=0}),2e3)}},loadRedPocket:function(){var e=o.default.get(getApp(),"globalData.userProfile",{}).smart_promotion_cash_coupon_ticket,t=!1,a=!0,r=wx.getStorageSync("red_pocket"),n=wx.getStorageSync("red_pocket_float");if(e){var s=(0,c.default)(e.expired_at).diff((0,c.default)(),"hours")<12;r&&r===e.id?(t=!1,a=s||!0!==n):r!==e.id&&(a=!0,t=!s,(0,i.default)("dialog_pmt_packet_show"))}this.setData({pushRedPocket:t,hideRedPocket:a,redPocket:e||null})},onUnload:function(){v.default.off("app:theme_set_gray",this._onSetGray),clearTimeout(this.timerOfFloatBar),this.setData({inited:!1,doneGames:[],swiperCard:{},floatBar:[],dailyCash:[],dailyCashSubCount:0,isEmpty:!1}),this.filter="",this.pendingGames=[],this.sponsorGames=[],this.squareGames=[],wx.offAppHide(),clearInterval(this.showTimeTimer),(0,i.default)("index_exit")},onShow:function(){var e=this;return r(a().mark((function t(){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.showTime=0,wx.onAppHide((function(){clearInterval(e.showTimeTimer),(0,i.default)("index_quit_time",{label:e.showTime})})),(0,i.pageLoadOptions)(e.options),t.next=5,getApp().getUserInfo();case 5:return r=t.sent,e.setData({needLogin:-6===r.state}),wx.hideTabBar({animation:!1}),(0,i.screenView)("index"),t.next=11,e.initPage();case 11:e.loadChannelAdInfo(),e.showTime++,e.showTimeTimer=setInterval((function(){if(e.showTime++,e.showTime>10)return wx.offAppHide(),void clearInterval(e.showTimeTimer)}),1e3);case 14:case"end":return t.stop()}}),t)})))()},onHide:function(){wx.offAppHide(),clearInterval(this.showTimeTimer)},loadChannelAdInfo:function(){return r(a().mark((function e(){var t,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=(0,h.getChannelAds)()).length){e.next=3;break}return e.abrupt("return");case 3:if(r=(0,h.getDisplayChannelAd)(t,f.AdPosition.INDEX_HEADER)){e.next=6;break}return e.abrupt("return");case 6:(0,i.screenView)("index",{ad_options:{adtype:"ad_index_topnavi_botton",adid:r.id}});case 7:case"end":return e.stop()}}),e)})))()},onLoad:function(){var e=this;return r(a().mark((function t(){var r,n,i,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.squareGames=[],e.filter="",e._onSetGray=function(t){e.setData({isGray:t})},v.default.on("app:theme_set_gray",e._onSetGray),n=wx.getEnterOptionsSync(),i=null===(r=n.referrerInfo)||void 0===r?void 0:r.appId,1058===n.scene&&i&&(0,k.handleRedirectFromOfficialAccount)(i),t.next=10,getApp().firstShow("indexPointNav");case 10:return o=t.sent,t.t0=e,t.t1=o,t.next=15,(0,x.checkIfRedCoverEnable)();case 15:t.t2=t.sent,t.t3={firstNavShow:t.t1,showRedCover:t.t2},t.t0.setData.call(t.t0,t.t3),(0,b.callUnitAppInit)((function(){getApp().forceUpgradeOnPage()})),t.next=25;break;case 21:t.prev=21,t.t4=t.catch(0),t.t4.message=t.t4.message||"服务异常，请稍候再试",wx.showToast({title:t.t4.message,icon:"none"});case 25:case"end":return t.stop()}}),t,null,[[0,21]])})))()},onReachBottom:function(){this._loadMore()},_loadMore:function(){var e=this;return r(a().mark((function t(){var r,i,s,u;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.data.hasMoreSquareGames||n.default.isLoading){t.next=16;break}return e.setData({squareLoading:!0}),t.prev=3,t.next=6,n.default.load();case 6:e.squareGames=n.default.getSquare(),e.updateSuggestSquareLotteries(),e.updateNormalSquareLotteries(),r=!n.default.isLoadEnd,i=!1,!1===r&&(s=o.default.get(getApp(),"globalData.userInfo.user_id"),u=e.squareGames.find((function(e){return e.initiator&&e.initiator.id===s})),i=!!u),e.setData({isSquareInitiator:i,hasMoreSquareGames:r});case 13:return t.prev=13,e.setData({squareLoading:!1}),t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[3,,13,16]])})))()},updateRecommendHomePage:function(){var t=this;return r(a().mark((function r(){var n,i,o,s;return a().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,b.withErrorCatch)((0,D.fetchRecommendHomePage)());case 2:n=a.sent,i=e(n,2),o=i[0],s=i[1],t.setData({recommendHomePage:o?null:s.data});case 7:case"end":return a.stop()}}),r)})))()},updateRedpacketInfo:function(){var e=this;return r(a().mark((function t(){var r,n,i,s,u,c;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(getApp().globalData.appConfigLoaded){t.next=3;break}return t.next=3,getApp().fetchConfig();case 3:if(!(r=(0,g.getActivityId)(g.LONG_TERM_ACTIVITY))){t.next=21;break}return t.prev=5,n=!0,i="",t.next=10,(0,m.getMoneyActivityDetail)(r,"public");case 10:s=t.sent,u=o.default.get(s,"data.round"),c=(u||{current_amount:0}).current_amount,s.data||(n=!1),c>=2e3?i="已累积 20 元，快提现啊":c>0?i="已攒 ".concat((c/100).toFixed(2)," 元，累积 20 元可提现"):0===c&&(wx.setStorageSync("lt_activity",s.data),i="做任务，提现金"),e.setData({redpacketInfo:{show:n,tipText:i,amount:u?c:0}}),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(5),console.log("load redpacket data: ",t.t0);case 21:case"end":return t.stop()}}),t,null,[[5,18]])})))()}});
},{isPage:true,isComponent:true,currentFile:'pages/index.js'});require("pages/index.js");