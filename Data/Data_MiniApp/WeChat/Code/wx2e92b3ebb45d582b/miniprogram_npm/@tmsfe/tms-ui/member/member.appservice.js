$gwx_XC_37=function(_,_v,_n,_p,_s,_wp,_wl,$gwn,$gwl,$gwh,wh,$gstack,$gwrt,gra,grb,TestTest,wfor,_ca,_da,_r,_rz,_o,_oz,_1,_1z,_2,_2z,_m,_mz,nv_getDate,nv_getRegExp,nv_console,nv_parseInt,nv_parseFloat,nv_isNaN,nv_isFinite,nv_decodeURI,nv_decodeURIComponent,nv_encodeURI,nv_encodeURIComponent,$gdc,nv_JSON,_af,_gv,_ai,_grp,_gd,_gapi,$ixc,_ic,_w,_ev,_tsd){return function(path,global){
if(typeof global==='undefined'){if (typeof __GWX_GLOBAL__==='undefined')global={};else global=__GWX_GLOBAL__;}if(typeof __WXML_GLOBAL__ === 'undefined') {__WXML_GLOBAL__={};
}__WXML_GLOBAL__.modules = __WXML_GLOBAL__.modules || {};
var e_={}
if(typeof(global.entrys)==='undefined')global.entrys={};e_=global.entrys;
var d_={}
if(typeof(global.defines)==='undefined')global.defines={};d_=global.defines;
var f_={}
if(typeof(global.modules)==='undefined')global.modules={};f_=global.modules || {};
var p_={}
__WXML_GLOBAL__.ops_cached = __WXML_GLOBAL__.ops_cached || {}
__WXML_GLOBAL__.ops_set = __WXML_GLOBAL__.ops_set || {};
__WXML_GLOBAL__.ops_init = __WXML_GLOBAL__.ops_init || {};
var z=__WXML_GLOBAL__.ops_set.$gwx_XC_37 || [];
function gz$gwx_XC_37_1(){
if( __WXML_GLOBAL__.ops_cached.$gwx_XC_37_1)return __WXML_GLOBAL__.ops_cached.$gwx_XC_37_1
__WXML_GLOBAL__.ops_cached.$gwx_XC_37_1=[];
(function(z){var a=11;function Z(ops){z.push(ops)}
Z([[7],[3,'showMemberRedpacket']])
Z([3,'onGotoMemberRedpacket'])
Z([3,'memberRedpacket'])
Z([[2,'&&'],[[2,'&&'],[[2,'&&'],[[2,'!='],[[7],[3,'memberType']],[1,1]],[[7],[3,'meetCondition']]],[[7],[3,'canShowEntry']]],[[7],[3,'isOpen']]])
Z([a,[3,'card '],[[2,'?:'],[[2,'!'],[[7],[3,'checkboxChecked']]],[1,'small'],[1,'']]])
Z([3,'onCheckboxTap'])
Z([3,'cont'])
Z([3,'price-info'])
Z([[6],[[7],[3,'priceData']],[3,'oriPrice']])
Z([[7],[3,'showSurprise']])
Z([3,'buy-price wheel'])
Z([3,'#333'])
Z([3,'38'])
Z([[6],[[7],[3,'priceData']],[3,'price']])
Z([[6],[[7],[3,'priceData']],[3,'label']])
Z([[7],[3,'checkboxChecked']])
Z([3,'mask'])
Z([1,false])
Z([[7],[3,'showPopup']])
Z(z[9])
})(__WXML_GLOBAL__.ops_cached.$gwx_XC_37_1);return __WXML_GLOBAL__.ops_cached.$gwx_XC_37_1
}
__WXML_GLOBAL__.ops_set.$gwx_XC_37=z;
__WXML_GLOBAL__.ops_init.$gwx_XC_37=true;
var x=['./miniprogram_npm/@tmsfe/tms-ui/member/member.wxml'];d_[x[0]]={}
var m0=function(e,s,r,gg){
var z=gz$gwx_XC_37_1()
var hSJ=_v()
_(r,hSJ)
if(_oz(z,0,e,s,gg)){hSJ.wxVkey=1
var oVJ=_n('view')
_rz(z,oVJ,'bindtap',1,e,s,gg)
var lWJ=_n('slot')
_rz(z,lWJ,'name',2,e,s,gg)
_(oVJ,lWJ)
_(hSJ,oVJ)
}
var oTJ=_v()
_(r,oTJ)
if(_oz(z,3,e,s,gg)){oTJ.wxVkey=1
var aXJ=_n('view')
_rz(z,aXJ,'class',4,e,s,gg)
var eZJ=_mz(z,'view',['bindtap',5,'class',1],[],e,s,gg)
var b1J=_n('view')
_rz(z,b1J,'class',7,e,s,gg)
var o2J=_v()
_(b1J,o2J)
if(_oz(z,8,e,s,gg)){o2J.wxVkey=1
}
var x3J=_v()
_(b1J,x3J)
if(_oz(z,9,e,s,gg)){x3J.wxVkey=1
}
else{x3J.wxVkey=2
var f5J=_mz(z,'number',['class',10,'color',1,'fontSize',2,'num',3],[],e,s,gg)
_(x3J,f5J)
var o4J=_v()
_(x3J,o4J)
if(_oz(z,14,e,s,gg)){o4J.wxVkey=1
}
o4J.wxXCkey=1
}
o2J.wxXCkey=1
x3J.wxXCkey=1
x3J.wxXCkey=3
_(eZJ,b1J)
_(aXJ,eZJ)
var tYJ=_v()
_(aXJ,tYJ)
if(_oz(z,15,e,s,gg)){tYJ.wxVkey=1
}
tYJ.wxXCkey=1
_(oTJ,aXJ)
}
var c6J=_mz(z,'mask',['class',16,'hideOnTap',1,'show',2],[],e,s,gg)
_(r,c6J)
var cUJ=_v()
_(r,cUJ)
if(_oz(z,19,e,s,gg)){cUJ.wxVkey=1
}
hSJ.wxXCkey=1
oTJ.wxXCkey=1
oTJ.wxXCkey=3
cUJ.wxXCkey=1
return r
}
e_[x[0]]={f:m0,j:[],i:[],ti:[],ic:[]}
if(path&&e_[path]){
return function(env,dd,global){$gwxc=0;var root={"tag":"wx-page"};root.children=[]
;g="$gwx_XC_37";var main=e_[path].f
if (typeof global==="undefined")global={};global.f=$gdc(f_[path],"",1);
try{
main(env,{},root,global);
_tsd(root)
}catch(err){
console.log(err)
}
;g="";
return root;
}
}
}
}(__g.a,__g.b,__g.c,__g.d,__g.e,__g.f,__g.g,__g.h,__g.i,__g.j,__g.k,__g.l,__g.m,__g.n,__g.o,__g.p,__g.q,__g.r,__g.s,__g.t,__g.u,__g.v,__g.w,__g.x,__g.y,__g.z,__g.A,__g.B,__g.C,__g.D,__g.E,__g.F,__g.G,__g.H,__g.I,__g.J,__g.K,__g.L,__g.M,__g.N,__g.O,__g.P,__g.Q,__g.R,__g.S,__g.T,__g.U,__g.V,__g.W,__g.X,__g.Y,__g.Z,__g.aa);if(__vd_version_info__.delayedGwx||false)$gwx_XC_37();	if (__vd_version_info__.delayedGwx) __wxAppCode__['miniprogram_npm/@tmsfe/tms-ui/member/member.wxml'] = [$gwx_XC_37, './miniprogram_npm/@tmsfe/tms-ui/member/member.wxml'];else __wxAppCode__['miniprogram_npm/@tmsfe/tms-ui/member/member.wxml'] = $gwx_XC_37( './miniprogram_npm/@tmsfe/tms-ui/member/member.wxml' );
	;__wxRoute = "miniprogram_npm/@tmsfe/tms-ui/member/member";__wxRouteBegin = true;__wxAppCurrentFile__="miniprogram_npm/@tmsfe/tms-ui/member/member.js";define("miniprogram_npm/@tmsfe/tms-ui/member/member.js",function(require,module,exports,window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){
"use strict";var e=require("../../../../@babel/runtime/helpers/toConsumableArray"),t=require("../../../../@babel/runtime/helpers/slicedToArray"),r=s(require("../../../../@babel/runtime/regenerator")),n=require("../../../../@babel/runtime/helpers/objectSpread2"),a=require("../../../../@babel/runtime/helpers/objectWithoutProperties"),o=require("../../../../@babel/runtime/helpers/asyncToGenerator"),i=s(require("../platformUtils")),u=s(require("@tmsfe/tms-core")),c=["priceData","countText","showSurprise","memberType"];function s(e){return e&&e.__esModule?e:{default:e}}var p=u.default.getReporter,d=u.default.dateToString,m=u.default.roundStr,h=p().report,l={0:"RFsTBeHB01",1:"RFZ6zO5s02",2:"RFTYS2ko03",3:"RFQ69M4T04"};Component({options:{multipleSlots:!0},properties:{meetCondition:{type:Boolean,observer:function(){this.render()}},from:{type:String,value:"commonEntry"},pageName:{type:String,value:"refuelStation"},countText:{type:String,value:"4张10元红包"},showPopup:{type:Boolean,value:!1},fetchMemberInfo:{type:Boolean,value:!0},checkboxChecked:{type:Boolean,value:!1},showMemberRedpacket:{type:Boolean,value:!0},refuelOrderCount:{type:Number,value:-1}},created:function(){this.render()},data:{seconds:3,memberType:1,canShowEntry:i.default.isSinan()},pageLifetimes:{show:function(){this.render()}},code:"",today:"",buyParam:{},methods:{render:function(){var e=this;return o(r.default.mark((function t(){var o,i,u,s,p,m,h,l,f,g,v,b,y;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.today=d(),o=e.data,i=o.meetCondition,u=o.fetchMemberInfo,i&&u){t.next=4;break}return t.abrupt("return");case 4:return t.prev=4,t.next=7,e.checkIsNewUserInMember();case 7:return s=t.sent,p=e.getActivityCode(s,e.data.refuelOrderCount),e.code=p,t.next=12,e.fetchMemberInfo({code:p});case 12:m=t.sent,h=m.priceData,l=m.countText,f=m.showSurprise,g=m.memberType,v=void 0===g?1:g,b=a(m,c),y=1!==v,e.buyParam=b,e.setData({memberType:v,countText:l,isOpen:y,priceData:h,showSurprise:f}),e.triggerEvent("updated",n(n({},b),{},{show:y})),e.startCountDown(f),t.next=26;break;case 21:t.prev=21,t.t0=t.catch(4),!1,e.setData({isOpen:!1,memberType:1}),e.triggerEvent("updated",{show:!1});case 26:case"end":return t.stop()}}),t,null,[[4,21]])})))()},fetchMemberInfo:function(){var e=arguments,t=this;return o(r.default.mark((function n(){var a,o,i,c,s,p;return r.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=e.length>0&&void 0!==e[0]?e[0]:{},r.prev=1,r.next=4,u.default.createRequest().get("marketing/member/user/info",a);case 4:if(o=r.sent,c=(i=o||{}).errCode,s=i.resData,p=void 0===s?{}:s,0!==c){r.next=8;break}return r.abrupt("return",t.formatMemberData(p,a));case 8:return r.abrupt("return",Promise.reject(o));case 11:return r.prev=11,r.t0=r.catch(1),r.abrupt("return",Promise.reject(r.t0));case 14:case"end":return r.stop()}}),n,null,[[1,11]])})))()},formatMemberData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.config,n=void 0===r?{}:r,a=e.memberType,o=void 0===a?1:a,i=n.id,u=n.activityInfo,c=n.benefitProductList,s=n.memberPriceList,p=(null==u?void 0:u.activityCode)||t.code,d=s[0],m=3,h=0,l=this.getCouponInfo(c,h,m),f=l.countText,g=l.stockId,v=l.selectedCoupon,b=l.transactionMinimum,y=this.formatPriceData(d,v.couponAmount),S=this.checkNeedShowSurprise(p);return{stockId:g,priceInfo:d,countText:f,priceData:y,memberType:o,showSurprise:S,activityCode:p,selectedCoupon:v,benefitConfigId:i,transactionMinimum:b}},getCouponInfo:function(){var e,r=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,i=n.find((function(e){var n=e.benefitItemList,a=t(n,1)[0];return r.parseBenefitContent(a.itemContent).bussClassify===o}));if(!i)return{};var c=i.benefitItemList,s=void 0===c?[]:c,p=s[a],d=this.parseBenefitContent(p.itemContent),m=d.stockId,h=d.transactionMinimum,l=u.default.roundStr((null===(e=s[0])||void 0===e?void 0:e.itemAmount)/100,2,!0),f="".concat(s.length,"张").concat(l,"元红包");return{stockId:m,selectedCoupon:d,transactionMinimum:h,countText:f}},parseBenefitContent:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{var t=JSON.parse(e);return t}catch(e){return{}}},checkIsNewUserInMember:function(){return o(r.default.mark((function e(){var t,n,a,o,i,c;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.default.createRequest().get("marketing/member/user/info",{});case 3:if(t=e.sent,a=(n=t||{}).errCode,o=n.resData,i=void 0===o?{}:o,0!==a){e.next=8;break}return 2,e.abrupt("return",2===(null==i||null===(c=i.detail)||void 0===c?void 0:c.everHasOrder));case 8:return e.abrupt("return",!1);case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))()},getActivityCode:function(e,t){if(!e)return"";if(isNaN(Number(t)))return"";return l[t>3?3:t]},formatPriceData:function(e,t){var r=e.discountAmount,n=e.originalAmount;return r<t?{price:m(r/100,2,!0),oriPrice:m(n/100,2,!0),label:"一单回本"}:r<1699?{price:m(r/100,2,!0),oriPrice:m(n/100,2,!0),label:"限时特惠"}:{price:m(r/100,2,!0),oriPrice:"",label:""}},onTapBtn:function(){this.triggerEvent("openBuyPage",{}),wx.navigateTo({url:"/modules/operating/monthlycard/pages/center/center?from=".concat(this.data.from)}),h({27:"AC025",37:this.data.memberType,38:this.data.from})},onGotoAggrement:function(){wx.navigateTo({url:"/modules/operating/monthlycard/pages/agreement/agreement"})},onHelpIconTap:function(){this.triggerEvent("openBuyPage",{triggerTarget:"help"}),wx.navigateTo({url:"/modules/operating/monthlycard/pages/center/center"})},onCheckboxTap:function(){var e=!this.data.checkboxChecked,t=this.checkPopupShouldShow();if(e||!t){var r=e?"confirm":"cancel";this.triggerEvent(r,n(n({},this.buyParam),{},{triggerTarget:"card"}))}else this.setData({showPopup:!0})},onCancelTap:function(){this.triggerEvent("cancel",this.buyParam),this.closePopup()},onConfirmTap:function(){this.triggerEvent("confirm",this.buyParam),this.closePopup()},closePopup:function(){this.setData({showPopup:!1}),this.setPopupShowStatus()},checkPopupShouldShow:function(){try{var e=this.data.pageName,t=wx.getStorageSync("member.pay.popup")||{};return!t[e]||!t[e].includes(this.today)}catch(e){return!0}},setPopupShowStatus:function(){try{var t=this.data.pageName,r=wx.getStorageSync("member.pay.popup")||{};r[t]||(r[t]=[]),r[t].push(this.today),r[t]=e(new Set(r[t])),wx.setStorageSync("member.pay.popup",r)}catch(e){}},onGotoMemberRedpacket:function(){var e=this,t=this.data.checkboxChecked,r=this.index,a=JSON.stringify({checked:t,index:r});wx.navigateTo({url:"/modules/operating/monthlycard/pages/benefits/index?benefit=".concat(a,"&code=").concat(this.code||""),events:{onConfirmCoupon:function(t){e.buyParam=n(n({},e.buyParam),t),e.index=t.index,e.triggerEvent("confirm",n(n({},e.buyParam),{},{triggerTarget:"benefitPage"}))},onCancelCoupon:function(){e.triggerEvent("cancel",n(n({},e.buyParam),{},{triggerTarget:"benefitPage"}))}}})},onCloseSurpriseTap:function(){this.execAnimation()},startCountDown:function(e){var t=this;e&&(clearInterval(this.timerId),this.timerId=setInterval((function(){var e=t.data.seconds;e-1>=0?t.setData({seconds:e-1}):(clearInterval(t.timerId),t.execAnimation())}),1e3))},execAnimation:function(){var e=this,t=this.createAnimation();this.setData({animationData:t},(function(){setTimeout((function(){e.setData({showSurprise:!1}),e.setShowSurpriseStatus()}),1310)}))},createAnimation:function(){var e=wx.createAnimation();return e.scale(1.1).backgroundColor("transparent").step({duration:800,timingFunction:"ease-in-out"}),e.scale(0).top(218).right(-88).step({duration:500,timingFunction:"ease-in-out"}),e.export()},checkNeedShowSurprise:function(e){if(!e)return!1;if(!this.data.seconds)return!1;try{var t=wx.getStorageSync("member.pay.surprise");return(t[this.today]||0)<3}catch(e){return!1}},setShowSurpriseStatus:function(){try{var e=wx.getStorageSync("member.pay.surprise")||{};e[this.today]||(e[this.today]=0),e[this.today]=e[this.today]+1,wx.setStorageSync("member.pay.surprise",e)}catch(e){}}}});
},{isPage:false,isComponent:true,currentFile:'miniprogram_npm/@tmsfe/tms-ui/member/member.js'});require("miniprogram_npm/@tmsfe/tms-ui/member/member.js");