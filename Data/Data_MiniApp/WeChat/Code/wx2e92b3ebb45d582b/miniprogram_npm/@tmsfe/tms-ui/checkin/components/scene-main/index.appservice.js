$gwx_XC_17=function(_,_v,_n,_p,_s,_wp,_wl,$gwn,$gwl,$gwh,wh,$gstack,$gwrt,gra,grb,TestTest,wfor,_ca,_da,_r,_rz,_o,_oz,_1,_1z,_2,_2z,_m,_mz,nv_getDate,nv_getRegExp,nv_console,nv_parseInt,nv_parseFloat,nv_isNaN,nv_isFinite,nv_decodeURI,nv_decodeURIComponent,nv_encodeURI,nv_encodeURIComponent,$gdc,nv_JSON,_af,_gv,_ai,_grp,_gd,_gapi,$ixc,_ic,_w,_ev,_tsd){return function(path,global){
if(typeof global==='undefined'){if (typeof __GWX_GLOBAL__==='undefined')global={};else global=__GWX_GLOBAL__;}if(typeof __WXML_GLOBAL__ === 'undefined') {__WXML_GLOBAL__={};
}__WXML_GLOBAL__.modules = __WXML_GLOBAL__.modules || {};
var e_={}
if(typeof(global.entrys)==='undefined')global.entrys={};e_=global.entrys;
var d_={}
if(typeof(global.defines)==='undefined')global.defines={};d_=global.defines;
var f_={}
if(typeof(global.modules)==='undefined')global.modules={};f_=global.modules || {};
var p_={}
__WXML_GLOBAL__.ops_cached = __WXML_GLOBAL__.ops_cached || {}
__WXML_GLOBAL__.ops_set = __WXML_GLOBAL__.ops_set || {};
__WXML_GLOBAL__.ops_init = __WXML_GLOBAL__.ops_init || {};
var z=__WXML_GLOBAL__.ops_set.$gwx_XC_17 || [];
function gz$gwx_XC_17_1(){
if( __WXML_GLOBAL__.ops_cached.$gwx_XC_17_1)return __WXML_GLOBAL__.ops_cached.$gwx_XC_17_1
__WXML_GLOBAL__.ops_cached.$gwx_XC_17_1=[];
(function(z){var a=11;function Z(ops){z.push(ops)}
Z([[7],[3,'readyRender']])
Z([[7],[3,'navBackVisible']])
Z([1,'#2122b9'])
Z([3,'onUpdateNavbarHeight'])
Z([1,true])
Z(z[4])
Z([3,'#fff'])
Z(z[4])
Z([[7],[3,'pageScrollTop']])
Z([3,'light'])
Z([[7],[3,'activityName']])
Z(z[1])
Z([a,[3,'bg-container '],[[2,'?:'],[[7],[3,'isIpx']],[1,'extra-bottom'],[1,'']]])
Z([[2,'&&'],[[2,'<='],[[7],[3,'status']],[1,1]],[[2,'>'],[[6],[[7],[3,'userDynamicData']],[3,'userReceivedPrizeCodeSize']],[1,0]]])
Z([3,'我的抽奖码'])
Z([[2,'!='],[[7],[3,'status']],[[2,'-'],[1,1]]])
Z([3,'border-style main-box'])
Z([[2,'||'],[[2,'==='],[[7],[3,'status']],[1,0]],[[2,'==='],[[7],[3,'status']],[1,1]]])
Z([3,'onNextClick'])
Z([[7],[3,'drawPrizeStartTime']])
Z([[7],[3,'mainPrizeList']])
Z([[6],[[7],[3,'promotionCfg']],[3,'promotionCode']])
Z([[7],[3,'promotionDynamicData']])
Z([[6],[[7],[3,'promotionCfg']],[3,'promotionName']])
Z([[6],[[7],[3,'promotionCfg']],[3,'roomId']])
Z([[7],[3,'selectedIndex']])
Z([[7],[3,'status']])
Z([[7],[3,'userDynamicData']])
Z([[7],[3,'isLuckyForMe']])
Z([[7],[3,'mainPrizeWinnerList']])
Z([[6],[[7],[3,'promotionCfg']],[3,'notaryOffice']])
Z(z[24])
Z(z[26])
Z([[6],[[7],[3,'countdown']],[3,'display']])
Z([3,'距离本次开奖还有'])
Z([[2,'&&'],[[2,'!=='],[[7],[3,'status']],[1,3]],[[6],[[7],[3,'partPrizeList']],[3,'length']]])
Z([3,'26'])
Z([3,'参与活动的用户，直播当天更有机会抽取以下奖励'])
Z([[2,'&&'],[[2,'>='],[[7],[3,'status']],[1,2]],[[2,'>'],[[6],[[7],[3,'partPrizeWinnerList']],[3,'length']],[1,0]]])
Z([3,'中奖名单'])
Z([[2,'&&'],[[2,'&&'],[[2,'=='],[[7],[3,'status']],[1,0]],[[7],[3,'taskData']]],[[2,'>'],[[6],[[7],[3,'taskData']],[3,'length']],[1,0]]])
Z([3,'如何获得更多抽奖码'])
Z([3,'服务推荐'])
Z([[6],[[7],[3,'appletPromotion']],[3,'promotionSubInfos']])
Z([3,'index'])
Z([[2,'>'],[[7],[3,'index']],[1,0]])
Z([[2,'==='],[[7],[3,'promotionType']],[1,1]])
Z([3,'好车推荐'])
Z([3,'出行必备'])
Z([[2,'>'],[[6],[[7],[3,'userDynamicData']],[3,'userSelectedPrizeId']],[1,0]])
Z([a,[3,'suggest-share '],[[2,'?:'],[[2,'&&'],[[7],[3,'isIpx']],[[2,'==='],[[7],[3,'status']],[1,0]]],[1,'extra-bottom'],[1,'']]])
Z([3,'suggest-share-animate'])
Z([[2,'&&'],[[2,'==='],[[7],[3,'status']],[1,0]],[[2,'!'],[[6],[[7],[3,'userDynamicData']],[3,'isShared']]]])
Z([3,'onShare'])
Z([3,'share'])
Z([3,'分享获得额外抽奖码'])
Z([3,'680'])
Z(z[53])
Z(z[54])
Z([3,'有好事儿一定要分享'])
Z([[7],[3,'popup']])
Z([3,'onPopupClose'])
Z([[7],[3,'navbarHeight']])
Z([[6],[[7],[3,'promotionCfg']],[3,'oaUrl']])
Z([[7],[3,'popupData']])
Z(z[21])
Z([[7],[3,'showLoading']])
Z([3,'toast'])
Z([[7],[3,'loadingText']])
Z([[7],[3,'rules']])
Z([[7],[3,'toggleRule']])
Z([3,'onDrawerClose'])
Z([[7],[3,'drawer']])
Z([3,'ticket'])
Z(z[73])
Z([[7],[3,'phoneAuthorized']])
Z([3,'onGetTicket'])
Z([3,'立即领取'])
Z([3,'onAgreeClick'])
Z([3,'ticket__hint'])
Z([[2,'&&'],[[2,'==='],[[7],[3,'promotionType']],[1,1]],[[2,'>'],[[6],[[7],[3,'mainPrizeList']],[3,'length']],[1,1]]])
Z([[2,'!'],[[7],[3,'hasBind']]])
Z([3,'1'])
Z([3,'onPhoneAuthorized'])
Z([3,'getPhoneNumber'])
Z([[2,'?:'],[[7],[3,'agreeContact']],[1,'授权手机号码领取'],[1,'换奖品']])
Z(z[82])
Z([3,'onPhoneAuthClick'])
Z(z[85])
})(__WXML_GLOBAL__.ops_cached.$gwx_XC_17_1);return __WXML_GLOBAL__.ops_cached.$gwx_XC_17_1
}
__WXML_GLOBAL__.ops_set.$gwx_XC_17=z;
__WXML_GLOBAL__.ops_init.$gwx_XC_17=true;
var x=['./miniprogram_npm/@tmsfe/tms-ui/checkin/components/scene-main/index.wxml'];d_[x[0]]={}
var m0=function(e,s,r,gg){
var z=gz$gwx_XC_17_1()
var oFF=_v()
_(r,oFF)
if(_oz(z,0,e,s,gg)){oFF.wxVkey=1
var hIF=_mz(z,'navbar',['backBtnVisible',1,'backgroundColor',1,'bind:navBarAttached',2,'customBackBtn',3,'enableHomeNav',4,'frontColor',5,'gradient',6,'pageScrollTop',7,'styleName',8,'title',9],[],e,s,gg)
var oJF=_v()
_(hIF,oJF)
if(_oz(z,11,e,s,gg)){oJF.wxVkey=1
}
oJF.wxXCkey=1
_(oFF,hIF)
var cKF=_n('view')
_rz(z,cKF,'class',12,e,s,gg)
var oLF=_v()
_(cKF,oLF)
if(_oz(z,13,e,s,gg)){oLF.wxVkey=1
var oTF=_n('common-title')
_rz(z,oTF,'title',14,e,s,gg)
_(oLF,oTF)
}
var lMF=_v()
_(cKF,lMF)
if(_oz(z,15,e,s,gg)){lMF.wxVkey=1
var fUF=_n('view')
_rz(z,fUF,'class',16,e,s,gg)
var cVF=_v()
_(fUF,cVF)
if(_oz(z,17,e,s,gg)){cVF.wxVkey=1
var hWF=_mz(z,'selectcar',['bind:next',18,'endTime',1,'mainPrizeList',2,'promotionCode',3,'promotionDynamicData',4,'promotionName',5,'roomId',6,'selectedIndex',7,'status',8,'userDynamicData',9],[],e,s,gg)
_(cVF,hWF)
}
else{cVF.wxVkey=2
var oXF=_mz(z,'living',['isMe',28,'mainPrizeWinnerList',1,'notaryOffice',2,'roomId',3,'status',4],[],e,s,gg)
_(cVF,oXF)
}
cVF.wxXCkey=1
cVF.wxXCkey=3
cVF.wxXCkey=3
_(lMF,fUF)
}
var aNF=_v()
_(cKF,aNF)
if(_oz(z,33,e,s,gg)){aNF.wxVkey=1
var cYF=_n('common-title')
_rz(z,cYF,'title',34,e,s,gg)
_(aNF,cYF)
}
var tOF=_v()
_(cKF,tOF)
if(_oz(z,35,e,s,gg)){tOF.wxVkey=1
var oZF=_mz(z,'common-title',['fontSize',36,'title',1],[],e,s,gg)
_(tOF,oZF)
}
var ePF=_v()
_(cKF,ePF)
if(_oz(z,38,e,s,gg)){ePF.wxVkey=1
var l1F=_n('common-title')
_rz(z,l1F,'title',39,e,s,gg)
_(ePF,l1F)
}
var bQF=_v()
_(cKF,bQF)
if(_oz(z,40,e,s,gg)){bQF.wxVkey=1
var a2F=_n('common-title')
_rz(z,a2F,'title',41,e,s,gg)
_(bQF,a2F)
}
var t3F=_n('common-title')
_rz(z,t3F,'title',42,e,s,gg)
_(cKF,t3F)
var e4F=_v()
_(cKF,e4F)
var b5F=function(x7F,o6F,o8F,gg){
var c0F=_v()
_(o8F,c0F)
if(_oz(z,45,x7F,o6F,gg)){c0F.wxVkey=1
}
c0F.wxXCkey=1
return o8F
}
e4F.wxXCkey=2
_2z(z,43,b5F,e,s,gg,e4F,'item','index','index')
var oRF=_v()
_(cKF,oRF)
if(_oz(z,46,e,s,gg)){oRF.wxVkey=1
var hAG=_n('common-title')
_rz(z,hAG,'title',47,e,s,gg)
_(oRF,hAG)
}
var oBG=_n('common-title')
_rz(z,oBG,'title',48,e,s,gg)
_(cKF,oBG)
var cCG=_n('guide')
_(cKF,cCG)
var xSF=_v()
_(cKF,xSF)
if(_oz(z,49,e,s,gg)){xSF.wxVkey=1
var oDG=_mz(z,'view',['class',50,'id',1],[],e,s,gg)
var lEG=_v()
_(oDG,lEG)
if(_oz(z,52,e,s,gg)){lEG.wxVkey=1
var aFG=_mz(z,'c-btn',['bind:click',53,'openType',1,'title',2,'width',3],[],e,s,gg)
_(lEG,aFG)
}
else{lEG.wxVkey=2
var tGG=_mz(z,'c-btn',['bind:click',57,'openType',1,'title',2],[],e,s,gg)
_(lEG,tGG)
}
lEG.wxXCkey=1
lEG.wxXCkey=3
lEG.wxXCkey=3
_(xSF,oDG)
}
oLF.wxXCkey=1
oLF.wxXCkey=3
lMF.wxXCkey=1
lMF.wxXCkey=3
aNF.wxXCkey=1
aNF.wxXCkey=3
tOF.wxXCkey=1
tOF.wxXCkey=3
ePF.wxXCkey=1
ePF.wxXCkey=3
bQF.wxXCkey=1
bQF.wxXCkey=3
oRF.wxXCkey=1
oRF.wxXCkey=3
xSF.wxXCkey=1
xSF.wxXCkey=3
_(oFF,cKF)
var fGF=_v()
_(oFF,fGF)
if(_oz(z,60,e,s,gg)){fGF.wxVkey=1
var eHG=_mz(z,'popup',['bind:close',61,'navbarHeight',1,'oaUrl',2,'popupData',3,'promotionCode',4],[],e,s,gg)
_(fGF,eHG)
}
var cHF=_v()
_(oFF,cHF)
if(_oz(z,66,e,s,gg)){cHF.wxVkey=1
var bIG=_mz(z,'loading',['mode',67,'text',1],[],e,s,gg)
_(cHF,bIG)
}
var oJG=_mz(z,'comp-rules',['rules',69,'toggle',1],[],e,s,gg)
_(oFF,oJG)
var xKG=_mz(z,'drawer',['bind:close',71,'drawer',1],[],e,s,gg)
var oLG=_mz(z,'view',['class',73,'slot',1],[],e,s,gg)
var fMG=_v()
_(oLG,fMG)
if(_oz(z,75,e,s,gg)){fMG.wxVkey=1
var cNG=_mz(z,'c-btn',['bind:click',76,'title',1],[],e,s,gg)
_(fMG,cNG)
}
else{fMG.wxVkey=2
var oPG=_mz(z,'view',['catch:tap',78,'class',1],[],e,s,gg)
var cQG=_v()
_(oPG,cQG)
if(_oz(z,80,e,s,gg)){cQG.wxVkey=1
}
cQG.wxXCkey=1
_(fMG,oPG)
var hOG=_v()
_(fMG,hOG)
if(_oz(z,81,e,s,gg)){hOG.wxVkey=1
var oRG=_mz(z,'c-btn',['arrow',82,'bind:phone',1,'openType',2,'title',3],[],e,s,gg)
_(hOG,oRG)
}
else{hOG.wxVkey=2
var lSG=_mz(z,'c-btn',['arrow',86,'bind:click',1,'title',2],[],e,s,gg)
_(hOG,lSG)
}
hOG.wxXCkey=1
hOG.wxXCkey=3
hOG.wxXCkey=3
}
fMG.wxXCkey=1
fMG.wxXCkey=3
fMG.wxXCkey=3
_(xKG,oLG)
_(oFF,xKG)
fGF.wxXCkey=1
fGF.wxXCkey=3
cHF.wxXCkey=1
cHF.wxXCkey=3
}
else{oFF.wxVkey=2
}
oFF.wxXCkey=1
oFF.wxXCkey=3
return r
}
e_[x[0]]={f:m0,j:[],i:[],ti:[],ic:[]}
if(path&&e_[path]){
return function(env,dd,global){$gwxc=0;var root={"tag":"wx-page"};root.children=[]
;g="$gwx_XC_17";var main=e_[path].f
if (typeof global==="undefined")global={};global.f=$gdc(f_[path],"",1);
try{
main(env,{},root,global);
_tsd(root)
}catch(err){
console.log(err)
}
;g="";
return root;
}
}
}
}(__g.a,__g.b,__g.c,__g.d,__g.e,__g.f,__g.g,__g.h,__g.i,__g.j,__g.k,__g.l,__g.m,__g.n,__g.o,__g.p,__g.q,__g.r,__g.s,__g.t,__g.u,__g.v,__g.w,__g.x,__g.y,__g.z,__g.A,__g.B,__g.C,__g.D,__g.E,__g.F,__g.G,__g.H,__g.I,__g.J,__g.K,__g.L,__g.M,__g.N,__g.O,__g.P,__g.Q,__g.R,__g.S,__g.T,__g.U,__g.V,__g.W,__g.X,__g.Y,__g.Z,__g.aa);if(__vd_version_info__.delayedGwx||false)$gwx_XC_17();	if (__vd_version_info__.delayedGwx) __wxAppCode__['miniprogram_npm/@tmsfe/tms-ui/checkin/components/scene-main/index.wxml'] = [$gwx_XC_17, './miniprogram_npm/@tmsfe/tms-ui/checkin/components/scene-main/index.wxml'];else __wxAppCode__['miniprogram_npm/@tmsfe/tms-ui/checkin/components/scene-main/index.wxml'] = $gwx_XC_17( './miniprogram_npm/@tmsfe/tms-ui/checkin/components/scene-main/index.wxml' );
	;__wxRoute = "miniprogram_npm/@tmsfe/tms-ui/checkin/components/scene-main/index";__wxRouteBegin = true;__wxAppCurrentFile__="miniprogram_npm/@tmsfe/tms-ui/checkin/components/scene-main/index.js";define("miniprogram_npm/@tmsfe/tms-ui/checkin/components/scene-main/index.js",function(require,module,exports,window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){
"use strict";var e=require("../../../../../../@babel/runtime/helpers/slicedToArray"),t=require("../../../../../../@babel/runtime/helpers/objectSpread2"),a=l(require("../../../../../../@babel/runtime/regenerator")),r=require("../../../../../../@babel/runtime/helpers/asyncToGenerator"),n=l(require("../../common/Checkin")),o=l(require("./logic/Controller")),i=l(require("./logic/Presenter")),s=l(require("../../vendor")),u=require("../../common/constant"),c=l(require("../../common/fetchRemote")),d=require("../../common/reporter");function l(e){return e&&e.__esModule?e:{default:e}}Component({properties:{options:{type:Object,value:{code:"",roomId:"",from:""}}},data:{readyRender:!1,activityName:"",status:-1,promotionCfg:{promotionCode:"",roomId:"",notaryOffice:!1,oaUrl:"",mainImage:"https://aggretrip.map.qq.com/carshop/img/img_xingtu_live_event.png",shareImage:"https://aggretrip.map.qq.com/carshop/wxliving/img/icon_share.png"},drawPrizeStartTime:0,mainPrizeList:[],partPrizeList:[],mainPrizeWinnerList:[],partPrizeWinnerList:[],userDynamicData:{userSelectedPrizeId:0,userReceivedPrizeCodeSize:0,isSignIn:!1,isShared:!1},promotionDynamicData:{joinedUserSize:0,givedPrizeCodeSize:0},appletPromotion:{},recommendPromotion:{},isLuckyForMe:!1,pageScrollTop:0,popup:!1,popupData:{},drawer:{show:!1,type:"ticket",title:"活动参与提示"},cities:[],cityIndex:[0,0],phoneAuthorized:!1,agreeContact:!0,selectedIndex:0,promotionType:0,imageCDN:n.default.imageCDN,shopImageCDN:n.default.shopImageCDN},pageLifetimes:{show:function(){var e=o.default.getPhone(),t=o.default.getEncryptedPhone();this.setData({mobile:e,encryptedPhone:t})}},detached:function(){clearTimeout(this.scrollCheckId),this.clearCountdown()},ready:function(){var e,t,a,r,n,o;this.from=(null===(e=this.data)||void 0===e||null===(t=e.options)||void 0===t?void 0:t.from)||"",this.code=(null===(a=this.data)||void 0===a||null===(r=a.options)||void 0===r?void 0:r.code)||"1xngzi",this.roomId=(null===(n=this.data)||void 0===n||null===(o=n.options)||void 0===o?void 0:o.roomId)||"",this.initScene()},methods:{initScene:function(){var e=this;return r(a.default.mark((function t(){var r;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.roomId){t.next=3;break}return setTimeout((function(){wx.redirectTo({url:"plugin-private://wx2b03c6e691cd7370/pages/live-player-plugin?room_id=".concat(e.roomId),success:function(){setTimeout((function(){e.setData({readyRender:!0})}),1e3)}})}),500),t.abrupt("return");case 3:return e.c=new o.default(null===(r=e.data)||void 0===r?void 0:r.options),t.next=6,e.initExeedInfo(e.code).catch((function(){s.default.Platform.showToast({title:"获取星途数据异常，请稍后再试",icon:"none"})}));case 6:return t.next=8,e.render().catch((function(){s.default.Platform.showToast({title:"获取抽奖数据异常，请稍后再试",icon:"none"})}));case 8:e.setData({readyRender:!0}),e.renderNavbackBtn(),o.default.report("sign_homepage_pv",u.REPORT_TYPES.pv);case 11:case"end":return t.stop()}}),t)})))()},showLoading:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"加载中...";this.setData({loadingText:e,showLoading:!0})},hideLoading:function(){this.setData({showLoading:!1})},initExeedInfo:function(e){var t=this;return r(a.default.mark((function r(){var n;return a.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,o.default.initExeedInfo(e);case 2:n=a.sent,t.setData(n);case 4:case"end":return a.stop()}}),r)})))()},render:function(){var e=arguments,t=this;return r(a.default.mark((function r(){var o,i,s,u;return a.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o=e.length>0&&void 0!==e[0]&&e[0],a.prev=1,a.next=4,t.c.render(o);case 4:i=a.sent,t.setData(i),s=i.status,u=i.endTime,(0===s||1===s)&&u>Date.now()&&(t.clearCountdown(),t.setCountdown(u)),a.next=13;break;case 10:a.prev=10,a.t0=a.catch(1),n.default.showToast(n.default.getErrorMsg(a.t0),"none");case 13:case"end":return a.stop()}}),r,null,[[1,10]])})))()},setCountdown:function(e){var t=this;this.countdownId=setInterval((function(){var a=i.default.getCountDownData(e);t.setData({countdown:a}),a.display||(t.clearCountdown(),t.render())}),1e3)},clearCountdown:function(){clearInterval(this.countdownId)},getCurrentPrizeName:function(e){return this.data.mainPrizeList.find((function(t){return t.id===e})).name},onPopupClose:function(){this.setData({popup:!1,popupData:{}})},onGoCodes:function(){var e=this.data.promotionCfg.promotionCode,t="/modules/operating/checkin/pages/codes/codes?promotionCode=".concat(e);s.default.Platform.navigateTo({url:t})},onShare:function(){var e=this;return r(a.default.mark((function r(){var i,s,u,c,l;return a.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o.default.report(d.ANALYSIS_DATA.S031.name),i=e.data,s=i.status,u=i.userDynamicData,0===s&&!u.isShared){a.next=4;break}return a.abrupt("return");case 4:return c=e.prizeId||u.userSelectedPrizeId,3,a.prev=6,a.next=9,e.c.receive(c,e.data.mobile,{},3);case 9:l=a.sent,e.setData({popup:!0,popupData:t(t({popupType:1},l),{},{currentPrizeName:e.getCurrentPrizeName(c)}),"userDynamicData.isShared":!0}),e.render(!0),a.next=17;break;case 14:a.prev=14,a.t0=a.catch(6),n.default.showToast(n.default.getErrorMsg(a.t0.errCode),"none");case 17:case"end":return a.stop()}}),r,null,[[6,14]])})))()},onUpdateNavbarHeight:function(e){var t=e.detail,a=t.statusBarHeight,r=void 0===a?88:a,n=t.navBarHeight,o=void 0===n?88:n;this.setData({navbarHeight:r+o})},shareShowStatus:!1,showShare:function(e){try{var t=this.data,a=t.status,r=t.userDynamicData.userSelectedPrizeId;if(0!==a||!r)return;e>0&&!this.shareShowStatus&&(this.shareShowStatus=!0,this.animate("#suggest-share-animate",[{height:"0"},{height:"118rpx"}],500)),e<=0&&this.shareShowStatus&&(this.shareShowStatus=!1,this.animate("#suggest-share-animate",[{height:"118rpx"},{height:"0"}],500))}catch(e){o.default.log(e)}},scrollChecking:!1,scrollCheckId:-1,scrollCheckTimeout:50,onPageScroll:function(e){var t=this,a=e.scrollTop;0===a&&(this.scrollChecking=!0,this.setData({pageScrollTop:0}),clearTimeout(this.scrollCheckId),this.scrollCheckId=setTimeout((function(){t.scrollChecking=!1}),this.scrollCheckTimeout)),this.scrollChecking||(this.scrollChecking=!0,this.scrollCheckId=setTimeout((function(){t.setData({pageScrollTop:a}),t.showShare(a),t.scrollChecking=!1}),this.scrollCheckTimeout))},onNavBack:function(){var e=this;return r(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.default.showLoading(),t.prev=1,t.next=4,e.c.navBack();case 4:n.default.hideLoading(),s.default.Platform.navigateBack(),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(1),e.setData(t.t0),n.default.hideLoading();case 12:e.c.setScanCheckinPageStatus();case 13:case"end":return t.stop()}}),t,null,[[1,8]])})))()},renderNavbackBtn:function(){var e=getCurrentPages()||[];this.setData({navBackVisible:e.length>1})},onViewRules:function(){this.setData({toggleRule:!this.data.toggleRule})},onCityColumnChange:function(e){var t=e.detail,a=t.column,r=t.value;if(0===a){var n=this.data.cities[a][r].name;this.setData({cities:o.default.getCityPickerCoulumns(n)})}},onCitySelected:function(t){var a=t.detail.value,r=e(a,2)[1];this.setData({city:o.default.getCityDisplay(this.data.cities[1][r])})},onGoTask:function(e){var t=e.currentTarget.dataset.index,a=this.data.taskData,r=(void 0===a?[]:a)[t];c.default.goTask(r)},onShareTask:function(){o.default.report(d.ANALYSIS_DATA.S029.name),this.onShare()},onGoServices:function(e){var t=e.currentTarget.dataset.index;0===t?o.default.report(d.ANALYSIS_DATA.S033.name):1===t&&o.default.report(d.ANALYSIS_DATA.S034.name);var a=this.data.appletPromotion,r=(void 0===a?{}:a).promotionSubInfos,n=(void 0===r?[]:r)[t];c.default.goService(n)},onGoRecommend:function(){var e=this.data.recommendPromotion.promotionSubInfos,t=(void 0===e?[]:e)[0];c.default.goService(t)},onDone:function(e){var a=this,r=e.detail,o=r.prizeId,i=r.mobile,s=r.userInfo;this.prizeId=o,this.mobile=i,this.showLoading("签到中...");this.setData({mobile:i}),this.c.receive(o,i,s,1).then((function(e){a.render(!0);var r=a.getCurrentPrizeName(o);a.setData({"userDynamicData.isSignIn":!0,popup:!0,popupData:t(t({popupType:0},e),{},{currentPrizeName:r})}),a.hideLoading(),a.setData({"drawer.show":!1})})).catch((function(e){a.hideLoading(),n.default.showToast(n.default.getErrorMsg(e.errCode),"none")}))},onNextClick:function(e){var n=this;return r(a.default.mark((function r(){var i,s,u,l,h,f;return a.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o.default.report(d.ANALYSIS_DATA.S023.name),i=e.detail,s=i.mobile,u=i.userInfo,l=i.prizeId,!s||n.data.hasBind){a.next=7;break}return a.next=5,o.default.bindPhone({rawPhone:s});case 5:h=a.sent,n.setData(t(t({},h),{},{phoneAuthorized:!0}));case 7:if(n.userInfo=u,n.prizeId=l,!(n.data.userDynamicData.userSelectedPrizeId<=0)){a.next=22;break}return a.next=12,c.default.getPrizeIds();case 12:f=a.sent,a.t0=Number(l),a.next=a.t0===f.half_price?16:a.t0===f.free_use?18:20;break;case 16:return n.data.halfPriceStatus?n.onDone({detail:{userInfo:u,prizeId:l,mobile:n.data.mobile}}):n.setData({"drawer.show":!0,city:o.default.getCityDefault(),cities:o.default.getCityPickerCoulumns(),authTitle:"参与活动抽奖需要提供手机号，用于联系您确认并告知中奖结果"}),a.abrupt("break",20);case 18:return s&&u&&u.nickName&&n.onDone({detail:{userInfo:u,prizeId:l,mobile:s}}),a.abrupt("break",20);case 20:a.next=23;break;case 22:n.onDone({detail:{userInfo:u,prizeId:l,mobile:n.data.mobile}});case 23:case"end":return a.stop()}}),r)})))()},onGetTicket:function(){var e=this;return r(a.default.mark((function t(){var r,n,i;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.data.mobile){t.next=3;break}return s.default.Platform.showToast({title:"请授权您的手机号",icon:"none"}),t.abrupt("return");case 3:if("请选择"!==e.data.city){t.next=6;break}return s.default.Platform.showToast({title:"请选择兑奖城市",icon:"none"}),t.abrupt("return");case 6:return t.next=8,o.default.resertention();case 8:t.sent&&(r=e.userInfo,n=e.prizeId,i=e.data.mobile,e.onDone({detail:{userInfo:r,prizeId:n,mobile:i}}));case 10:case"end":return t.stop()}}),t)})))()},onPhoneAuthorized:function(e){var t=this;return r(a.default.mark((function r(){var n,o;return a.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!t.onChangePrize()){a.next=2;break}return a.abrupt("return");case 2:return n=Number(t.prizeId),a.next=5,c.default.getPrizeIds();case 5:o=a.sent,a.t0=n,a.next=a.t0===o.half_price?9:a.t0===o.free_use?11:13;break;case 9:return t.halfPrizeAuth(e,n),a.abrupt("break",13);case 11:return t.freeDriveAuth(e,n),a.abrupt("break",13);case 13:case"end":return a.stop()}}),r)})))()},halfPrizeAuth:function(e,n){var i=this;return r(a.default.mark((function r(){var s,u,c,d;return a.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s=e.detail.detail,u=s.encryptedData,c=s.iv,a.next=3,o.default.bindPhone({encryptedPhoneData:u,phoneIV:c});case 3:d=a.sent,1===i.data.promotionType?i.setData(t(t({},d),{},{phoneAuthorized:!0})):i.setData(t({},d),(function(){i.onDone({detail:{userInfo:i.userInfo,prizeId:n,mobile:i.data.mobile}})}));case 5:case"end":return a.stop()}}),r)})))()},freeDriveAuth:function(e,n){var i=this;return r(a.default.mark((function r(){var u,c,d,l;return a.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return u=e.detail.detail,c=u.encryptedData,d=u.iv,a.next=3,o.default.bindPhone({encryptedPhoneData:c,phoneIV:d});case 3:l=a.sent,i.setData(t(t({},l),{},{phoneAuthorized:!1}),(function(){i.data.mobile?i.onDone({detail:{userInfo:i.userInfo,prizeId:n,mobile:i.data.mobile}}):s.default.Platform.showToast({title:"请授权您的手机号",icon:"none"})}));case 5:case"end":return a.stop()}}),r)})))()},onPhoneAuthClick:function(){var e=this;return r(a.default.mark((function t(){var r,n;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.onChangePrize()){t.next=2;break}return t.abrupt("return");case 2:return r=Number(e.prizeId),t.next=5,c.default.getPrizeIds();case 5:n=t.sent,t.t0=r,t.next=t.t0===n.half_price?9:t.t0===n.free_use?11:13;break;case 9:return 1===e.data.promotionType?e.setData({phoneAuthorized:!0}):e.onDone({detail:{userInfo:e.userInfo,prizeId:r,mobile:e.data.mobile}}),t.abrupt("break",13);case 11:return e.onDone({detail:{userInfo:e.userInfo,prizeId:r,mobile:e.data.mobile}}),t.abrupt("break",13);case 13:case"end":return t.stop()}}),t)})))()},onAgreeClick:function(){var e=this.data,t=e.promotionType,a=e.agreeContact,r=e.mainPrizeList;(1===t||r.length>1)&&this.setData({agreeContact:!a})},onChangePrize:function(){return!this.data.agreeContact&&(this.setData({"drawer.show":!1,phoneAuthorized:!1,agreeContact:!0,selectedIndex:1}),!0)},onDrawerClose:function(){this.setData({"drawer.show":!1,phoneAuthorized:!1})},notifyTask:function(){this.reportedTask||(o.default.report(d.ANALYSIS_DATA.S024.name),this.reportedTask=!0)},notifyRecommend:function(){this.reportedRecommend||(o.default.report(d.ANALYSIS_DATA.S032.name),this.reportedRecommend=!0)},onGoZhiboRoom:function(){o.default.report(d.ANALYSIS_DATA.S039.name),wx.navigateTo({url:"plugin-private://wx2b03c6e691cd7370/pages/live-player-plugin?room_id=43"})}}});
},{isPage:false,isComponent:true,currentFile:'miniprogram_npm/@tmsfe/tms-ui/checkin/components/scene-main/index.js'});require("miniprogram_npm/@tmsfe/tms-ui/checkin/components/scene-main/index.js");