$gwx_XC_8=function(_,_v,_n,_p,_s,_wp,_wl,$gwn,$gwl,$gwh,wh,$gstack,$gwrt,gra,grb,TestTest,wfor,_ca,_da,_r,_rz,_o,_oz,_1,_1z,_2,_2z,_m,_mz,nv_getDate,nv_getRegExp,nv_console,nv_parseInt,nv_parseFloat,nv_isNaN,nv_isFinite,nv_decodeURI,nv_decodeURIComponent,nv_encodeURI,nv_encodeURIComponent,$gdc,nv_JSON,_af,_gv,_ai,_grp,_gd,_gapi,$ixc,_ic,_w,_ev,_tsd){return function(path,global){
if(typeof global==='undefined'){if (typeof __GWX_GLOBAL__==='undefined')global={};else global=__GWX_GLOBAL__;}if(typeof __WXML_GLOBAL__ === 'undefined') {__WXML_GLOBAL__={};
}__WXML_GLOBAL__.modules = __WXML_GLOBAL__.modules || {};
var e_={}
if(typeof(global.entrys)==='undefined')global.entrys={};e_=global.entrys;
var d_={}
if(typeof(global.defines)==='undefined')global.defines={};d_=global.defines;
var f_={}
if(typeof(global.modules)==='undefined')global.modules={};f_=global.modules || {};
var p_={}
__WXML_GLOBAL__.ops_cached = __WXML_GLOBAL__.ops_cached || {}
__WXML_GLOBAL__.ops_set = __WXML_GLOBAL__.ops_set || {};
__WXML_GLOBAL__.ops_init = __WXML_GLOBAL__.ops_init || {};
var z=__WXML_GLOBAL__.ops_set.$gwx_XC_8 || [];
function gz$gwx_XC_8_1(){
if( __WXML_GLOBAL__.ops_cached.$gwx_XC_8_1)return __WXML_GLOBAL__.ops_cached.$gwx_XC_8_1
__WXML_GLOBAL__.ops_cached.$gwx_XC_8_1=[];
(function(z){var a=11;function Z(ops){z.push(ops)}
Z([[9],[[9],[[9],[[9],[[9],[[9],[[9],[[9],[[9],[[8],'enable',[[7],[3,'enable']]],[[8],'status',[[7],[3,'status']]]],[[8],'pendingCmd',[[7],[3,'pendingCmd']]]],[[8],'airConditionRemainTime',[[7],[3,'airConditionRemainTime']]]],[[8],'airConditionPercent',[[7],[3,'airConditionPercent']]]],[[8],'airConditionKey',[[7],[3,'airConditionKey']]]],[[8],'findCarActive',[[7],[3,'findCarActive']]]],[[8],'car',[[7],[3,'car']]]],[[8],'config',[[7],[3,'config']]]],[[8],'skin',[[7],[3,'skin']]]])
Z([[7],[3,'skin']])
Z([3,'pin-modal'])
Z([[7],[3,'pinModalShow']])
})(__WXML_GLOBAL__.ops_cached.$gwx_XC_8_1);return __WXML_GLOBAL__.ops_cached.$gwx_XC_8_1
}
__WXML_GLOBAL__.ops_set.$gwx_XC_8=z;
__WXML_GLOBAL__.ops_init.$gwx_XC_8=true;
var x=['./miniprogram_npm/@tmsfe/tms-ui/car-control/components/card/card.wxml','./template-sinan/template-sinan.wxml','./template-carindex/template-carindex.wxml','./template-sinanhome/template-sinanhome.wxml'];d_[x[0]]={}
var m0=function(e,s,r,gg){
var z=gz$gwx_XC_8_1()
var l3D=e_[x[0]].i
_ai(l3D,x[1],e_,x[0],2,2)
_ai(l3D,x[2],e_,x[0],3,2)
_ai(l3D,x[3],e_,x[0],4,2)
var a4D=_v()
_(r,a4D)
var t5D=_oz(z,1,e,s,gg)
var e6D=_gd(x[0],t5D,e_,d_)
if(e6D){
var b7D=_1z(z,0,e,s,gg) || {}
var cur_globalf=gg.f
a4D.wxXCkey=3
e6D(b7D,b7D,a4D,gg)
gg.f=cur_globalf
}
else _w(t5D,x[0],6,14)
var o8D=_mz(z,'pin-modal',['id',2,'show',1],[],e,s,gg)
_(r,o8D)
l3D.pop()
l3D.pop()
l3D.pop()
return r
}
e_[x[0]]={f:m0,j:[],i:[],ti:[x[1],x[2],x[3]],ic:[]}
if(path&&e_[path]){
return function(env,dd,global){$gwxc=0;var root={"tag":"wx-page"};root.children=[]
;g="$gwx_XC_8";var main=e_[path].f
if (typeof global==="undefined")global={};global.f=$gdc(f_[path],"",1);
try{
main(env,{},root,global);
_tsd(root)
}catch(err){
console.log(err)
}
;g="";
return root;
}
}
}
}(__g.a,__g.b,__g.c,__g.d,__g.e,__g.f,__g.g,__g.h,__g.i,__g.j,__g.k,__g.l,__g.m,__g.n,__g.o,__g.p,__g.q,__g.r,__g.s,__g.t,__g.u,__g.v,__g.w,__g.x,__g.y,__g.z,__g.A,__g.B,__g.C,__g.D,__g.E,__g.F,__g.G,__g.H,__g.I,__g.J,__g.K,__g.L,__g.M,__g.N,__g.O,__g.P,__g.Q,__g.R,__g.S,__g.T,__g.U,__g.V,__g.W,__g.X,__g.Y,__g.Z,__g.aa);if(__vd_version_info__.delayedGwx||false)$gwx_XC_8();	if (__vd_version_info__.delayedGwx) __wxAppCode__['miniprogram_npm/@tmsfe/tms-ui/car-control/components/card/card.wxml'] = [$gwx_XC_8, './miniprogram_npm/@tmsfe/tms-ui/car-control/components/card/card.wxml'];else __wxAppCode__['miniprogram_npm/@tmsfe/tms-ui/car-control/components/card/card.wxml'] = $gwx_XC_8( './miniprogram_npm/@tmsfe/tms-ui/car-control/components/card/card.wxml' );
	;__wxRoute = "miniprogram_npm/@tmsfe/tms-ui/car-control/components/card/card";__wxRouteBegin = true;__wxAppCurrentFile__="miniprogram_npm/@tmsfe/tms-ui/car-control/components/card/card.js";define("miniprogram_npm/@tmsfe/tms-ui/car-control/components/card/card.js",function(require,module,exports,window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){
"use strict";var e,t=require("../../../../../../@babel/runtime/helpers/objectSpread2"),n=o(require("../../../../../../@babel/runtime/regenerator")),a=require("../../../../../../@babel/runtime/helpers/asyncToGenerator"),r=o(require("../../logic/Controller")),i=o(require("../../logic/Cloud"));function o(e){return e&&e.__esModule?e:{default:e}}var u={};Component({properties:{car:{type:Object,observer:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e&&t.wecarId&&t.wecarId===this.data.car.wecarId||(this.setAirConditionProgress(),t.config&&1!==t.config.control||this.syncStatus(t.wecarId))}},config:{type:Object,value:r.default.defaultConfig},skin:{type:String,value:"mycar"}},data:{enable:!1,status:r.default.defaultStatus,pinModalShow:!1,pendingCmd:{},airConditionRemainTime:0,airConditionPercent:1,airConditionKey:"",findCarActive:!1},created:function(){r.default.setCmdSyncCb(this.syncCommand.bind(this))},detached:function(){clearInterval(e),e=null},pageLifetimes:{hide:function(){clearInterval(e),e=null}},methods:{resetData:function(){var e=this;return a(n.default.mark((function t(){return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){return e.setData({enable:!1,pendingCmd:{},status:r.default.defaultStatus,airConditionKey:""},t)}));case 2:case"end":return t.stop()}}),t)})))()},syncStatus:function(){var i=arguments,o=this;return a(n.default.mark((function u(){var s,c;return n.default.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:s=i.length>0&&void 0!==i[0]?i[0]:"",c=function(){var i=a(n.default.mark((function a(){var i;return n.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i={enable:!0},n.next=3,r.default.getStatus(s);case 3:if(i.status=n.sent,0===i.status.carStatus.airConditionStatus&&(i.airConditionKey=""),s===o.data.car.wecarId&&e){n.next=7;break}return n.abrupt("return");case 7:r.default.report({4:o.data.car.wecarId,11:o.data.car.channel,27:"O003",34:JSON.stringify(i.status)}),o.setData(i),o.triggerEvent("statusUpdate",t(t({},i),{},{wecarId:s}));case 10:case"end":return n.stop()}}),a)})));return function(){return i.apply(this,arguments)}}(),clearInterval(e),e=null,c(),e=setInterval((function(){return c()}),1e4);case 6:case"end":return u.stop()}}),u)})))()},syncCommand:function(){var i=arguments,o=this;return a(n.default.mark((function a(){var s,c,d,l,f,p;return n.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(s=i.length>0&&void 0!==i[0]?i[0]:{},c=o.data,d=c.car.wecarId,l=c.status,s.wecarId===d){n.next=4;break}return n.abrupt("return");case 4:if(f={pendingCmd:{},status:l},!s.pending){n.next=9;break}f.pendingCmd=s,n.next=27;break;case 9:if(s.success){n.next=13;break}r.default.showError(s.type,s.opt,s.code,s.msg),n.next=27;break;case 13:r.default.getPlatform().showToast({title:s.msg,icon:"none"}),n.t0=s.type,n.next=1===n.t0?17:2===n.t0?19:3===n.t0?22:24;break;case 17:return f.status.carStatus.lockStatus=s.opt,n.abrupt("break",24);case 19:return f.findCarActive=!0,setTimeout((function(){o.setData({findCarActive:!1},(function(){o.triggerEvent("statusUpdate",t(t({},o.data),{},{wecarId:d}))}))}),5e3),n.abrupt("break",24);case 22:return 2!==s.opt?(f.status.carStatus.airConditionStatus=1,f.airConditionKey=s.key,p=Date.now(),u[d]={time:p,key:s.key},o.setAirConditionProgress()):(f.status.carStatus.airConditionStatus=2,f.airConditionKey=""),n.abrupt("break",24);case 24:clearInterval(e),e=-1,setTimeout((function(){return o.syncStatus(d)}),1e4);case 27:setTimeout((function(){o.setData(f),s.success&&o.triggerEvent("statusUpdate",t(t({},f),{},{wecarId:d}))}),1e3);case 28:case"end":return n.stop()}}),a)})))()},setAirConditionProgress:function(){var e,t=this,n=0,a=0,r="";this.setData({airConditionRemainTime:n,airConditionPercent:a,airConditionKey:r});var i=this.data.car.wecarId,o=0;null!=u&&null!==(e=u[i])&&void 0!==e&&e.time&&(o=u[i].time,r=u[i].key);var s=o+3e5;s-Date.now()<=0||(a=1-(n=s-Date.now())/3e5,this.setData({airConditionKey:r,airConditionPercent:a,airConditionEndTime:s}),setTimeout((function(){return t.setData({airConditionRemainTime:n,airConditionPercent:1})}),2e3))},controlBtnTap:function(){var e=arguments,t=this;return a(n.default.mark((function i(){var o,u,s,c,d,l,f,p,m,v,b,h,C,g,w,k;return n.default.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(o=e.length>0&&void 0!==e[0]?e[0]:{},r.default.getPlatform().vibrateShort({}),u=o.currentTarget.dataset,s=u.type,c=u.opt,d=u.key,l=t.data,f=l.car,p=f.wecarId,m=f.channel,v=l.status,b=l.pendingCmd,h=l.enable,C=l.airConditionEndTime,g=void 0===C?0:C,r.default.report({4:p,11:m,27:"O001",34:s,35:c}),h&&!b.pending){i.next=7;break}return i.abrupt("return");case 7:if(0!==v.userInfo.pinExist){i.next=10;break}return r.default.getPlatform().showModal({title:"错误详情",content:"该账号不存在有效PIN码，请在车厂APP中先进行设置",confirmColor:"#4a89ff",confirmText:"确认",showCancel:!1}),i.abrupt("return");case 10:if(3!==s||2!==c){i.next=18;break}return w=g-Date.now(),k=w>0?"空调将在".concat(Math.round(w/1e3),"秒后自动关闭，确定立即关闭？"):"是否关闭空调？",i.next=15,new Promise((function(e){return r.default.getPlatform().showModal({title:"操作确认",content:k,confirmColor:"#4a89ff",success:e})}));case 15:if(i.sent.confirm){i.next=18;break}return i.abrupt("return");case 18:t.selectComponent("#pin-modal").showPinInput({success:function(){var e=arguments;return a(n.default.mark((function t(){var a;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.length>0&&void 0!==e[0]?e[0]:"",t.next=3,r.default.postCommand(p,a,s,c,d);case 3:case"end":return t.stop()}}),t)})))()}});case 20:case"end":return i.stop()}}),i)})))()},onCarStatusClick:function(){var e=this;return a(n.default.mark((function t(){var a,o,u,s,c,d,l,f,p,m,v,b,h;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.data,o=a.enable,u=a.config.deviceId,s=void 0===u?"":u,c=a.car,d=c.wecarId,l=c.channel,r.default.report({4:d,11:l,27:"O002"}),!wx.requestSubscribeMessage){t.next=5;break}return t.next=5,new Promise((function(e){return wx.requestSubscribeMessage({tmplIds:["mycar"===r.default.getPlatform().appName?"DtY9oQLxdq6keguTtcSqeRYr-Hne3RpGIkic1_ktH3I":"X25m898RvD73QEqXhzZAKygcx1cEJca9KDkNyjOZiME"],complete:e})}));case 5:if(o){t.next=7;break}return t.abrupt("return");case 7:if(f="",!r.default.useCloud){t.next=23;break}return t.next=11,i.default.queryStatusDetail(d);case 11:if(p=t.sent,m=p.detail,v=m.type,b=m.url,"url"!==v){t.next=19;break}f=encodeURIComponent(b),t.next=21;break;case 19:return wx.showToast({title:"获取车况信息失败"}),t.abrupt("return");case 21:t.next=28;break;case 23:return t.next=25,r.default.getCarStatusParam(s);case 25:h=t.sent,f=encodeURIComponent("https://vehicle-portal.beantechyun.com/#/vehicleState?p=".concat(h)),/test|dev/.test(r.default.getPlatform().env.APP_ENV)&&(f=encodeURIComponent("https://vehicle-portal-test.beantechyun.cn/#/vehicleState?p=".concat(h)));case 28:r.default.getPlatform().navigateTo({url:"".concat("/modules/x/webcontainer/webcontainer","?url=").concat(f)});case 29:case"end":return t.stop()}}),t)})))()}}});
},{isPage:false,isComponent:true,currentFile:'miniprogram_npm/@tmsfe/tms-ui/car-control/components/card/card.js'});require("miniprogram_npm/@tmsfe/tms-ui/car-control/components/card/card.js");