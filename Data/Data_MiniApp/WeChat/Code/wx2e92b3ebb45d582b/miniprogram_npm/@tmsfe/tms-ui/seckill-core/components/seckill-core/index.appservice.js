$gwx_XC_48=function(_,_v,_n,_p,_s,_wp,_wl,$gwn,$gwl,$gwh,wh,$gstack,$gwrt,gra,grb,TestTest,wfor,_ca,_da,_r,_rz,_o,_oz,_1,_1z,_2,_2z,_m,_mz,nv_getDate,nv_getRegExp,nv_console,nv_parseInt,nv_parseFloat,nv_isNaN,nv_isFinite,nv_decodeURI,nv_decodeURIComponent,nv_encodeURI,nv_encodeURIComponent,$gdc,nv_JSON,_af,_gv,_ai,_grp,_gd,_gapi,$ixc,_ic,_w,_ev,_tsd){return function(path,global){
if(typeof global==='undefined'){if (typeof __GWX_GLOBAL__==='undefined')global={};else global=__GWX_GLOBAL__;}if(typeof __WXML_GLOBAL__ === 'undefined') {__WXML_GLOBAL__={};
}__WXML_GLOBAL__.modules = __WXML_GLOBAL__.modules || {};
var e_={}
if(typeof(global.entrys)==='undefined')global.entrys={};e_=global.entrys;
var d_={}
if(typeof(global.defines)==='undefined')global.defines={};d_=global.defines;
var f_={}
if(typeof(global.modules)==='undefined')global.modules={};f_=global.modules || {};
var p_={}
__WXML_GLOBAL__.ops_cached = __WXML_GLOBAL__.ops_cached || {}
__WXML_GLOBAL__.ops_set = __WXML_GLOBAL__.ops_set || {};
__WXML_GLOBAL__.ops_init = __WXML_GLOBAL__.ops_init || {};
var z=__WXML_GLOBAL__.ops_set.$gwx_XC_48 || [];
function gz$gwx_XC_48_1(){
if( __WXML_GLOBAL__.ops_cached.$gwx_XC_48_1)return __WXML_GLOBAL__.ops_cached.$gwx_XC_48_1
__WXML_GLOBAL__.ops_cached.$gwx_XC_48_1=[];
(function(z){var a=11;function Z(ops){z.push(ops)}
Z([3,'onCouponTap'])
Z([3,'onGetPhoneNumber'])
Z([3,'handlePayAction'])
Z([3,'onTabTap'])
Z([3,'onUseRuleTap'])
Z([[7],[3,'buttonArrowRight']])
Z([3,'onGoProduct'])
Z([3,'onCloseDialog'])
Z([[7],[3,'countDown']])
Z([[7],[3,'currentRoundIndex']])
Z([[7],[3,'customCouponDesc']])
Z([[7],[3,'display']])
Z([[7],[3,'grayTheme']])
Z([[7],[3,'hidePriceDom']])
Z([[7],[3,'phone']])
Z([[7],[3,'rounds']])
Z([[7],[3,'sec']])
Z([[7],[3,'secKillDialogInfo']])
Z([[7],[3,'secKillDialogShow']])
Z([[7],[3,'secKillDialogState']])
Z([[7],[3,'showRuleButton']])
})(__WXML_GLOBAL__.ops_cached.$gwx_XC_48_1);return __WXML_GLOBAL__.ops_cached.$gwx_XC_48_1
}
__WXML_GLOBAL__.ops_set.$gwx_XC_48=z;
__WXML_GLOBAL__.ops_init.$gwx_XC_48=true;
var x=['./miniprogram_npm/@tmsfe/tms-ui/seckill-core/components/seckill-core/index.wxml'];d_[x[0]]={}
var m0=function(e,s,r,gg){
var z=gz$gwx_XC_48_1()
var aFN=_mz(z,'seckill-view',['bind:onCouponTap',0,'bind:onGetPhoneNumber',1,'bind:onNavToPayDetail',1,'bind:onTabTap',2,'bind:onUseRuleTap',3,'buttonArrowRight',4,'catch:onClickItem',5,'catch:onCloseDialog',6,'countDown',7,'currentRoundIndex',8,'customCouponDesc',9,'display',10,'grayTheme',11,'hidePriceDom',12,'phone',13,'rounds',14,'sec',15,'secKillDialogInfo',16,'secKillDialogShow',17,'secKillDialogState',18,'showRuleButton',19],[],e,s,gg)
_(r,aFN)
return r
}
e_[x[0]]={f:m0,j:[],i:[],ti:[],ic:[]}
if(path&&e_[path]){
return function(env,dd,global){$gwxc=0;var root={"tag":"wx-page"};root.children=[]
;g="$gwx_XC_48";var main=e_[path].f
if (typeof global==="undefined")global={};global.f=$gdc(f_[path],"",1);
try{
main(env,{},root,global);
_tsd(root)
}catch(err){
console.log(err)
}
;g="";
return root;
}
}
}
}(__g.a,__g.b,__g.c,__g.d,__g.e,__g.f,__g.g,__g.h,__g.i,__g.j,__g.k,__g.l,__g.m,__g.n,__g.o,__g.p,__g.q,__g.r,__g.s,__g.t,__g.u,__g.v,__g.w,__g.x,__g.y,__g.z,__g.A,__g.B,__g.C,__g.D,__g.E,__g.F,__g.G,__g.H,__g.I,__g.J,__g.K,__g.L,__g.M,__g.N,__g.O,__g.P,__g.Q,__g.R,__g.S,__g.T,__g.U,__g.V,__g.W,__g.X,__g.Y,__g.Z,__g.aa);if(__vd_version_info__.delayedGwx||false)$gwx_XC_48();	if (__vd_version_info__.delayedGwx) __wxAppCode__['miniprogram_npm/@tmsfe/tms-ui/seckill-core/components/seckill-core/index.wxml'] = [$gwx_XC_48, './miniprogram_npm/@tmsfe/tms-ui/seckill-core/components/seckill-core/index.wxml'];else __wxAppCode__['miniprogram_npm/@tmsfe/tms-ui/seckill-core/components/seckill-core/index.wxml'] = $gwx_XC_48( './miniprogram_npm/@tmsfe/tms-ui/seckill-core/components/seckill-core/index.wxml' );
	;__wxRoute = "miniprogram_npm/@tmsfe/tms-ui/seckill-core/components/seckill-core/index";__wxRouteBegin = true;__wxAppCurrentFile__="miniprogram_npm/@tmsfe/tms-ui/seckill-core/components/seckill-core/index.js";define("miniprogram_npm/@tmsfe/tms-ui/seckill-core/components/seckill-core/index.js",function(require,module,exports,window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){
"use strict";var t,e=(t=require("../../../../../../@babel/runtime/regenerator"))&&t.__esModule?t:{default:t},n=require("../../../../../../@babel/runtime/helpers/asyncToGenerator"),o=require("../../../../../../@babel/runtime/helpers/objectSpread2"),i=require("../../logic/Seckill"),r=require("../../logic/Report");var a={bubbles:!0,composed:!0};Component({properties:{promoCode:{type:String,value:""},reportData:{type:Object,value:void 0},activityControl:{type:Object,value:{}},useGrayTheme:{type:Boolean,value:!1},showRule:{type:Boolean,value:!1},customTmplIds:{type:Array,value:[]},customGoPay:{type:Boolean,value:!1},customGoProduct:{type:Boolean,value:!1}},data:{sec:[],phone:"",display:!1,grayTheme:!1,analyticData:{},showRuleButton:!1,tmplIds:!1,countDown:{onePlaceMinute:0,tenPlaceSecond:0,onePlaceSecond:0},secKillDialogShow:!1,secKillDialogState:""},rendering:!1,secKillTimerId:-1,countDownTimerId:-1,needAutoChangeTab:!0,created:function(t){this.secKillCtrl=new i.Controller(o(o({},t),{},{remindMinute:3}))},attached:function(){this.run()},detached:function(){this.stopCountDownTimer(),this.stopSeckillTimer()},pageLifetimes:{show:function(){this.run()}},methods:{run:function(){this.inited=!0,this.updateActivityData()&&this.render()},updateActivityData:function(){var t=this.data,e=t.reportData,n=t.useGrayTheme,i=t.customTmplIds,a=t.showRule,l=t.activityControl,u=l.activityData,s=l.secKillConfig;return!(!u||!s)&&(this.activityControl=l,this.secKillCtrl.setOptions(l),e&&(u.analyticData=e),i instanceof Array&&i.length>0&&(u.tmplIds=i),n&&(u.grayTheme=!0),a&&(u.showRuleButton=a),u.analyticData&&(0,r.setAnalyticData)(u.analyticData),this.setData(o({},u)),!0)},render:function(){var t=this;this.rendering||(this.rendering=!0,this.stopCountDownTimer(),this.needAutoChangeTab=!0,wx.onAppShow((function(){t.needAutoChangeTab=!0})),this.getData().then())},getData:function(){var t=this;return n(e.default.mark((function n(){return e.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.secKillCtrl.getSeckillData(t.needAutoChangeTab).then((function(e){var n,i,l;t.triggerEvent("onCompReady","seckillReady",a),t.triggerEvent("onSecKillReady",o({},e),a),t.renderSucc(e),(0,r.report)("render",{37:null===(n=t.data)||void 0===n||null===(i=n.activityControl)||void 0===i||null===(l=i.secKillConfig)||void 0===l?void 0:l.promotionCode,38:JSON.stringify(e.rounds[e.currentRoundIndex].coupons.map((function(t){return t.id}))),39:e.rounds[e.currentRoundIndex].id})})).catch((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"getSeckillData error";console.error(e),t.triggerEvent("onSecKillReady",{},a),t.setData({display:!1})}));case 2:t.rendering=!1;case 3:case"end":return e.stop()}}),n)})))()},onCloseDialog:function(){this.setData({secKillDialogShow:!1})},onGoProduct:function(t){var e,n,o=t.detail;this.data.customGoProduct?this.triggerEvent("onGoProduct",o,{bubbles:!0,composed:!0}):null===(e=this.activityControl)||void 0===e||null===(n=e.events)||void 0===n||n.goProduct({instance:this,detail:o})},handlePayAction:function(t){var e,n,o,i,a=t.detail,l=this.data,u=l.rounds,s=l.currentRoundIndex,c=l.activityControl;this.setData({currentCouponIndex:a.index}),(0,r.report)("buttonClick",{37:null==c||null===(e=c.secKillConfig)||void 0===e?void 0:e.promotionCode,38:null===(n=u[s])||void 0===n?void 0:n.coupons[null==a?void 0:a.index].id,39:u[s].id,40:null===(o=u[s])||void 0===o||null===(i=o.coupons[null==a?void 0:a.index])||void 0===i?void 0:i.couponBtnText}),this.navToPayDetail({detail:a})},navToPayDetail:function(t){var e,n,o=t.detail;this.data.customGoPay||(null===(e=this.activityControl)||void 0===e||null===(n=e.events)||void 0===n||n.goPay({instance:this,detail:o}))},wait:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60,n=arguments.length>1?arguments[1]:void 0,o=this.data.sec[n];o&&clearInterval(o.t);var i={time:e};i.t=setInterval((function(){i.time=i.time-1,i.show=i.time>0?"".concat(i.time):"",t.data.sec[n]=i,t.setData({sec:t.data.sec}),0===i.time&&clearInterval(i.t)}),1e3)},renderSucc:function(t){var e=this,n=t.rounds,i=void 0===n?[]:n,r=t.needStartSeckillTimer,a=t.timerInterval,l=this.data.timerInterval;this.setData(o({display:!0},t)),i.forEach((function(t,n){var o=t.coupons.find((function(t){return t.orderInfo}));if(null!=o&&o.orderInfo){var i=o.orderInfo,r=(i.payExpirationTime-i.serverTime)/1e3>>0;e.wait(r,n)}})),r?this.startSeckillTimer(a,l):this.stopSeckillTimer(),i.filter((function(t){return t.needStartCountDownTimer})).length<=0||-1===this.countDownTimerId&&this.startCountDownTimer(t)},startSeckillTimer:function(t,e){var n=this;this.secKillTimerId>=0&&e===t||(this.stopSeckillTimer(),this.secKillTimerId=setInterval((function(){n.secKillCtrl.getSeckillData(n.needAutoChangeTab).then((function(t){return n.renderSucc(t)})).catch((function(){}))}),t))},stopSeckillTimer:function(){clearInterval(this.secKillTimerId),this.secKillTimerId=-1},startCountDownTimer:function(t){var e=this;this.stopCountDownTimer(),this.triggerEvent("countDown",{enable:!0}),this.countDownTimerId=setInterval((function(){var n,i=e.secKillCtrl.getCountDownData(t,e.data.currentRoundIndex),r={};[i.onePlaceMinute,i.tenPlaceSecond,i.onePlaceSecond].every((function(t){return 0===t}))&&(e.stopCountDownTimer(),r=e.secKillCtrl.getCountDownOverData(t.countDownIndex,null===(n=t.rounds[t.countDownIndex].coupon)||void 0===n?void 0:n.length));e.setData(o({countDown:i},r))}),1e3)},stopCountDownTimer:function(){clearInterval(this.countDownTimerId),this.triggerEvent("countDown",{enable:!1}),this.countDownTimerId=-1},onTabTap:function(t){var e=t.detail.index;e!==this.data.currentRoundIndex&&(this.secKillCtrl.bindInfoUpdate(o({currentRoundIndex:e},this.data.rounds[e])),this.needAutoChangeTab=!1,this.setData({currentRoundIndex:e}))},onCouponTap:function(t){var e,n,i,a=this,l=t.detail,u=l.index,s=l.cardtype,c=this.data,d=c.rounds,v=c.currentRoundIndex,h=c.activityControl;(0,r.report)("buttonClick",{37:null==h||null===(e=h.secKillConfig)||void 0===e?void 0:e.promotionCode,38:null===(n=d[v])||void 0===n?void 0:n.coupons[u].id,39:v,40:null===(i=d[v])||void 0===i?void 0:i.coupons[u].couponBtnText}),this.setData({currentCouponIndex:u}),this.secKillCtrl.onClickCoupon(this.data,u).then((function(t){if(a.setData(o(o({},t||{}),{},{cardtype:s})),t.navigate){var e={orderId:t.orderId,ranking:t.ranking,bussClassify:t.bussClassify};a.navToPayDetail({detail:e}),a.triggerEvent("onNavToPayDetail",e,{bubbles:!0,composed:!0})}}))},onGetPhoneNumber:function(t){var o=this;return n(e.default.mark((function n(){var i,a,l,u,s,c,d,v,h,p,m,C,f,g,y,D;return e.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=t.detail,s=o.data,c=s.rounds,d=s.currentRoundIndex,v=s.activityControl,h=u.encryptedData,p=u.iv,m=u.index,C=u.cardtype,o.setData({currentCouponIndex:m}),(0,r.report)("buttonClick",{37:null==v||null===(i=v.secKillConfig)||void 0===i?void 0:i.promotionCode,38:null===(a=c[d])||void 0===a?void 0:a.coupons[m].id,39:d,40:null===(l=c[d])||void 0===l?void 0:l.coupons[m].couponBtnText}),h){e.next=9;break}return f=o.data,g=f.rounds,y=f.currentRoundIndex,o.secKillCtrl.subscribe(g[y],y),e.abrupt("return");case 9:return e.prev=9,e.next=12,o.secKillCtrl.registMobile(h,p);case 12:D=e.sent,o.setData({phone:D}),o.onCouponTap({detail:{index:m,cardtype:C}}),e.next=19;break;case 17:e.prev=17,e.t0=e.catch(9);case 19:case"end":return e.stop()}}),n,null,[[9,17]])})))()},onUseRuleTap:function(){var t,e,n,o,i;(0,r.report)("onUseRuleTap",{37:null===(t=this.data)||void 0===t||null===(e=t.activityControl)||void 0===e||null===(n=e.secKillConfig)||void 0===n?void 0:n.promotionCode}),null===(o=this.activityControl)||void 0===o||null===(i=o.events)||void 0===i||i.onRuleButtonClick({instance:this})}},observers:{"promoCode,reportData,useGrayTheme,customTmplIds,notRedirectWhenHasGetCoupon,theme,showRule,activityControl":function(){this.inited&&this.run()},activityControl:function(t){t&&this.run()},secKillDialogShow:function(t){if(t){var e,n,o,i,a=this.data,l=a.rounds,u=a.currentRoundIndex,s=a.currentCouponIndex,c=a.activityControl,d=a.secKillDialogState;(0,r.report)("showDialog",{37:null==c||null===(e=c.secKillConfig)||void 0===e?void 0:e.promotionCode,38:null===(n=l[u])||void 0===n||null===(o=n.coupons[s])||void 0===o?void 0:o.id,39:null===(i=l[u])||void 0===i?void 0:i.id,40:d})}}}});
},{isPage:false,isComponent:true,currentFile:'miniprogram_npm/@tmsfe/tms-ui/seckill-core/components/seckill-core/index.js'});require("miniprogram_npm/@tmsfe/tms-ui/seckill-core/components/seckill-core/index.js");