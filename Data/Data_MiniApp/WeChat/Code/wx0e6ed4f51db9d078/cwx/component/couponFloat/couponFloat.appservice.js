$gwx_XC_6=function(_,_v,_n,_p,_s,_wp,_wl,$gwn,$gwl,$gwh,wh,$gstack,$gwrt,gra,grb,TestTest,wfor,_ca,_da,_r,_rz,_o,_oz,_1,_1z,_2,_2z,_m,_mz,nv_getDate,nv_getRegExp,nv_console,nv_parseInt,nv_parseFloat,nv_isNaN,nv_isFinite,nv_decodeURI,nv_decodeURIComponent,nv_encodeURI,nv_encodeURIComponent,$gdc,nv_JSON,_af,_gv,_ai,_grp,_gd,_gapi,$ixc,_ic,_w,_ev,_tsd){return function(path,global){
if(typeof global==='undefined'){if (typeof __GWX_GLOBAL__==='undefined')global={};else global=__GWX_GLOBAL__;}if(typeof __WXML_GLOBAL__ === 'undefined') {__WXML_GLOBAL__={};
}__WXML_GLOBAL__.modules = __WXML_GLOBAL__.modules || {};
var e_={}
if(typeof(global.entrys)==='undefined')global.entrys={};e_=global.entrys;
var d_={}
if(typeof(global.defines)==='undefined')global.defines={};d_=global.defines;
var f_={}
if(typeof(global.modules)==='undefined')global.modules={};f_=global.modules || {};
var p_={}
__WXML_GLOBAL__.ops_cached = __WXML_GLOBAL__.ops_cached || {}
__WXML_GLOBAL__.ops_set = __WXML_GLOBAL__.ops_set || {};
__WXML_GLOBAL__.ops_init = __WXML_GLOBAL__.ops_init || {};
var z=__WXML_GLOBAL__.ops_set.$gwx_XC_6 || [];
function gz$gwx_XC_6_1(){
if( __WXML_GLOBAL__.ops_cached.$gwx_XC_6_1)return __WXML_GLOBAL__.ops_cached.$gwx_XC_6_1
__WXML_GLOBAL__.ops_cached.$gwx_XC_6_1=[];
(function(z){var a=11;function Z(ops){z.push(ops)}
Z([[7],[3,'isShowFloat']])
Z([3,'float-wrapper'])
Z([[2,'=='],[[7],[3,'floatStep']],[1,1]])
Z([3,'res-envelope'])
Z([a,[3,'background:url('],[[6],[[7],[3,'floatConfig']],[3,'redEnvelope']],[3,');background-size:100%,100%;']])
Z([[2,'!'],[[7],[3,'getBtnWidthLogin']]])
Z([[7],[3,'getBtnWidthLogin']])
Z([[7],[3,'couponList']])
Z([[7],[3,'index']])
Z([3,'coupon-item'])
Z([3,'left'])
Z([[2,'&&'],[[2,'=='],[[6],[[7],[3,'item']],[3,'deductionStrategyTypeID']],[1,3]],[[6],[[7],[3,'item']],[3,'startAmount']]])
Z([[2,'=='],[[6],[[7],[3,'item']],[3,'deductionType']],[1,0]])
Z([[2,'=='],[[6],[[7],[3,'item']],[3,'deductionType']],[1,1]])
Z([3,'right'])
Z([[2,'=='],[[6],[[7],[3,'item']],[3,'status']],[1,1]])
Z([[2,'&&'],[[7],[3,'getBtnWidthLogin']],[[2,'>'],[[6],[[7],[3,'item']],[3,'generateCountLeft']],[1,0]]])
Z([[2,'&&'],[[2,'!'],[[7],[3,'getBtnWidthLogin']]],[[2,'>'],[[6],[[7],[3,'item']],[3,'generateCountLeft']],[1,0]]])
Z(z[15])
Z([[2,'!='],[[6],[[7],[3,'item']],[3,'rule']],[1,'none']])
Z([[2,'&&'],[[2,'||'],[[2,'=='],[[6],[[7],[3,'item']],[3,'status']],[1,0]],[[2,'!'],[[6],[[7],[3,'item']],[3,'status']]]],[[2,'<='],[[6],[[7],[3,'item']],[3,'generateCountLeft']],[1,0]]])
Z(z[0])
})(__WXML_GLOBAL__.ops_cached.$gwx_XC_6_1);return __WXML_GLOBAL__.ops_cached.$gwx_XC_6_1
}
__WXML_GLOBAL__.ops_set.$gwx_XC_6=z;
__WXML_GLOBAL__.ops_init.$gwx_XC_6=true;
var x=['./cwx/component/couponFloat/couponFloat.wxml'];d_[x[0]]={}
var m0=function(e,s,r,gg){
var z=gz$gwx_XC_6_1()
var bED=_v()
_(r,bED)
if(_oz(z,0,e,s,gg)){bED.wxVkey=1
var xGD=_n('view')
_rz(z,xGD,'class',1,e,s,gg)
var oHD=_v()
_(xGD,oHD)
if(_oz(z,2,e,s,gg)){oHD.wxVkey=1
var fID=_mz(z,'view',['class',3,'style',1],[],e,s,gg)
var cJD=_v()
_(fID,cJD)
if(_oz(z,5,e,s,gg)){cJD.wxVkey=1
}
var hKD=_v()
_(fID,hKD)
if(_oz(z,6,e,s,gg)){hKD.wxVkey=1
}
cJD.wxXCkey=1
hKD.wxXCkey=1
_(oHD,fID)
}
else{oHD.wxVkey=2
var oLD=_v()
_(oHD,oLD)
var cMD=function(lOD,oND,aPD,gg){
var eRD=_n('view')
_rz(z,eRD,'class',9,lOD,oND,gg)
var oVD=_n('view')
_rz(z,oVD,'class',10,lOD,oND,gg)
var fWD=_v()
_(oVD,fWD)
if(_oz(z,11,lOD,oND,gg)){fWD.wxVkey=1
}
var cXD=_v()
_(oVD,cXD)
if(_oz(z,12,lOD,oND,gg)){cXD.wxVkey=1
}
var hYD=_v()
_(oVD,hYD)
if(_oz(z,13,lOD,oND,gg)){hYD.wxVkey=1
}
fWD.wxXCkey=1
cXD.wxXCkey=1
hYD.wxXCkey=1
_(eRD,oVD)
var oZD=_n('view')
_rz(z,oZD,'class',14,lOD,oND,gg)
var c1D=_v()
_(oZD,c1D)
if(_oz(z,15,lOD,oND,gg)){c1D.wxVkey=1
}
else{c1D.wxVkey=2
var o2D=_n('view')
var l3D=_v()
_(o2D,l3D)
if(_oz(z,16,lOD,oND,gg)){l3D.wxVkey=1
}
var a4D=_v()
_(o2D,a4D)
if(_oz(z,17,lOD,oND,gg)){a4D.wxVkey=1
}
l3D.wxXCkey=1
a4D.wxXCkey=1
_(c1D,o2D)
}
c1D.wxXCkey=1
_(eRD,oZD)
var bSD=_v()
_(eRD,bSD)
if(_oz(z,18,lOD,oND,gg)){bSD.wxVkey=1
}
var oTD=_v()
_(eRD,oTD)
if(_oz(z,19,lOD,oND,gg)){oTD.wxVkey=1
}
var xUD=_v()
_(eRD,xUD)
if(_oz(z,20,lOD,oND,gg)){xUD.wxVkey=1
}
bSD.wxXCkey=1
oTD.wxXCkey=1
xUD.wxXCkey=1
_(aPD,eRD)
return aPD
}
oLD.wxXCkey=2
_2z(z,7,cMD,e,s,gg,oLD,'item','index','{{index}}')
}
oHD.wxXCkey=1
_(bED,xGD)
}
var oFD=_v()
_(r,oFD)
if(_oz(z,21,e,s,gg)){oFD.wxVkey=1
}
bED.wxXCkey=1
oFD.wxXCkey=1
return r
}
e_[x[0]]={f:m0,j:[],i:[],ti:[],ic:[]}
if(path&&e_[path]){
return function(env,dd,global){$gwxc=0;var root={"tag":"wx-page"};root.children=[]
;g="$gwx_XC_6";var main=e_[path].f
if (typeof global==="undefined")global={};global.f=$gdc(f_[path],"",1);
try{
main(env,{},root,global);
_tsd(root)
}catch(err){
console.log(err)
}
;g="";
return root;
}
}
}
}(__g.a,__g.b,__g.c,__g.d,__g.e,__g.f,__g.g,__g.h,__g.i,__g.j,__g.k,__g.l,__g.m,__g.n,__g.o,__g.p,__g.q,__g.r,__g.s,__g.t,__g.u,__g.v,__g.w,__g.x,__g.y,__g.z,__g.A,__g.B,__g.C,__g.D,__g.E,__g.F,__g.G,__g.H,__g.I,__g.J,__g.K,__g.L,__g.M,__g.N,__g.O,__g.P,__g.Q,__g.R,__g.S,__g.T,__g.U,__g.V,__g.W,__g.X,__g.Y,__g.Z,__g.aa);if(__vd_version_info__.delayedGwx||false)$gwx_XC_6();	if (__vd_version_info__.delayedGwx) __wxAppCode__['cwx/component/couponFloat/couponFloat.wxml'] = [$gwx_XC_6, './cwx/component/couponFloat/couponFloat.wxml'];else __wxAppCode__['cwx/component/couponFloat/couponFloat.wxml'] = $gwx_XC_6( './cwx/component/couponFloat/couponFloat.wxml' );
	;__wxRoute = "cwx/component/couponFloat/couponFloat";__wxRouteBegin = true;__wxAppCurrentFile__="cwx/component/couponFloat/couponFloat.js";define("cwx/component/couponFloat/couponFloat.js",function(require,module,exports,window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){
"use strict";var t,a,o=require("../../cwx.js"),i="",e="",n={getActivityConfig:"/restapi/soa2/18083/getActivityConfig",sendCoupon:"/restapi/soa2/12673/ReceiveCouponByAwardId",getPromotionCoupon:"/restapi/soa2/12673/queryCouponByPackageId"},c=function(t,a,i,e){o.cwx.request({url:n[t],data:a,success:function(t){t&&t.data&&t.data.ResponseStatus&&"Success"==t.data.ResponseStatus.Ack?i&&i(t.data):e&&e(t)},fail:function(t){e&&e(t)}})};Component({properties:{},data:{floatConfig:{},isShowFloat:!1,loginStatus:!1,id:0,allianceid:"",sid:"",specialParameters:"",floatStep:1,getBtnWidthLogin:!1,couponList:[],hasReceive:!1,activityId:""},pageLifetimes:{show:function(){var n,c,d,s,r;t=o.cwx.getCurrentPage(),i=t&&(t.pageid||t.pageId)||"",a=getCurrentPages()[getCurrentPages().length-1]||{},e=(null===(n=o.cwx.cwx_mkt)||void 0===n?void 0:n.openid)||"",this.setData({activityId:(null===(c=a.options)||void 0===c?void 0:c.activityid)||"",allianceid:(null===(d=a.options)||void 0===d?void 0:d.allianceid)||"",sid:(null===(s=a.options)||void 0===s?void 0:s.sid)||"",specialParameters:(null===(r=a.options)||void 0===r?void 0:r.specialParameters)||""})}},lifetimes:{ready:function(){var i,e,n,c,d,s,r,l,u,p,g,f=this;(a=getCurrentPages()[getCurrentPages().length-1]||{},this.data.activityId)?this.initComp(this.data.activityId||(null===(e=a)||void 0===e||null===(n=e.options)||void 0===n?void 0:n.activityid)):this.setData({activityId:(null===(c=a)||void 0===c||null===(d=c.options)||void 0===d?void 0:d.activityid)||"",allianceid:(null===(s=a)||void 0===s||null===(r=s.options)||void 0===r?void 0:r.allianceid)||"",sid:(null===(l=a)||void 0===l||null===(u=l.options)||void 0===u?void 0:u.sid)||"",specialParameters:(null===(p=a)||void 0===p||null===(g=p.options)||void 0===g?void 0:g.specialParameters)||""},(function(){var t,o;f.initComp(f.data.activityId||(null===(t=a)||void 0===t||null===(o=t.options)||void 0===o?void 0:o.activityid))}));t&&t.ubtTrace&&t.ubtTrace("mkt_coupon_float_comp",{openid:o.cwx.cwx_mkt.openid||"",action:"lifetimesReady",platform:"wechat",pageid:t&&(t.pageid||t.pageId)||"",activityId:this.data.activityId||(null===(i=a.options)||void 0===i?void 0:i.activityid)})}},methods:{initComp:function(a){if(a){var o=this,n=new Promise((function(t,i){o.getActivityConfig(a,t,i)})),c=new Promise((function(t,a){o.checkLogin(t,a)}));Promise.all([n,c]).then((function(a){o.checkStock((function(a){if(a&&a[0]&&a[0].isShowFloat){var n=o.data.floatConfig.step-0>2?1:2;a[1]&&a[1].loginStatus?a[1].hasUnReceive?a[1].hasReceive?o.setData({isShowFloat:!0,floatStep:3},(function(){t&&t.ubtTrace&&t.ubtTrace("mkt_coupon_float_comp",{openid:e,action:"showCouponFloat",platform:"wechat",pageid:i,allianceid:o.data.allianceid,sid:o.data.sid,activityId:o.data.activityId})})):(o.getPromotionCoupon(),o.setData({isShowFloat:!0,floatStep:n},(function(){t&&t.ubtTrace&&t.ubtTrace("mkt_coupon_float_comp",{openid:e,action:"showCouponFloat",platform:"wechat",pageid:i,allianceid:o.data.allianceid,sid:o.data.sid,activityId:o.data.activityId})}))):o.setData({isShowFloat:!1}):(o.getPromotionCoupon(),o.setData({isShowFloat:!0,floatStep:n},(function(){t&&t.ubtTrace&&t.ubtTrace("mkt_coupon_float_comp",{openid:e,action:"showCouponFloat",platform:"wechat",pageid:i,allianceid:o.data.allianceid,sid:o.data.sid,activityId:o.data.activityId})})))}else o.setData({isShowFloat:!1})}),a)})).catch((function(t){console.log(t)}))}},getActivityConfig:function(a,o,n){var d=this;a?c("getActivityConfig",{activityId:a},(function(a){if(0==a.errcode){a.activitlyConfig.startTime=d.getTimeStamp(a.activitlyConfig.startTime),a.activitlyConfig.endTime=d.getTimeStamp(a.activitlyConfig.endTime);var c=Object.assign({},a.activitlyConfig,a.activityCustomfields);d.setData({floatConfig:c},(function(){d.handleIsShowFloat(o,n)}))}else n("getActivityConfig error");t&&t.ubtTrace&&t.ubtTrace("mkt_coupon_float_comp",{openid:e,action:"getActivityConfig",platform:"wechat",pageid:i,activityId:d.data.activityId,res:a})}),(function(a){t&&t.ubtTrace&&t.ubtTrace("mkt_coupon_float_comp",{openid:e,action:"getActivityConfig Error",platform:"wechat",error:JSON.stringify(a),pageid:i}),n("getActivityConfig error")})):n("no activityId")},handleIsShowFloat:function(t,o){var i=this.data,e=i.floatConfig,n=i.allianceid,c=i.sid,d=i.specialParameters,s=!0,r=(new Date).getTime();console.log("分渠道展示floatConfig",e),"false"!=e.fullDisplay&&e.fullDisplay||(e.pageId&&e.pageId!=a.pageId&&(s=!1),e.allianceid&&e.allianceid!=n&&(console.log("渠道错误 不展示浮层"),s=!1),e.sid&&e.sid!=c&&(s=!1),e.specialParameters&&e.specialParameters!=d&&(s=!1)),(r>e.endTime||r<e.startTime)&&(s=!1),t(s?{isShowFloat:!0}:{isShowFloat:!1})},checkLogin:function(t,a){var i=this;o.cwx.user.checkLoginStatusFromServer((function(o){o?i.setData({loginStatus:!0,getBtnWidthLogin:!0},(function(){i.getPromotionCoupon(t,a)})):i.setData({loginStatus:!1,getBtnWidthLogin:!1},(function(){t({loginStatus:!1})})),console.log("============islogin="+o+"====================")}))},checkStock:function(a,o){var n=this.data.floatConfig&&this.data.floatConfig.packageId-0||0;c("getPromotionCoupon",{packageId:n},(function(c){if(t&&t.ubtTrace&&t.ubtTrace("mkt_coupon_float_comp",{openid:e,action:"checkStock",platform:"wechat",pageid:i,packageId:n,res:c}),0!=c.errcode||!c.couponList||!c.couponList.some)return!1;c.couponList.some((function(t){return t.generateCountLeft>0}))&&a&&a(o)}))},getPromotionCoupon:function(a,o){var n=this,d=this.data.floatConfig&&this.data.floatConfig.packageId-0||0;c("getPromotionCoupon",{packageId:d},(function(c){if(t&&t.ubtTrace&&t.ubtTrace("mkt_coupon_float_comp",{openid:e,action:"getPromotionCoupon",platform:"wechat",pageid:i,packageId:d,res:c}),0==c.errcode){var s=c.couponList.some((function(t){return 0==t.status})),r=c.couponList.some((function(t){return 1==t.status}));c.couponList.map((function(t){return 1==t.deductionType&&(t.discount=(100-t.discountAmount)/10+"",t.discount1=t.discount.split(".")[0],t.discount2=t.discount.split(".")[1]?"."+t.discount.split(".")[1]:""),t})),n.setData({couponList:c.couponList}),a&&a({loginStatus:!0,hasReceive:r,hasUnReceive:s})}else o&&o("getPromotionCoupon error")}))},handleLogin:function(t){var a=t.target&&t.target.dataset&&t.target.dataset.awardid,i=this;o.cwx.user.login({callback:function(o){o&&"0"==o.ReturnCode?(i.setData({loginStatus:!0,getBtnWidthLogin:!0}),1==i.data.floatStep&&i.setData({floatStep:2}),a?i.handleSendCoupon(t,i.getPromotionCoupon.bind(i)):i.getPromotionCoupon()):(i.setData({receiveLoading:!1}),wx.showToast({title:"登录失败",icon:"none"}))}})},openRedEnvelope:function(){this.setData({floatStep:2})},handleSendCoupon:function(a,n){var d=this,s=a.target&&a.target.dataset&&a.target.dataset.awardid||0;t&&t.ubtTrace&&t.ubtTrace("mkt_coupon_float_comp",{openid:e,action:"handleSendCoupon",platform:"wechat",pageid:i,allianceid:this.data.allianceid,sid:this.data.sid,activityId:this.data.activityId,awardId:s});var r=this.data.floatConfig.packageId-0||-1,l=(new Date).getTime(),u=Math.random().toString().slice(2,10),p=o.cwx.md5("".concat(r,"_").concat(s,"_").concat(l).concat(u,"gk3y582mkth5ni28a9"));c("sendCoupon",{packageId:r,awardId:s,ts:l,nonce:u,sign:p},(function(a){if(0==a.errcode){var o=d.data.couponList.map((function(t){return t.awardId==s&&(t.status=1,d.triggerEvent("sendCouponSuccess",t.userProductLineIDsName)),t}));d.setData({couponList:o}),t&&t.ubtTrace&&t.ubtTrace("mkt_coupon_float_comp",{openid:e,action:"sendCouponSuccess",platform:"wechat",pageid:i,allianceid:d.data.allianceid,sid:d.data.sid,activityId:d.data.activityId,_awardId:s})}else 111==a.errcode?wx.showToast({title:"您已领取过",icon:"none"}):(wx.showToast({title:"领取失败",icon:"none"}),t&&t.ubtTrace&&t.ubtTrace("mkt_coupon_float_comp",{openid:e,action:"sendCouponError",platform:"wechat",pageid:i,error:a,_awardId:s}));n&&"function"==typeof n&&n()}),(function(a){wx.showToast({title:a,icon:""}),t&&t.ubtTrace&&t.ubtTrace("mkt_coupon_float_comp",{openid:e,action:"sendCouponError",platform:"wechat",pageid:i,error:a,_awardId:s})}))},getTimeStamp:function(t){return t?t.match(/\d{13}/)&&t.match(/\d{13}/)[0]&&t.match(/\d{13}/)[0]-0:0},formatTime:function(t){return t=t.match(/\d{13}/)&&t.match(/\d{13}/)[0]&&t.match(/\d{13}/)[0]-0,new Date(t).getFullYear()+"-"+(new Date(t).getMonth()+1<10?"0"+(new Date(t).getMonth()+1):new Date(t).getMonth()+1)+"-"+(new Date(t).getDate()<10?"0"+new Date(t).getDate():new Date(t).getDate())+"前可用"},goTargetUrl:function(t){var a=t.target&&t.target.dataset&&t.target.dataset.url,i=this;a?a.indexOf("https://")>=0||a.indexOf("http://")>=0?o.cwx.component.cwebview({data:{url:encodeURIComponent(a)}}):(a.trim(),"/"!=a[0]&&(a="/"+a.trim()),o.cwx.navigateTo({url:a,fail:function(t){i.setData({isShowFloat:!1})}})):this.setData({isShowFloat:!1})},closeFloat:function(){this.setData({isShowFloat:!1})}}});
},{isPage:false,isComponent:true,currentFile:'cwx/component/couponFloat/couponFloat.js'});require("cwx/component/couponFloat/couponFloat.js");