!function(e){e.global,e.Function;var t=e.setTimeout;e.setInterval,e.setImmediate,e.requestAnimationFrame,e.swanGlobal,e.jsNative,e.masterManager,e._openSourceDebugInfo,e.System,e.Bdbox_aiapps_jsbridge,e.Bdbox_android_jsbridge,e.Bdbox_android_utils,e._naFile,e._naInteraction,e._naNetwork,e._naRouter,e._naSetting,e._naStorage,e._naUtils,e.globalThis;window.define("42",(function(e,a,o,n,i,s,r,c,l,d,u,g,p,h,f,m,w,v,T,_,I,S,D){"use strict";function y(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var C=s(),P=e(32),A=e(35),x=e(40);Page({data:{articleId:"12063140",showSkeleton:!0,article:[],relation:[],news:[],productId:"",videoUrl:"",isShowvideo:!1,scrollTop:0,goTop:!1,agreeNum:0,touched:"",showNum:"",disabled:"",voteTip:"您已经赞过了哦",isShowShareIcon:!0,isShowShareDia:!1,product:[],inputHide:!0,pageCmtNo:1,cmtPageNo:1,cmtPageSize:1,pageUrl:"",commentDataLen:0,headvideo:[],__uuid:0,channalId:11567,needTieba:!1,cmtTop:0,cmtTitle:"评论",agreeTitle:"点赞",authorPic:"https://i7.3conline.com/images/upload/upc/face/0/0_100x100",openType:"redirect",ttsTxt:"播放",isPlay:!1,canUserTTS:!1,isAgree:0,isFaved:!1,favCode:2,favStatus:"收藏",logined:!1,productList:[],mallList:[],mallEventId:{2:646,3:647,more:645}},onShow:function(){void 0!==this.data.articleId&&(this.checkFav(),this.getArtAgreeNum(this.data.articleId))},onLoad:function(e){var t=e.articleId||decodeURIComponent(e.scene)||this.data.articleId;t.indexOf("_")>=0&&(t=t.split("_")[0]),this.setData({articleId:t,openType:1==getCurrentPages().length?"navigate":"redirect"}),this.getArtsInfo(t);var a=i.canIUse("getStreamTTSManager");this.setData({canUserTTS:a}),this.data.canUserTTS&&this.initTTS()},initTTS:function(){var e=this,t=i.getStreamTTSManager();t.streamStatus((function(e){console.log("streamStatus--------",JSON.stringify(e))})),t.onPlay((function(t){console.log("onPlay --------",JSON.stringify(t)),e.setData({ttsTxt:"暂停",isPlay:!0})})),t.onPause((function(t){console.log("onPause --------",JSON.stringify(t)),e.setData({ttsTxt:"播放",isPlay:!1})})),t.onEnded((function(t){console.log("onEnded --------",JSON.stringify(t)),e.setData({ttsTxt:"播放",isPlay:!1})})),t.onStop((function(t){console.log("onStop --------",JSON.stringify(t)),e.setData({ttsTxt:"播放",isPlay:!1})})),e.streamTTSManager=t},speak:function(){this.data.isPlay?this.streamTTSManager.pause():(i.showToast({title:"开始播放"}),this.streamTTSManager.playStream({title:this.data.article.title,context:{paragraphCount:this.data.voiceContent.length,letterCount:this.data.contentWordLength,imageUrl:"",iconImageUrl:""},content:this.data.voiceContent}))},onReady:function(){this.data.productId;C.setvisited("art_bk",(function(e){2==e&&C.ifSupport("3.70.00",(function(){console.log("show fav more than 2 times"),x.open("11")})),e>2&&t(C.addFav,3e3)})),this.setData({showSkeleton:!1})},getArtsInfo:function(e){var a=this,o=e;i.showLoading({title:"加载中"}),t((function(){i.hideLoading()}),1e4);var n=P.getAPI("wx_art_bk");n||console.error("wx_art_bk is required!"),i.request({url:n+"?articleId="+o,header:{"content-type":"application/json"},success:function(e){var o=e.data.data,n=o.content;n=(n=n.replace(/(<img\s+[^>]*src="\w+:\/\/ad.doubleclick\.net[^"]*"[^>]*>)/gi,"").replace(/<p(\s+[^>]*)?><img[^>]*style="display:none;"[^>]*><\/p>/g,"").replace(/<p(\s+[^>]*)?><iframe[^>]*><\/iframe><\/p>/g,"")).replace(/<img\s+([^>]*)src=\"(https:\/\/img\d)(w)([^"]*)(\/spcgroup\/width_640-qua_50)([^"]*(?=\.gif))([^"]*)"([^>]*)>/,(function(e,t,a,o,n,i,s,r,c){return console.log(e,t,a,o,n,i,s,r,c),"<img "+t+' src="'+a+n+s+"_thumb"+r+'"'+c+">"})),A.wxParse("art","html",n,a,5),a.getHeadVideo(o.headvideoId),""!=o.productId&&a.getProsmall(o.productId),a.setData({showSkeleton:!1,article:o,relation:e.data.relation||[],news:e.data.news||[],productId:o.productId,pageUrl:o.commentUrl,__uuid:a.data.articleId,wd:o.title,productList:void 0!==e.data.data.productList?e.data.data.productList:[]}),console.log(e.data.data.productList,"================"),console.log(n.replace(/(<\w+(\s+[^>]*)?>(\s)*<img[^>]*><\/\w+>)/g,"").replace(/<strong\s+class="js2-16[^"]*"[^>]*>(.*?)<\/strong>/g,"").replace(/(<\w+(\s+[^>]*)?>(\s*)<\/\w+>)/g,""));var s=n.replace(/(<\w+(\s+[^>]*)?>(\s)*<img[^>]*><\/\w+>)/g,"").replace(/<strong\s+class="js2-16[^"]*"[^>]*>(.*?)<\/strong>/g,"").replace(/(<\w+(\s+[^>]*)?>(\s*)<\/\w+>)/g,"").replace(/(<\w+(\s+[^>]*)?>(\s*)<\/\w+>)/g,"").match(/<p(\s+[^>]*)?>(.*?)<\/p>/g);console.log(s);var r=0,c=s.map((function(e,t){return e=e.replace(/<\w+(\s+[^>]*)?>(.*?)<\/\w+>/g,"$2").replace(/<\w+(\s+[^>]*)?>(.*?)<\/\w+>/g,"$2").replace(/\s+/g,""),r+=e.length,{data:e,type:"text",index:t}}));console.log(c,r,"============="),a.setData({voiceContent:c,contentWordLength:r}),t((function(){i.hideLoading(),a.getCMTtop((function(e){a.setData({cmtTop:e})}))}),500),i.setPageInfo({title:a.data.article.title,keywords:a.data.article.keywords,description:a.data.article.summary,releaseDate:a.data.article.publishDate,image:o.headPicUrl?o.headPicUrl:"https://www1.pconline.com.cn/weapp/2018/pconline/images/default_cover.jpg",success:function(){console.log("setPageInfo success")},fail:function(e){console.log("setPageInfo fail",e)}})},fail:function(e){i.showToast({title:"网络不稳定，请检查网络或稍后再试！",icon:"none",duration:2e3}),t((function(){i.hideLoading()}),500)}})},getHeadVideo:function(e){var t=this,a=e,o=P.getAPI("wx_art_headvideo");o||console.error("wx_art_headvideo is required!"),i.request({url:o+"?ids="+a+"&json=true",header:{"content-type":"application/json"},success:function(e){var a=e.data.data;t.setData({headvideo:a})},fail:function(e){i.showToast({title:"网络不稳定，请检查网络或稍后再试！",icon:"none",duration:2e3})}})},getArtAgreeNum:function(e){var t=this,a=e,o=P.getAPI("wx_art_agree");o||console.error("wx_art_agree is required!"),i.request({url:o+"?act=getArticleCount&siteId=1&articleId="+a,header:{"content-type":"application/json"},data:y({},P.COMID,i.getStorageSync(P.COMID)),success:function(e){var a=e.data;console.log(e),t.setData({agreeNum:a.agreeCount,agreeTitle:a.agreeCount>0?a.agreeCount:"点赞",touched:"1"==a.isAgree?"touched":"",disabled:"1"==a.isAgree?"disabled":"",isAgree:a.isAgree})},fail:function(e){i.showToast({title:"网络不稳定，请检查网络或稍后再试！",icon:"none",duration:2e3})}})},addAgree:function(e){var t=this,a=t.data.isAgree||e.currentTarget.dataset.isAgree;if(!i.getStorageSync(P.COMID))return C.showToast("none","未登录!即将跳转登录页",(function(){i.navigateTo({url:"/pages/login/login"})})),!1;console.log(a);var o="1"==a?"delArtAgree":"addArtAgree",n=t.data.agreeNum,s=parseInt(t.data.articleId),r=P.getAPI("wx_art_addAgree");r||console.error("wx_art_addAgree is required!"),i.request({url:r+"?articleId="+s+"&act="+o+"&siteId=1&isAgree=1&req_enc=UTF-8&resp_enc=UTF-8",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:y({},P.COMID,i.getStorageSync(P.COMID)),success:function(e){console.log(e),0==e.data.code?"delArtAgree"==o?(n-=1,t.setData({showNum:"",agreeNum:n,touched:"",disabled:"",agreeTitle:0==n?"点赞":n,isAgree:"0"}),C.alert("点赞已取消！")):(n+=1,t.setData({showNum:"showNum",agreeNum:n,touched:"touched",disabled:"disabled",agreeTitle:n,isAgree:"1"}),C.alert("点赞成功！")):(t.setData({showNum:"",touched:"touched",disabled:"disabled"}),C.alert("您已经点赞过了哦！"))},fail:function(e){C.alert("网络不稳定，请检查网络或稍后再试！")}})},checkFav:function(){var e=this,t=parseInt(e.data.articleId),a=P.getAPI("wx_art_addAgree");a||console.error("fav is required!"),i.request({url:a+"?act=isCollect&siteId=1&req_enc=UTF-8&resp_enc=UTF-8",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:y({articleId:t},P.COMID,i.getStorageSync(P.COMID)),success:function(t){console.log(t,"添加收藏");var a=t.data.code;e.setData({favCode:a,isFaved:1==a,favStatus:1==a?"已收藏":"收藏"})},fail:function(e){C.alert("网络不稳定，请检查网络或稍后再试！")}})},addFav:function(e){var a=this,o=e.currentTarget.dataset.faved;if(console.log(o),-1==a.data.favCode)return C.alert("未登录!即将跳转登录页"),t((function(){i.navigateTo({url:"/pages/login/login"})}),2500),!1;var n=1==o?"delMyCollection":"addArtCollect",s=parseInt(a.data.articleId),r=P.getAPI("wx_art_addAgree");r||console.error("wx_art_addFav is required!"),i.request({url:r+"?act="+n+"&siteId=1&req_enc=UTF-8&resp_enc=UTF-8",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:y({articleId:s},P.COMID,i.getStorageSync(P.COMID)),success:function(e){console.log(e),0==e.data.code?"delMyCollection"==n?(a.setData({isFaved:!1,favCode:2,favStatus:"收藏"}),C.alert("已取消收藏")):(a.setData({isFaved:!0,favCode:1,favStatus:"已收藏"}),C.alert("收藏成功！")):C.alert(e.data.message)},fail:function(e){C.alert("网络不稳定，请检查网络或稍后再试！")}})},getProsmall:function(e){var t=this,a=e,o=P.getAPI("wx_art_getPros");o||console.error("wx_art_getPros is required!"),i.request({url:o+"?productId="+a,header:{"content-type":"application/json"},success:function(e){var a=e.data.result;console.log(a),t.setData({product:a[0]})},fail:function(e){i.showToast({title:"网络不稳定，请检查网络或稍后再试！",icon:"none",duration:2e3})}})},countCmtTotal:function(e){console.log(e.detail.total),this.setData({cmtTotal:e.detail.total})},loadComplete:function(e){if(e.detail.loadIsOk){var t=this.data.pageCmtNo+1;this.setData({pageCmtNo:t})}},hideInput:function(e){console.log(e.detail),this.setData({inputHide:e.detail.hideInput})},myPosChange:function(e){var t=e.detail.scrollTop;this.setData({scrollTop:t})},scroll:function(e){this.setData({goTop:e.detail.scrollTop>700})},playVideo:function(e){var t=e.currentTarget.dataset.src;this.setData({videoUrl:t,isShowvideo:!0})},showShareDia:function(){this.setData({isShowShareDia:!0})},wxParseTagATap:function(e){var t=e.currentTarget.dataset.src;t.indexOf("http:")<0&&t.indexOf("https:")<0&&(t="https:"+t),i.setClipboardData({data:t,success:function(e){C.alert("链接已复制，请在浏览器打开查看详情")},fail:function(){C.alert("复制链接失败！")}})},getCMTtotal:function(e){var t=e.detail.cmtTotal;t>0&&this.setData({cmtTitle:t})},getCMTtop:function(e){this.selectorQuery=i.createSelectorQuery(),this.selectorQuery.select("#JcmtBox").boundingClientRect().exec((function(t){console.log("节点信息",t);var a=t[0].top;e&&e(a)}))},scrollToCMT:function(){this.setData({toView:"JcmtBox"})},onShareAppMessage:function(){return{title:this.data.article.title,path:"pages/art_bk/art_bk?articleId="+this.data.articleId,imageUrl:this.data.article.headPicUrl||"https://www1.pconline.com.cn/weapp/2018/pconline/images/default_cover.jpg"}}})})),window.__swanRoute="pages/art_bk/art_bk",window.usingComponents=["components/video/video","components/gohome/gohome","components/gotop/gotop","components/count/count","components/cmt/list/list","components/mallList/mallList"],window.usingPluginComponents=[],require("42")}(__hacked);
//# sourceMappingURL=C:\output\pages\art_bk\art_bk.js.map